<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"superming.life","root":"/","images":"/images","scheme":"Mist","version":"8.2.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>
<meta name="description" content="MongoDB安装使用tar包进行安装前提： MongoDB4.2社区版支持macOS 10.12及后续版本。 下载tar包：地址  OS选择macOSx64，包选择TGZ，点击下载。  把下载文件移至&#x2F;usr&#x2F;local下，进行解压缩。   12tar -zxvf mongodb-macos-x86_64-4.2.5.tgzsudo mv mongodb-osx-x86_64-4.2.5&#x2F; mo">
<meta property="og:type" content="article">
<meta property="og:title" content="MongoDB">
<meta property="og:url" content="https://superming.life/2020/04/20/MongoDB/index.html">
<meta property="og:site_name" content="AlenZhang&#39;s Blog">
<meta property="og:description" content="MongoDB安装使用tar包进行安装前提： MongoDB4.2社区版支持macOS 10.12及后续版本。 下载tar包：地址  OS选择macOSx64，包选择TGZ，点击下载。  把下载文件移至&#x2F;usr&#x2F;local下，进行解压缩。   12tar -zxvf mongodb-macos-x86_64-4.2.5.tgzsudo mv mongodb-osx-x86_64-4.2.5&#x2F; mo">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://superming.life/2020/04/20/MongoDB/exp.png">
<meta property="og:image" content="https://superming.life/2020/04/20/MongoDB/colletions.png">
<meta property="og:image" content="https://superming.life/2020/04/20/MongoDB/data.png">
<meta property="og:image" content="https://superming.life/2020/04/20/MongoDB/Master.png">
<meta property="og:image" content="https://superming.life/2020/04/20/MongoDB/replication.png">
<meta property="og:image" content="https://superming.life/2020/04/20/MongoDB/sharding.png">
<meta property="og:image" content="https://superming.life/2020/04/20/MongoDB/insert.png">
<meta property="og:image" content="https://superming.life/2020/04/20/MongoDB/Multiple.png">
<meta property="og:image" content="https://superming.life/2020/04/20/MongoDB/arrary.png">
<meta property="og:image" content="https://superming.life/2020/04/20/MongoDB/cusorbehavior.png">
<meta property="article:published_time" content="2020-04-19T16:17:58.000Z">
<meta property="article:modified_time" content="2021-02-01T16:02:19.536Z">
<meta property="article:author" content="AlenZhang">
<meta property="article:tag" content="BigData">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://superming.life/2020/04/20/MongoDB/exp.png">


<link rel="canonical" href="https://superming.life/2020/04/20/MongoDB/">


<script data-pjax class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<title>MongoDB | AlenZhang's Blog</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="/custom_css_source.css">
<!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="AlenZhang's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">AlenZhang's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MongoDB"><span class="nav-number">1.</span> <span class="nav-text">MongoDB</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">1.1.</span> <span class="nav-text">安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8tar%E5%8C%85%E8%BF%9B%E8%A1%8C%E5%AE%89%E8%A3%85"><span class="nav-number">1.1.1.</span> <span class="nav-text">使用tar包进行安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Brew%E5%AE%89%E8%A3%85"><span class="nav-number">1.1.2.</span> <span class="nav-text">使用Brew安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C"><span class="nav-number">1.1.3.</span> <span class="nav-text">运行</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MongoDB%E6%A6%82%E8%BF%B0"><span class="nav-number">1.2.</span> <span class="nav-text">MongoDB概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E5%BF%B5%E8%A7%A3%E6%9E%90"><span class="nav-number">1.3.</span> <span class="nav-text">概念解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">1.3.1.</span> <span class="nav-text">文档数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E5%90%88-Collections"><span class="nav-number">1.3.2.</span> <span class="nav-text">集合(Collections)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.3.3.</span> <span class="nav-text">数据类型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84"><span class="nav-number">1.4.</span> <span class="nav-text">架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E4%BB%8E%E6%A8%A1%E5%BC%8F%EF%BC%88Master-Slaver%EF%BC%89"><span class="nav-number">1.4.1.</span> <span class="nav-text">主从模式（Master-Slaver）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%AF%E6%9C%AC%E9%9B%86%E6%A8%A1%E5%BC%8F-Replication"><span class="nav-number">1.4.2.</span> <span class="nav-text">副本集模式(Replication)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E7%89%87%E6%A8%A1%E5%BC%8F%EF%BC%88Sharding%EF%BC%89"><span class="nav-number">1.4.3.</span> <span class="nav-text">分片模式（Sharding）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Shell%E6%93%8D%E4%BD%9C"><span class="nav-number">1.5.</span> <span class="nav-text">Shell操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80-%E5%88%9B%E5%BB%BA%E5%BA%93%E4%B8%8E%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C"><span class="nav-number">1.5.1.</span> <span class="nav-text">一. 创建库与集合操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%EF%BC%9A%E6%96%87%E6%A1%A3%E6%8F%92%E5%85%A5"><span class="nav-number">1.5.2.</span> <span class="nav-text">二：文档插入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%EF%BC%9A%E7%AE%80%E5%8D%95%E6%96%87%E6%A1%A3%E5%A2%9E%E6%9F%A5"><span class="nav-number">1.5.3.</span> <span class="nav-text">三：简单文档增查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%88%A0%E9%99%A4%E7%9B%B8%E5%85%B3"><span class="nav-number">1.5.4.</span> <span class="nav-text">四：数据删除相关</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%94%EF%BC%9A%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3"><span class="nav-number">1.5.5.</span> <span class="nav-text">五：更新文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AD%EF%BC%9A%E6%96%87%E6%A1%A3%E8%81%9A%E5%90%88"><span class="nav-number">1.5.6.</span> <span class="nav-text">六：文档聚合</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="AlenZhang"
      src="/images/ninja8.jpg">
  <p class="site-author-name" itemprop="name">AlenZhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">33</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="mailto:supermingzero@gmail.com" title="E-Mail → mailto:supermingzero@gmail.com" rel="noopener" target="_blank"><i class="far fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/AlenZhang-Dev" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;AlenZhang-Dev" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.instagram.com/alen_zhang_bubble/" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;alen_zhang_bubble&#x2F;" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/t.me/AlenZhang" title="Telegram → t.me&#x2F;AlenZhang"><i class="fab fa-telegram fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://superming.life/2020/04/20/MongoDB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ninja8.jpg">
      <meta itemprop="name" content="AlenZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AlenZhang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MongoDB
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-04-20 00:17:58" itemprop="dateCreated datePublished" datetime="2020-04-20T00:17:58+08:00">2020-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>14k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>13 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="使用tar包进行安装"><a href="#使用tar包进行安装" class="headerlink" title="使用tar包进行安装"></a>使用tar包进行安装</h3><p>前提：</p>
<p>MongoDB4.2社区版支持macOS 10.12及后续版本。</p>
<p>下载tar包：<a target="_blank" rel="noopener" href="https://www.mongodb.com/download-center/community?tck=docs_server">地址</a></p>
<ol>
<li><p>OS选择macOSx64，包选择TGZ，点击下载。</p>
</li>
<li><p>把下载文件移至<code>/usr/local</code>下，进行解压缩。</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf mongodb-macos-x86_64-4.2.5.tgz</span><br><span class="line">sudo mv mongodb-osx-x86_64-4.2.5/ mongodb  //重命名</span><br></pre></td></tr></table></figure>
<ol>
<li>将bin目录下的文件放入<code>/usr/local/bin</code>下</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /usr/local/mongodb/bin/* /usr/local/bin/</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>建立存放数据目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /usr/local/var/mongodb    //mongod进程写入数据文件</span><br><span class="line">sudo mkdir -p /usr/local/var/log/mongodb		//创建mongod进程产生的log文件</span><br></pre></td></tr></table></figure>
<p>注意：在macOS 10.15 Catalina后，Apple限制了MongDB存放数据的默认地址<code>/data/db</code>。所以我们必须使用不同的数据目录。比如<code>/usr/local/var/mongodb</code>。</p>
<p>设置文件的拥有者</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chown my_mongodb_user /usr/local/var/mongodb</span><br><span class="line">sudo chown my_mongodb_user /usr/local/var/log/mongodb</span><br></pre></td></tr></table></figure>
<p>运行</p>
<p>使用命令行开启mongod</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --dbpath /usr/local/var/mongodb --logpath /usr/local/var/log/mongodb/mongo.log --fork</span><br></pre></td></tr></table></figure>
<p>使用config文件开启</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --config /usr/local/etc/mongod.conf</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用tar包安装的mongod没有创建<code>mongod.conf</code>文件。</p>
</blockquote>
<p>查看是否开启</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep -v grep | grep mongod</span><br></pre></td></tr></table></figure>
<p>确认完毕在终端输入mongo即可开启mongoDB</p>
<h3 id="使用Brew安装"><a href="#使用Brew安装" class="headerlink" title="使用Brew安装"></a>使用Brew安装</h3><p>准备：</p>
<p>需要Xcode、Homebrew。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew tap mongodb/brew</span><br><span class="line">brew install mongodb-community@4.2</span><br></pre></td></tr></table></figure>
<p>使用brew安装，会自动创建如下文件及目录</p>
<blockquote>
<p>the configuration file(<code>/usr/local/etc/mongod.conf</code>)</p>
<p>the log directory path(<code>/usr/local/var/log/mongodb</code>)</p>
<p>the data directory path (<code>/usr/local/var/mongodb</code>)</p>
</blockquote>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>可以使用brew运行MongoDB作为macOS服务，或者手动将其作为后台程序运行。</p>
<ul>
<li>使用brew运行</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew services start mongodb-community@4.2   //开启Mongod进程</span><br><span class="line">brew services stop mongodb-community@4.2		//停止Mongod进程</span><br></pre></td></tr></table></figure>
<ul>
<li>作为后台程序手动开启</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --config /usr/local/etc/mongod.conf --fork</span><br></pre></td></tr></table></figure>
<p>以上都使用<code>usr/local/etc/mongod.conf</code>文件。</p>
<p>同样可以使用以下命令验证mongod是否运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep -v grep | grep mongod</span><br></pre></td></tr></table></figure>
<p>日志文件存放于：<code>/usr/local/var/log/mongodb/mongo.log</code></p>
<p>键入mongo即可使用mongoDB。</p>
<h2 id="MongoDB概述"><a href="#MongoDB概述" class="headerlink" title="MongoDB概述"></a>MongoDB概述</h2><p>MongoDB是一个面向文档的NoSQL数据库，由C++编写，使用类JSON的BSON格式进行数据编码和传输。具有高性能、高可用、可伸缩、易部署等特性，目前非常火爆。</p>
<h2 id="概念解析"><a href="#概念解析" class="headerlink" title="概念解析"></a>概念解析</h2><h3 id="文档数据库"><a href="#文档数据库" class="headerlink" title="文档数据库"></a>文档数据库</h3><p>记录在MongoDB中是一个文档，是一个由键值对组成的数据结构。</p>
<p><img src="/2020/04/20/MongoDB/exp.png" alt="exp"></p>
<p>优势：</p>
<blockquote>
<p>文档可以适应多种本地文件的数据类型</p>
<p>使用嵌入式的文档组织模式减少了表之间的连接需求</p>
<p>很好的动态伸缩性</p>
</blockquote>
<p>MongoDB单个实例可以容纳多个独立的数据库，每一个都有自己的集合和权限，不同数据库克放在不同文件内。</p>
<h3 id="集合-Collections"><a href="#集合-Collections" class="headerlink" title="集合(Collections)"></a>集合(Collections)</h3><p>集合是MongoDB的文档组(Collections)，类似RDBMS中的表格。集合存储于数据库中，没有固定的结构，可以在集合中插入不同格式的数据。如下为一个集合，其中包括多个文档(Documents)。</p>
<p><img src="/2020/04/20/MongoDB/colletions.png" alt="colletions"></p>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p><img src="/2020/04/20/MongoDB/data.png" alt="DataType"></p>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><h3 id="主从模式（Master-Slaver）"><a href="#主从模式（Master-Slaver）" class="headerlink" title="主从模式（Master-Slaver）"></a>主从模式（Master-Slaver）</h3><p><img src="/2020/04/20/MongoDB/Master.png" alt="Master"></p>
<p>由一个主节点和多个从节点组成。</p>
<p>主节点运行MongoDB实例，完成数据存储、查询和修改操作。</p>
<p>从节点不提供任何服务，但可通过设置是其具有查询服务，从而减轻主节点压力。</p>
<p>主节点出现故障，只能人工介入，指定新的主节点，从节点不会自动升级主节点，此时集群处于只读状态。</p>
<h3 id="副本集模式-Replication"><a href="#副本集模式-Replication" class="headerlink" title="副本集模式(Replication)"></a>副本集模式(Replication)</h3><p>官方参考：<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/replication/">Replication</a></p>
<p><img src="/2020/04/20/MongoDB/replication.png" alt="replication"></p>
<p>主节点负责数据写入和更新，负责指定其他节点为从节点，并设置从节点的可读性。</p>
<p>在主节点发生故障时，有额外仲裁节点会参与选举新节点作为主节点。</p>
<p>副本集模式可以解决主节点发生故障导致数据丢失或不可用问题，但遇到存储海量数据情况时，就束手无策了。</p>
<h3 id="分片模式（Sharding）"><a href="#分片模式（Sharding）" class="headerlink" title="分片模式（Sharding）"></a>分片模式（Sharding）</h3><p>官方参考: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/sharding/">Sharding</a></p>
<p><img src="/2020/04/20/MongoDB/sharding.png" alt="sharding"></p>
<p>分片服务器（Shard Server）：每个分片服务器都是一个mongod数据库实例，用于存储实际的数据块。<strong>整个数据库集合分成多个块存储在不同分片服务器中</strong>。</p>
<p>配置服务器（Config Server）：保存集合和分片的元数据。</p>
<p>路由服务器（Route Server）：在集群中作为路由使用，客户端由此介入。路由服务器本身不保存数据，启动时从配置服务器加载集群信息到缓存中，并将客户端的请求路由给每个分片服务器，将各个分片服务器的返回结果进行聚合并返回客户端。</p>
<h2 id="Shell操作"><a href="#Shell操作" class="headerlink" title="Shell操作"></a>Shell操作</h2><h3 id="一-创建库与集合操作"><a href="#一-创建库与集合操作" class="headerlink" title="一. 创建库与集合操作"></a>一. 创建库与集合操作</h3><ol>
<li>创建一个名为library的数据库</li>
</ol>
<p>创建数据库的语法为<code>use DATABASE_NAME</code></p>
<p><code>use library</code></p>
<ol>
<li>在library数据库中创建名为book的集合</li>
</ol>
<p>创建集合<code>db.createCollection(&quot;book&quot;)</code></p>
<ol>
<li>将集合book重命名为new_book</li>
</ol>
<p>修改集合的语法为<code>db.collection.renameCollection(target, dropTarget)</code>，其中dropTarget为可选参数，如果为true，则mongod会在先删除原有集合。</p>
<p><code>db.collection.renameCollection(&quot;new_book&quot;)</code></p>
<ol>
<li>查看集合new_book的信息</li>
</ol>
<p>查询数据的语法为<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.find/#db.collection.find"><code>db.collection.find(query, projection)</code></a>；query，document类型，使用查询操作符指定的查询条件；projection，document类型，使用投影操作副返回的键。</p>
<p><code>db.collection.find()</code></p>
<ol>
<li>删除集合new_books</li>
</ol>
<p>删除集合的语法为<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.drop/"><code>db.collection.drop()</code></a>，</p>
<p><code>db.new_book.drop()</code></p>
<p>6.删除数据库library</p>
<p>删除数据库语法为<code>db.dropDatabase(&lt;option&gt;)</code></p>
<p><code>db.dropDatabase()</code></p>
<h3 id="二：文档插入"><a href="#二：文档插入" class="headerlink" title="二：文档插入"></a>二：文档插入</h3><p>文档插入有三种方式，分别为<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.insert/"><code>db.collection.insert()</code></a>，<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.insertOne/"><code>db.collection.insertOne()</code></a>，[<code>db.collection.insertMany()</code>()]；</p>
<p>insert( )语法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> db.collection.insert(</span><br><span class="line">   &lt;document or array of documents&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     writeConcern: &lt;document&gt;,</span><br><span class="line">     ordered: &lt;boolean&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line"><span class="meta">#</span><span class="bash"> Example</span></span><br><span class="line">db.products.insert( &#123; item: &quot;card&quot;, qty: 15 &#125; )</span><br></pre></td></tr></table></figure>
<p>insertone( )语法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insertOne(</span><br><span class="line">   &lt;document&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">      writeConcern: &lt;document&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line"><span class="meta">#</span><span class="bash"> Examples:</span></span><br><span class="line">try &#123;</span><br><span class="line">   db.products.insertOne( &#123; item: &quot;card&quot;, qty: 15 &#125; );</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">   print (e);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>insertmany( )语法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insertMany(</span><br><span class="line">   [ &lt;document 1&gt; , &lt;document 2&gt;, ... ],</span><br><span class="line">   &#123;</span><br><span class="line">      writeConcern: &lt;document&gt;,</span><br><span class="line">      ordered: &lt;boolean&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line"><span class="meta">#</span><span class="bash"> Examples：</span></span><br><span class="line">try &#123;</span><br><span class="line">   db.products.insertMany( [</span><br><span class="line">      &#123; _id: 10, item: &quot;large box&quot;, qty: 20 &#125;,</span><br><span class="line">      &#123; _id: 11, item: &quot;small box&quot;, qty: 55 &#125;,</span><br><span class="line">      &#123; _id: 12, item: &quot;medium box&quot;, qty: 30 &#125;</span><br><span class="line">   ] );</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">   print (e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/04/20/MongoDB/insert.png" alt="insert"></p>
<p>在插入文档时注意<code>[ ]</code>的使用，例如：</p>
<ol>
<li>在school数据库中按下表创建表示班级grade_1_2的集合，并插入相应文档：</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th>name</th>
<th>sex</th>
<th>age</th>
<th>hobby</th>
<th>telephone</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>fixed</td>
<td>mobile</td>
</tr>
<tr>
<td>Tom</td>
<td>M</td>
<td>18</td>
<td>Football, skiing</td>
<td>84833380</td>
<td>13840957289</td>
</tr>
<tr>
<td>Lisi</td>
<td>M</td>
<td>18</td>
<td>Swimming</td>
<td></td>
<td>15543789567</td>
</tr>
<tr>
<td>Jack</td>
<td>M</td>
<td>20</td>
<td>Baseball</td>
<td>84833380</td>
<td>17656775563</td>
</tr>
<tr>
<td>Joan</td>
<td>F</td>
<td>22</td>
<td></td>
<td>84832281</td>
<td>13840957289</td>
</tr>
<tr>
<td>Marry</td>
<td>F</td>
<td>25</td>
<td>Table tennis</td>
<td></td>
<td>15543789567</td>
</tr>
</tbody>
</table>
</div>
<p>其中hobby部分设计多个项目，如果使用<code>&#123;name:&quot;Zhangsan&quot;,sex:&quot;M&quot;,age:20,hobby:&quot;Swimming&quot;,&quot;basketball&quot;,telephone:&#123;fixed:&quot;84833380&quot;,mobile:&quot;13840957289&quot;&#125;&#125;</code>，后期会导致查询方面的问题。</p>
<p>应该使用<code>[ ]</code>将其中的内容括起来:<code>&#123;name:&quot;Zhangsan&quot;,sex:&quot;M&quot;,age:20,hobby:[&quot;Swimming&quot;,&quot;basketball&quot;],telephone:&#123;fixed:&quot;84833380&quot;,mobile:&quot;13840957289&quot;&#125;&#125;</code></p>
<p>上述插入操作如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.insertMany([</span><br><span class="line">&#123;name:&quot;Tom&quot;,sex:&quot;M&quot;,age:18,hobby:[&quot;Football&quot;,&quot;Skiing&quot;],telephone:&#123;fixed:&quot;84833380&quot;,mobile:&quot;13840957289&quot;&#125;&#125;,</span><br><span class="line">&#123;name:&quot;Lisi&quot;,sex:&quot;M&quot;,age:18,hobby:&quot;Swimming&quot;,telephone:&#123;fixed:&quot;84833380&quot;,mobile:&quot;17656775563&quot;&#125;&#125;,</span><br><span class="line">&#123;name:&quot;Jack&quot;,sex:&quot;M&quot;,age:20,hobby:&quot;Swimming&quot;,telephone:&#123;fixed:&quot;84832281&quot;,mobile:&quot;13840957289&quot;&#125;&#125;,</span><br><span class="line">&#123;name:&quot;Joan&quot;,sex:&quot;F&quot;,age:22&#125;,</span><br><span class="line">&#123;name:&quot;Marry&quot;,sex:&quot;F&quot;,age:25,hobby:&quot;Table tennis&quot;,telephone:&#123;mobile:&quot;15543789567&quot;&#125;&#125;</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<h3 id="三：简单文档增查"><a href="#三：简单文档增查" class="headerlink" title="三：简单文档增查"></a>三：简单文档增查</h3><p>文档查询一般使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.find/"><code>db.collection.find(query, projection)</code></a></p>
<p>query：document类型，可选，使用查询操作运算符；</p>
<p>project：document类型，指定投影操作符返回字段，{ field1: <value>, field2: <value> … }，value为0不显示，1显示。</value></value></p>
<p>查询选择器参考：<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/query/#query-selectors">Query Selectors</a></p>
<p><strong>多条件查询</strong>：</p>
<p><img src="/2020/04/20/MongoDB/Multiple.png" alt="multiple"></p>
<p><strong>查询数组元素参考</strong>：</p>
<p><img src="/2020/04/20/MongoDB/arrary.png" alt="array"></p>
<p><strong>其中对查询数据进行重新整理的行为参考如下</strong>：</p>
<p><img src="/2020/04/20/MongoDB/cusorbehavior.png" alt="cusorbehavior"></p>
<p><strong>练习内容：</strong></p>
<ol>
<li>查看一年级二班grade_1_2中所有年龄大于 20 岁并且小于25 岁的学生</li>
</ol>
<p><code>db.grade_1_2.find(&#123;age:&#123;$gt:20,$lt:25&#125;&#125;)</code></p>
<ol>
<li>查看一年级二班grade_1_2中所有年龄大于 20 岁并且性别值为M的学生</li>
</ol>
<p><code>db.grade_1_2.find(&#123;age:&#123;$gt:20&#125;,&quot;sex&quot;:&quot;M&quot;&#125;)</code></p>
<ol>
<li>查看一年级二班grade_1_2中所有兴趣爱好为Football的学生</li>
</ol>
<p><code>db.grade_1_2.find(&#123;&quot;hobby&quot;:&quot;Football&quot;&#125;)</code></p>
<ol>
<li>查看一年级二班grade_1_2中所有兴趣爱好既包括Football又包括Skiing的学生</li>
</ol>
<p><code>db.grade_1_2.find(&#123;&quot;hobby&quot;:&#123;$all:[&quot;Football&quot;,&quot;Sking&quot;]&#125;&#125;)</code></p>
<ol>
<li>扩展：查看一年级二班grade_1_2中所有兴趣爱好既包括Football或Skiing的学生</li>
</ol>
<p><code>db.grade_1_2.find(&#123;&quot;hobby&quot;:&#123;$in:[&quot;Football&quot;,&quot;Sking&quot;]&#125;&#125;)</code></p>
<ol>
<li>查看一年级二班grade_1_2中所有兴趣爱好两个以上的学生</li>
</ol>
<p><code>db.grade_1_2.find(&#123;hobby:&#123;$size:2&#125;&#125;)</code></p>
<ol>
<li>查看一年级二班grade_1_2中所有兴趣爱好两个以上的学生的数量</li>
</ol>
<p><code>db.grade_1_2.find(&#123;hobby:&#123;$size:2&#125;&#125;).count()</code></p>
<ol>
<li><p>查看一年级二班grade_1_2的第二位学生</p>
</li>
<li><p>使用skip跳过第一个同学</p>
</li>
</ol>
<p><code>db.grade_1_2.find().limit(1).skip(1)</code></p>
<ol>
<li>查看一年级二班grade_1_2的学生，按年纪升序</li>
</ol>
<p><code>db.grade_1_2.find().sort(&#123;&quot;age&quot;: 1&#125;)</code> [ -1 为降序 ]</p>
<h3 id="四：数据删除相关"><a href="#四：数据删除相关" class="headerlink" title="四：数据删除相关"></a>四：数据删除相关</h3><p>数据删除主要使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.remove/"><code>db.collection.remove()</code></a>，语法如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.collection.remove(</span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     justOne: &lt;boolean&gt;,</span><br><span class="line">     writeConcern: &lt;document&gt;,</span><br><span class="line">     collation: &lt;document&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line"><span class="meta">#</span><span class="bash"> justone: 默认<span class="literal">false</span>，删除所有匹配条件的数据，若改为<span class="literal">true</span>，则仅删除第一条。</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>练习内容：</strong></p>
<ol>
<li>删除一年级二班grade_1_2所有 20 岁的学生</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.remove(&#123;age:20&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>删除一年级二班grade_1_2第一位18岁的学生</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.remove(&#123;&quot;age&quot;: 18&#125;, &#123;justOne: 1&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>删除一年级三班grade_1_3所有爱好football的学生</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.remove(&#123;&quot;hobby&quot;:&quot;football&quot;&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="五：更新文档"><a href="#五：更新文档" class="headerlink" title="五：更新文档"></a>五：更新文档</h3><p>对文章内容进行更新修改，一般使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.update/"><code>db.collection.update()</code></a></p>
<blockquote>
<p>Modifies an existing document or documents in a collection. The method can modify specific fields of an existing document or documents or replace an existing document entirely, depending on the <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.update/#update-parameter">update parameter</a>.</p>
</blockquote>
<p>语法如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.collection.update(</span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &lt;update&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     upsert: &lt;boolean&gt;,</span><br><span class="line">     multi: &lt;boolean&gt;,</span><br><span class="line">     writeConcern: &lt;document&gt;,</span><br><span class="line">     collation: &lt;document&gt;,</span><br><span class="line">     arrayFilters: [ &lt;filterdocument1&gt;, ... ],</span><br><span class="line">     hint:  &lt;document|string&gt;        // Available starting in MongoDB 4.2</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>Update的操作符：<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/#id1">Update Operators</a></p>
<p><strong>Fields</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/currentDate/#up._S_currentDate"><code>$currentDate</code></a></td>
<td style="text-align:left">Sets the value of a field to current date, either as a Date or a Timestamp.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/inc/#up._S_inc"><code>$inc</code></a></td>
<td style="text-align:left">Increments the value of the field by the specified amount.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/min/#up._S_min"><code>$min</code></a></td>
<td style="text-align:left">Only updates the field if the specified value is less than the existing field value.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/max/#up._S_max"><code>$max</code></a></td>
<td style="text-align:left">Only updates the field if the specified value is greater than the existing field value.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/mul/#up._S_mul"><code>$mul</code></a></td>
<td style="text-align:left">Multiplies the value of the field by the specified amount.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/rename/#up._S_rename"><code>$rename</code></a></td>
<td style="text-align:left">Renames a field.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/set/#up._S_set"><code>$set</code></a></td>
<td style="text-align:left">Sets the value of a field in a document.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/setOnInsert/#up._S_setOnInsert"><code>$setOnInsert</code></a></td>
<td style="text-align:left">Sets the value of a field if an update results in an insert of a document. Has no effect on update operations that modify existing documents.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/unset/#up._S_unset"><code>$unset</code></a></td>
<td style="text-align:left">Removes the specified field from a document.</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Array</strong></p>
<p>Operators</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/addToSet/#up._S_addToSet"><code>$addToSet</code></a></td>
<td style="text-align:left">Adds elements to an array only if they do not already exist in the set.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/pop/#up._S_pop"><code>$pop</code></a></td>
<td style="text-align:left">Removes the first or last item of an array.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/pull/#up._S_pull"><code>$pull</code></a></td>
<td style="text-align:left">Removes all array elements that match a specified query.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/push/#up._S_push"><code>$push</code></a></td>
<td style="text-align:left">Adds an item to an array.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/pullAll/#up._S_pullAll"><code>$pullAll</code></a></td>
<td style="text-align:left">Removes all matching values from an array.</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Modifiers</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/each/#up._S_each"><code>$each</code></a></td>
<td style="text-align:left">Modifies the <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/push/#up._S_push"><code>$push</code></a> and <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/addToSet/#up._S_addToSet"><code>$addToSet</code></a> operators to append multiple items for array updates.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/position/#up._S_position"><code>$position</code></a></td>
<td style="text-align:left">Modifies the <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/push/#up._S_push"><code>$push</code></a> operator to specify the position in the array to add elements.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/slice/#up._S_slice"><code>$slice</code></a></td>
<td style="text-align:left">Modifies the <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/push/#up._S_push"><code>$push</code></a> operator to limit the size of updated arrays.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/sort/#up._S_sort"><code>$sort</code></a></td>
<td style="text-align:left">Modifies the <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/push/#up._S_push"><code>$push</code></a> operator to reorder documents stored in an array.</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Bitwise</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/bit/#up._S_bit"><code>$bit</code></a></td>
<td style="text-align:left">Performs bitwise <code>AND</code>, <code>OR</code>, and <code>XOR</code> updates of integer values.</td>
</tr>
</tbody>
</table>
</div>
<p>以官方为例，创建Collections如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">db.books.remove(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">db.books.insertMany([</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;_id&quot; : 1,</span><br><span class="line">    &quot;item&quot; : &quot;TBD&quot;,</span><br><span class="line">    &quot;stock&quot; : 0,</span><br><span class="line">    &quot;info&quot; : &#123; &quot;publisher&quot; : &quot;1111&quot;, &quot;pages&quot; : 430 &#125;,</span><br><span class="line">    &quot;tags&quot; : [ &quot;technology&quot;, &quot;computer&quot; ],</span><br><span class="line">    &quot;ratings&quot; : [ &#123; &quot;by&quot; : &quot;ijk&quot;, &quot;rating&quot; : 4 &#125;, &#123; &quot;by&quot; : &quot;lmn&quot;, &quot;rating&quot; : 5 &#125; ],</span><br><span class="line">    &quot;reorder&quot; : false</span><br><span class="line">   &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">    &quot;_id&quot; : 2,</span><br><span class="line">    &quot;item&quot; : &quot;XYZ123&quot;,</span><br><span class="line">    &quot;stock&quot; : 15,</span><br><span class="line">    &quot;info&quot; : &#123; &quot;publisher&quot; : &quot;5555&quot;, &quot;pages&quot; : 150 &#125;,</span><br><span class="line">    &quot;tags&quot; : [ ],</span><br><span class="line">    &quot;ratings&quot; : [ &#123; &quot;by&quot; : &quot;xyz&quot;, &quot;rating&quot; : 5 &#125; ],</span><br><span class="line">    &quot;reorder&quot; : false</span><br><span class="line">   &#125;</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<p>inc 与 set 操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.books.update(</span><br><span class="line">   &#123; _id: 1 &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">     $inc: &#123; stock: 5 &#125;,   # stock增加5</span><br><span class="line">     $set: &#123;</span><br><span class="line">       item: &quot;ABC123&quot;,		# 修改item</span><br><span class="line">       &quot;info.publisher&quot;: &quot;2222&quot;,	# 修改info下的publisher</span><br><span class="line">       tags: [ &quot;software&quot; ],	# 修改tags</span><br><span class="line">       &quot;ratings.1&quot;: &#123; by: &quot;xyz&quot;, rating: 3 &#125;	# 修改rating的第一部分</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>push操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.books.update(</span><br><span class="line">   &#123; _id: 2 &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">     $push: &#123; ratings: &#123; &quot;by&quot; : &quot;jkl&quot;, &quot;rating&quot; : 2 &#125; &#125;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>unset操作，移除某filed操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.books.update(&#123;_id:2&#125;,&#123;$unset: &#123;tags:&quot;&quot;&#125;&#125;)</span><br><span class="line"><span class="meta">#</span><span class="bash">same as : db.books.update( &#123; _id: 1 &#125;, &#123; <span class="variable">$unset</span>: &#123; tags: 1 &#125; &#125; )</span></span><br></pre></td></tr></table></figure>
<p>与SQL语句类似，即：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE books</span><br><span class="line">DROP COLUMN tags</span><br></pre></td></tr></table></figure>
<p>文档覆盖操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.books.update(</span><br><span class="line">   &#123; _id: 2 &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">     item: &quot;XYZ123&quot;,</span><br><span class="line">     stock: 10,</span><br><span class="line">     info: &#123; publisher: &quot;2255&quot;, pages: 150 &#125;,</span><br><span class="line">     tags: [ &quot;baking&quot;, &quot;cooking&quot; ]</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><strong>练习内容：</strong></p>
<ol>
<li>修改一年级二班grade_1_2中名为Joan的学生，年龄为 22 岁，兴趣爱好为 dance和drawing</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.update(</span><br><span class="line">&#123;&quot;name&quot;:&quot;Joan&quot;&#125;,&#123;$set:&#123;age:22,&quot;hobby&quot;:[&quot;dancing&quot;,&quot;drawing&quot;]&#125;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol>
<li>追加一年级二班grade_1_2中，名为Joan的学生的兴趣爱好sing</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.update(</span><br><span class="line">&#123;“name”:Joan&#125;,&#123;$push:&#123;“hobby”:sing&#125;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol>
<li>追加一年级二班grade_1_2中，名为Joan的学生的兴趣爱好sing和basketball，要保证hobby数组不重复；</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.update(</span><br><span class="line">&#123;&quot;name&quot;:&quot;Joan&quot;&#125;,&#123;$addToSet:&#123;&quot;hobby&quot;:&#123;$each:[&quot;sing&quot;,&quot;basketball&quot;]&#125;&#125;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol>
<li>新学年，给一年级二班所有学生的年龄都增加一岁</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.update(</span><br><span class="line">&#123;&#125;,</span><br><span class="line">&#123;$inc:&#123;&quot;age&quot;:1&#125;&#125;,&#123;multi:true&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol>
<li>删除一年级二班grade_1_2中，名为Joan的学生的sex属性</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.update(</span><br><span class="line">&#123;&quot;name&quot;:&quot;Joan&quot;&#125;,</span><br><span class="line">&#123;$unset:&#123;&quot;sex&quot;:1&#125;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="六：文档聚合"><a href="#六：文档聚合" class="headerlink" title="六：文档聚合"></a>六：文档聚合</h3><p>文档聚合主要用于处理数据并返回计算结果，聚合操作将来自多个文档的值聚合在一起，按条件分组后，再进行一系列操作（求和、平均值、最大值、最小值）以返回单个结果。</p>
<p><strong>聚合管道</strong>是最常用的一种聚合方法，将前一条语句的结果作为第二条语句的输入。</p>
<p>MongoDB聚合管道由阶段组成，每个阶段在文档通过管道时转换文档。</p>
<p>使用<code>db.collection.aggregate(pipeline, options)</code></p>
<p>aggregate( )的阶段参考：<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/">db.collection,aggregate()Stages</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建聚合示例</span></span><br><span class="line">db.orders.insertMany([</span><br><span class="line">&#123; &quot;_id&quot;: 1, &quot;cust_id&quot;: &quot;abc1&quot;, &quot;ord_date&quot;: ISODate(&quot;2012-11-02T17:04:11.102Z&quot;), &quot;status&quot;: &quot;A&quot;, &quot;amount&quot;: 50 &#125;,</span><br><span class="line">&#123;&quot; _id&quot;: 2, &quot;cust_id&quot;: &quot;xyz1&quot;, &quot;ord_date&quot;: ISODate(&quot;2013-10-01T17:04:11.102Z&quot;), &quot;status&quot;: &quot;A&quot;, &quot;amount&quot;: 100 &#125;,</span><br><span class="line">&#123; &quot;_id&quot;: 3, &quot;cust_id&quot;: &quot;xyz1&quot;, &quot;ord_date&quot;: ISODate(&quot;2013-10-12T17:04:11.102Z&quot;), &quot;status&quot;: &quot;D&quot;, &quot;amount&quot;: 25 &#125;,</span><br><span class="line">&#123;&quot; _id&quot;: 4, &quot;cust_id&quot;: &quot;xyz1&quot;, &quot;ord_date&quot;: ISODate(&quot;2013-10-11T17:04:11.102Z&quot;), &quot;status&quot;: &quot;D&quot;, &quot;amount&quot;: 125 &#125;,</span><br><span class="line">&#123;&quot; _id&quot;: 5, &quot;cust_id&quot;: &quot;abc1&quot;, &quot;ord_date&quot;: ISODate(&quot;2013-11-12T17:04:11.102Z&quot;), &quot;status&quot;: &quot;A&quot;, &quot;amount&quot;: 25 &#125;</span><br><span class="line">])</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>分组计算总和：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.orders.aggregate([</span><br><span class="line">                     &#123; $match: &#123; status: &quot;A&quot; &#125; &#125;,</span><br><span class="line">                     &#123; $group: &#123; _id: &quot;$cust_id&quot;, total: &#123; $sum: &quot;$amount&quot; &#125; &#125; &#125;,</span><br><span class="line">                     &#123; $sort: &#123; total: -1 &#125; &#125;</span><br><span class="line">                   ])</span><br><span class="line"><span class="meta">#</span><span class="bash"> 统计所有状态为‘A’，按cust_id分组，计算总价</span></span><br></pre></td></tr></table></figure>
<p><strong>练习内容：</strong></p>
<ol>
<li>统计每名学生在考试中的总分</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_4.aggregate([</span><br><span class="line">&#123;$group:&#123;_id:&quot;$name&quot;,score:&#123;$sum:&#123;$sum:[&quot;$score.chinese&quot;,&quot;$score.math&quot;,&quot;$score.english&quot;]&#125;&#125;&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<ol>
<li>统计每名男生在考试中的总分及平均分</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_4.aggregate([</span><br><span class="line">&#123;$match:&#123;sex:&quot;M&quot;&#125;&#125;,</span><br><span class="line">&#123;$group:&#123;_id:&quot;$name&quot;,score:&#123;$sum:&#123;$sum:[&quot;$score.chinese&quot;,&quot;$score.math&quot;,&quot;$score.english&quot;]&#125;&#125;,</span><br><span class="line">avg:&#123;$avg:&#123;$avg:[&quot;$score.chinese&quot;,&quot;$score.math&quot;,&quot;$score.english&quot;]&#125;&#125;&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<ol>
<li>根据姓名分组，并统计人数</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_4.aggregate([</span><br><span class="line">&#123;$group:&#123;_id:&quot;$name&quot;,numbers:&#123;$sum:1&#125;&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<ol>
<li>根据姓名分组，并统计人数，过滤人数大于2的学生</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_4.aggregate([</span><br><span class="line">&#123;$group:&#123;_id:&quot;$name&quot;,numbers:&#123;$sum:1&#125;&#125;&#125;,</span><br><span class="line">&#123;$match:&#123;numbers:&#123;$gt:2&#125;&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<ol>
<li>统计每名男生在考试中的总分</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_4.aggregate([</span><br><span class="line">&#123;$match:&#123;sex:&quot;M&quot;&#125;&#125;,</span><br><span class="line">&#123;$group:&#123;_id:&quot;$name&quot;,score:&#123;$sum:&#123;$sum:[&quot;$score.chinese&quot;,&quot;$score.math&quot;,&quot;$score.english&quot;]&#125;&#125;&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-os-x-tarball/#run-mongod-with-a-configuration-file">MongoDB官方安装教程</a></p>

    </div>

    
    
    
      
  <div class="popular-posts-header">Related Posts</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2020/02/25/01-Hadoop-Configuration/" rel="bookmark">01-Hadoop Configuration</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2020/03/24/03-Hbase/" rel="bookmark">HBase</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2020/05/12/Hadoop集群配置安装--MacOS+Ubuntu尝试/" rel="bookmark">Hadoop集群配置安装：MacOS+Ubuntu尝试</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2020/04/14/NoSQL/" rel="bookmark">NoSQL</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2020/03/20/02-分布式文件系统HDFS/" rel="bookmark">02-分布式文件系统HDFS</a></div>
    </li>
  </ul>


    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/BigData/" rel="tag"># BigData</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/05/12/Hadoop%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E5%AE%89%E8%A3%85--MacOS+Ubuntu%E5%B0%9D%E8%AF%95/" rel="prev" title="Hadoop集群配置安装：MacOS+Ubuntu尝试">
                  <i class="fa fa-chevron-left"></i> Hadoop集群配置安装：MacOS+Ubuntu尝试
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/04/14/NoSQL/" rel="next" title="NoSQL">
                  NoSQL <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-alien"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">AlenZhang</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Symbols count total">241k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">3:39</span>
  </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script>


  






  



    <div class="pjax">

  <script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'none'
      },
      options: {
        renderActions: {
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              const target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js';
    script.defer = true;
    document.head.appendChild(script);
  } else {
    MathJax.startup.document.state(0);
    MathJax.typesetClear();
    MathJax.texReset();
    MathJax.typeset();
  }
</script>



    </div>
</body>
</html>
