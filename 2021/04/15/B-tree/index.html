<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"superming.life","root":"/","images":"/images","scheme":"Mist","version":"8.2.1","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>
<meta name="description" content="B-treeDisk StructureB tree and B+ tree are widly used in filesystem for indexing.  Understanding the disk structure will be helpful when learning B &#x2F; B+ tree. The pic below explian how data is stored">
<meta property="og:type" content="article">
<meta property="og:title" content="B-tree">
<meta property="og:url" content="https://superming.life/2021/04/15/B-tree/index.html">
<meta property="og:site_name" content="AlenZhang&#39;s Blog">
<meta property="og:description" content="B-treeDisk StructureB tree and B+ tree are widly used in filesystem for indexing.  Understanding the disk structure will be helpful when learning B &#x2F; B+ tree. The pic below explian how data is stored">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://superming.life/2021/04/15/B-tree/disk.png">
<meta property="og:image" content="https://superming.life/2021/04/15/B-tree/mutilevel.png">
<meta property="og:image" content="https://superming.life/2021/04/15/B-tree/mway.png">
<meta property="article:published_time" content="2021-04-15T06:48:56.000Z">
<meta property="article:modified_time" content="2021-04-15T06:27:38.345Z">
<meta property="article:author" content="AlenZhang">
<meta property="article:tag" content="Algorithms">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://superming.life/2021/04/15/B-tree/disk.png">


<link rel="canonical" href="https://superming.life/2021/04/15/B-tree/">


<script data-pjax class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<title>B-tree | AlenZhang's Blog</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="/custom_css_source.css">
<!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="AlenZhang's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">AlenZhang's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#B-tree"><span class="nav-number">1.</span> <span class="nav-text">B-tree</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Disk-Structure"><span class="nav-number">1.1.</span> <span class="nav-text">Disk Structure</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Muti-Level-indexing"><span class="nav-number">1.2.</span> <span class="nav-text">Muti-Level indexing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#M-way-search-tree"><span class="nav-number">1.3.</span> <span class="nav-text">M-way search tree</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Wikipedia"><span class="nav-number">1.4.</span> <span class="nav-text">Wikipedia</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Definition"><span class="nav-number">1.5.</span> <span class="nav-text">Definition</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Algorithms"><span class="nav-number">1.6.</span> <span class="nav-text">Algorithms</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Search"><span class="nav-number">1.6.1.</span> <span class="nav-text">Search</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Insertion"><span class="nav-number">1.6.2.</span> <span class="nav-text">Insertion</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Deletion"><span class="nav-number">1.6.3.</span> <span class="nav-text">Deletion</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Deletion-from-a-leaf-node"><span class="nav-number">1.6.3.1.</span> <span class="nav-text">Deletion from a leaf node.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Deletion-from-an-internal-node"><span class="nav-number">1.6.3.2.</span> <span class="nav-text">Deletion from an internal node.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Rebalancing"><span class="nav-number">1.6.3.3.</span> <span class="nav-text">Rebalancing</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Performance"><span class="nav-number">1.7.</span> <span class="nav-text">Performance</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Implementation-in-Java"><span class="nav-number">1.8.</span> <span class="nav-text">Implementation in Java:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Referneces"><span class="nav-number">1.9.</span> <span class="nav-text">Referneces:</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="AlenZhang"
      src="/images/ninja8.jpg">
  <p class="site-author-name" itemprop="name">AlenZhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">35</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="mailto:supermingzero@gmail.com" title="E-Mail → mailto:supermingzero@gmail.com" rel="noopener" target="_blank"><i class="far fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/AlenZhang-Dev" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;AlenZhang-Dev" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.instagram.com/alen_zhang_bubble/" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;alen_zhang_bubble&#x2F;" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/t.me/AlenZhang" title="Telegram → t.me&#x2F;AlenZhang"><i class="fab fa-telegram fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.linkedin.com/in/alen-zhang-5b82ba1a5/" title="Linkedin → https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;alen-zhang-5b82ba1a5&#x2F;" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://superming.life/2021/04/15/B-tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ninja8.jpg">
      <meta itemprop="name" content="AlenZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AlenZhang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          B-tree
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-15 14:48:56" itemprop="dateCreated datePublished" datetime="2021-04-15T14:48:56+08:00">2021-04-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>10k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>9 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="B-tree"><a href="#B-tree" class="headerlink" title="B-tree"></a>B-tree</h1><h2 id="Disk-Structure"><a href="#Disk-Structure" class="headerlink" title="Disk Structure"></a>Disk Structure</h2><p>B tree and B+ tree are widly used in filesystem for indexing. </p>
<p>Understanding the disk structure will be helpful when learning B / B+ tree.</p>
<p>The pic below explian how data is stored and manage on the disk specifically.</p>
<a id="more"></a> 
<p><img src="/2021/04/15/B-tree/disk.png" alt></p>
<p>Disk is divided into many tracks and sectors. </p>
<p>We read and write in terms of blocks. and any block on the disk can be addressed by <strong>tracker number and sector number.</strong></p>
<p>When we reach the block then we can visit <strong>a particular byte</strong> on disk with the offset. [tracker number, block number, offset]</p>
<p>Data can’t read and write directly from disk, we will put them into main memory(RAM), after the operation then put back.</p>
<p><strong>Main point:</strong></p>
<p>The indexes of tracker and sector are also stored in blocks.</p>
<p><strong>How many blocks we need for accessing the records in disk?</strong></p>
<p>We need 4 blocks to store the index and 1 block to assess the data. [The example above]</p>
<p>A: (4 + 1) blocks are required to accessing every data of the database.[not 25 blocks]</p>
<p><strong>How many blocks we need to storage those records?</strong></p>
<p>A: 25 blocks for records and 4 blocks for Index.</p>
<h2 id="Muti-Level-indexing"><a href="#Muti-Level-indexing" class="headerlink" title="Muti-Level indexing"></a>Muti-Level indexing</h2><p>Situation: When the records is extremely large.How we handle this situation.</p>
<p>Exp. We have 1000 records.[250 blocks], and we need 40 blocks for index.</p>
<p>The problem is that the index itself is large, so we need muti-level indexing to recude the access time.</p>
<p><img src="/2021/04/15/B-tree/mutilevel.png" alt></p>
<p><strong>So how many blocks do we need after we design a new index for indexing.</strong></p>
<p>Second level index: 2 blocks.</p>
<p>First level index: 40 blocks.</p>
<p>Total: 2 + 1 + 1 = 4 blocks.</p>
<p>Adding one more index will reduce the access of blocks.</p>
<p>That’s the basic idea for B / B+ tree.</p>
<p>So the final point is: we want self-manage multi level indexing so that’s the idea of b / b+ trees.</p>
<h2 id="M-way-search-tree"><a href="#M-way-search-tree" class="headerlink" title="M-way search tree"></a>M-way search tree</h2><p>Wikipedia: <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/M-tree">M-tree</a></p>
<p>M-way search means each node can have at most M children and m - 1 keys.[The extension of BST]</p>
<p><img src="/2021/04/15/B-tree/mway.png" alt></p>
<p><strong>What’s the problem of m-way search tree?</strong></p>
<p>There is <strong>no control</strong> of m-way search tree. You can insert as you like.</p>
<p>Exp: if i have n keys, so the height of the tree may be n. so <strong>time-consuming</strong>.</p>
<p><strong>So the B-tree set some rules of m-way tree.</strong></p>
<p>Rules that B-tree made in order to keep efficiency.</p>
<ul>
<li>Every node you must fill at least half. $\left \lceil m/2 \right \rceil$</li>
<li>root can have min 2 children.</li>
<li>All leave nodes at same level.</li>
<li><strong>bottom up creation.[Inorder to understand how b-tree is growing]</strong></li>
</ul>
<p>The restrictions make B-trees always at least half full, have few levels, and remain perfectly balanced.</p>
<h2 id="Wikipedia"><a href="#Wikipedia" class="headerlink" title="Wikipedia"></a>Wikipedia</h2><p>In computer science, a B-tree is <strong>a self-balancing tree</strong> data structure that maintains sorted data and allows searches, sequential access, insertions, and deletions in <strong>logarithmic time</strong>. The B-tree generalizes the binary search tree, allowing for nodes with <strong>more than two children.</strong> Unlike other self-balancing binary search trees, the B-tree is well suited for storage systems that read and write relatively large blocks of data, such as disks. It is commonly used in databases and file systems.</p>
<p>Keywords: self-balance, logarithmic time, more than two children</p>
<p><strong>Time complexity :</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Algorithm</th>
<th><strong>Average</strong></th>
<th><strong>Worst case</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Space</td>
<td>O(<em>n</em>)</td>
<td>O(<em>n</em>)</td>
</tr>
<tr>
<td style="text-align:left">Search</td>
<td>O(log <em>n</em>)</td>
<td>O(log <em>n</em>)</td>
</tr>
<tr>
<td style="text-align:left">Insert</td>
<td>O(log <em>n</em>)</td>
<td>O(log <em>n</em>)</td>
</tr>
<tr>
<td style="text-align:left">Delete</td>
<td>O(log <em>n</em>)</td>
<td>O(log <em>n</em>)</td>
</tr>
</tbody>
</table>
</div>
<h2 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h2><p>According to Knuth’s definition, a B-tree of order <strong>m</strong> is a tree which satisfies the following properties:</p>
<ol>
<li>Every node has at most m child.</li>
<li>Every non-leaf node (except root) has <strong>at least</strong> ⌈m/2⌉ child nodes.</li>
<li>The root has at least two children if it is not a leaf node.</li>
<li>A non-leaf node with k children contains k - 1 keys.</li>
<li>All leaves appear in the same level and carry no information.</li>
</ol>
<p>Internal nodes: Internal nodes are nodes except for leaf nodes and the root node.</p>
<p>The root node: The root node’s number of children has the same upper limit as internal nodes, but has no lower limit.</p>
<p>Leaf nodes: Leaf node do not carry any information [Knuth’s terminology]</p>
<p>B-tree do not need re=balancing as frequently as other self-balancing searching trees, but may waste some space, since nodes are not entirely full.</p>
<h2 id="Algorithms"><a href="#Algorithms" class="headerlink" title="Algorithms"></a>Algorithms</h2><h3 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h3><p>Starting from the root, the tree is recursively traversed from top to bottom. At each level, the search reduces its field of view to the child pointer(subtree) whose range includes the search value.</p>
<h3 id="Insertion"><a href="#Insertion" class="headerlink" title="Insertion"></a>Insertion</h3><p>The core knowledge of Insertion is <strong>split</strong> when the node is full.</p>
<p>All insertions start at leaf node.</p>
<p>Search the tree and find out the leaf node where the new element will be added.</p>
<p>Here are some parameters will be used later.</p>
<p>node.num : the number of child pointers of a node.</p>
<p>maxKey : the maximum number of a node.</p>
<p>minKey: the minimum number of a node.</p>
<p>use <code>.</code>to visit the node.</p>
<p>node means the leaf node that will be inserted in.</p>
<ol>
<li><code>node.num &lt; maxKey</code>. It means the node has room for the new element.  Insert the new elements to the right position.[sort(node)]</li>
<li><code>node.num == maxKey</code>.It means the node has no extra room for the new element, so we need to split the node.</li>
<li><code>median = m / 2</code> . Insert the element to the leaf node and then choose a single median of the node.[m/2]<ol>
<li>Values less than median are put in the new leaf node, and values greater than the median are put in the new right node, and median as a separation value.</li>
</ol>
</li>
<li><code>node.parent.num == maxKey</code>[after inserting]. The separation value is inserted in the node’s parent, which may cause parent to be split if the parent’s child pointer is full after the inserting.<ol>
<li><code>node.parent == null</code>. It means we should create a new root above the original root. <code>height++</code></li>
</ol>
</li>
</ol>
<h3 id="Deletion"><a href="#Deletion" class="headerlink" title="Deletion"></a>Deletion</h3><p>Deletion from a B-tree is much more complicated than insertion. We should consider whether node will be deleted, leaf node or internal node.</p>
<h4 id="Deletion-from-a-leaf-node"><a href="#Deletion-from-a-leaf-node" class="headerlink" title="Deletion from a leaf node."></a>Deletion from a leaf node.</h4><p>Locate and delete the element then rebalance the tree.</p>
<ol>
<li>Search the value to delete.</li>
<li>If the value is a leaf node, simply delete it.</li>
<li>Rebalanced the tree when underflow happens.[Go to Rebalancing]</li>
</ol>
<h4 id="Deletion-from-an-internal-node"><a href="#Deletion-from-an-internal-node" class="headerlink" title="Deletion from an internal node."></a>Deletion from an internal node.</h4><p>The value of each internal node means <strong>the separation value for two subtrees</strong>. So we need to find a <strong>replacement</strong> for the separation<strong>.</strong></p>
<ol>
<li>Choose a new separator if we can.<ol>
<li><code>node.parent.right.key &gt; minKey</code>  means we can borrow the element from the right brother and right rotate to replace the separator number.</li>
<li><code>node.parent.left.key &gt; minKey</code> means we can borrow the element from the left brother and left rotate to replace the separator number.</li>
</ol>
</li>
<li>Rebalance after rotate. If that leaf node is deficient after deletion, we need to rebalance the tree and starting from the leaf node.</li>
</ol>
<h4 id="Rebalancing"><a href="#Rebalancing" class="headerlink" title="Rebalancing"></a>Rebalancing</h4><p>If deletion an element from a node has brought it under minimum size, and some element must be redistributed to bring all nodes up to the minimum size.</p>
<p><strong>Rotation</strong>. Element from a sibling node that has more than the minimum number of nodes.</p>
<ol>
<li><code>node.parent.right.key &gt; minKey</code>  means we can borrow the element from the right brother and right rotate to replace the separator number.</li>
<li><code>node.parent.left.key &gt; minKey</code> means we can borrow the element from the left brother and left rotate to replace the separator number.</li>
</ol>
<p><strong>If no sibling can spare an element, so the deficient node must be merge with a sibling, and the parent will loss a separator element.</strong> Then the parent node may become deficient and need rebalancing. So the merging and rebalancing may continue to the root.</p>
<p><strong>Merge</strong>. Merging happens when Rotation is unsatisfied.  Take off the separator from their parent and merge with left and right subtree together.</p>
<ol>
<li>Copy the separator to the end of the left node.[It may be the deficient node or the sibling with the minimum number of elements.]</li>
<li>Move all elements from the right node to the left node.[the left node now has the maximum number of elements, and the right node is empty]</li>
<li>Remove the separator from the parent along with its empty right child. At the same time, the parent will loss an element.<ol>
<li>parent is the root node and has no elements, then free it and make the merged node  the new root. <code>height--</code></li>
<li><code>node.parent.num &lt; minKey</code>. if the parent has fewer than the required number of elements, rebalance the parent.</li>
</ol>
</li>
</ol>
<h2 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h2><p>A B-tree grows slower with growing data amount, than the linear of a linked list. Compared to a skip-list, both structures have the same performance, but the B-tree scales better for growing n.</p>
<p><strong>Advantages of B-tree usage for database</strong></p>
<ul>
<li>Keeps keys in sorted order for sequential traversing.</li>
<li>uses a hierarchical index to minimize the number of disk reads.</li>
<li>uses partially fully blocks to speed up insertion and deletions. </li>
<li>keeps the index balanced with a recursive algorithm.</li>
</ul>
<p>In addition, a B-tree minimizes waste by making sure the interior nodes are at least half full. A B-tree can handle an arbitrary number of insertions and deletions.</p>
<h2 id="Implementation-in-Java"><a href="#Implementation-in-Java" class="headerlink" title="Implementation in Java:"></a>Implementation in Java:</h2><p><strong>Node structure</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> childNum;<span class="comment">//The chldren number of a Node.</span></span><br><span class="line">        <span class="keyword">private</span> Entry[] children = <span class="keyword">new</span> Entry[M];<span class="comment">//Every node contains M Entries.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//Set childNum of a Node.</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">            childNum = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Internal nodes: only use key and next</span></span><br><span class="line">    <span class="comment">//External nodes: only use key and value</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Comparable key;</span><br><span class="line">        <span class="keyword">private</span> Object val;</span><br><span class="line">        <span class="keyword">private</span> Node next;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Entry</span><span class="params">(Comparable key, Object val, Node next)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            <span class="keyword">this</span>.val = val;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>Search</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Value <span class="title">get</span><span class="params">(Key key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;argument to get() is null&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> search(root, key, height);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Value <span class="title">search</span><span class="params">(Node x, Key key, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">        Entry[] children = x.children;</span><br><span class="line">        <span class="keyword">if</span> (height == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; x.childNum; ++j) &#123;</span><br><span class="line">                <span class="keyword">if</span> (eq(key, children[j].key)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> (Value) children[j].val;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; x.childNum; ++j) &#123;</span><br><span class="line">                <span class="comment">//fint the index and search into next level.</span></span><br><span class="line">                <span class="keyword">if</span> (j + <span class="number">1</span> == x.childNum || less(key, children[j + <span class="number">1</span>].key))</span><br><span class="line">                    <span class="keyword">return</span> search(children[j].next, key, height - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>Insert</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(Key key, Value val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;argument key to put() is null&quot;</span>);</span><br><span class="line">        <span class="comment">//if newNode is not null means the tree need to grow a new level.[root node is full]</span></span><br><span class="line">        Node newNode = insert(root, key, val, height);</span><br><span class="line">        number++;</span><br><span class="line">        <span class="keyword">if</span> (newNode == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        Node t = <span class="keyword">new</span> Node(<span class="number">2</span>);</span><br><span class="line">        t.children[<span class="number">0</span>] = <span class="keyword">new</span> Entry(root.children[<span class="number">0</span>].key, <span class="keyword">null</span>, root);</span><br><span class="line">        t.children[<span class="number">1</span>] = <span class="keyword">new</span> Entry(newNode.children[<span class="number">0</span>].key, <span class="keyword">null</span>, newNode);</span><br><span class="line">        root = t;</span><br><span class="line">        height++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">insert</span><span class="params">(Node h, Key key, Value val, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> j;</span><br><span class="line">        Entry t = <span class="keyword">new</span> Entry(key, val, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (height == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; h.childNum; j++) &#123;</span><br><span class="line">                <span class="comment">//find the right index of the tree.</span></span><br><span class="line">                <span class="keyword">if</span> (less(key, h.children[j].key))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; h.childNum; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((j + <span class="number">1</span> == h.childNum) || less(key, h.children[j + <span class="number">1</span>].key)) &#123;</span><br><span class="line">                    <span class="comment">//Node u is null means insert successfully at the lower level. Otherwise, Node u is the half split of the node h.</span></span><br><span class="line">                    <span class="comment">//In insert function j = j, after that j++</span></span><br><span class="line">                    Node u = insert(h.children[j++].next, key, val, height - <span class="number">1</span>);</span><br><span class="line">                    <span class="comment">//insert successfully and without any other movements.</span></span><br><span class="line">                    <span class="keyword">if</span> (u == <span class="keyword">null</span>)</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                    <span class="comment">//execute when Node u is not null, connect the Entry to the Node u.</span></span><br><span class="line">                    t.key = u.children[<span class="number">0</span>].key;</span><br><span class="line">                    t.val = <span class="keyword">null</span>;</span><br><span class="line">                    t.next = u;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Put the enrty into right position.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = h.childNum; i &gt; j; i--)</span><br><span class="line">            h.children[i] = h.children[i - <span class="number">1</span>];</span><br><span class="line">        h.children[j] = t;</span><br><span class="line">        h.childNum++;</span><br><span class="line">        <span class="comment">//Node is full or not.</span></span><br><span class="line">        <span class="keyword">if</span> (h.childNum &lt; M)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> split(h);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">split</span><span class="params">(Node h)</span> </span>&#123;</span><br><span class="line">        Node t = <span class="keyword">new</span> Node(M / <span class="number">2</span>);</span><br><span class="line">        h.childNum = M / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; M / <span class="number">2</span>; ++j)</span><br><span class="line">            t.children[j] = h.children[M / <span class="number">2</span> + j];</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>Github: <a target="_blank" rel="noopener" href="https://github.com/AlenZhang-Dev/Algorithm-Exploration/blob/master/Project/src/com/search/Algorithms/BTree.java">B-Tree</a></p>
<p>Problems and Future implemention:</p>
<ol>
<li>The internal node will split when childnum arrived to M - 1. But the first element of childnum is “invisible” which only store the next element,  so the real keynum is M - 2 when splited. [unFixed]</li>
<li>Deletion operation. [unFixed]</li>
</ol>
<hr>
<h2 id="Referneces"><a href="#Referneces" class="headerlink" title="Referneces:"></a>Referneces:</h2><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/B-tree">B-tree - Wikipedia</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=aZjYr87r1b8">Abdul Bari: B Trees and B+ Trees. How they are useful in Databases</a></p>

    </div>

    
    
    
      
  <div class="popular-posts-header">Related Posts</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2020/11/15/Algorithms-StacksandQueues/" rel="bookmark">Algorithms，Part I：Stacks and Queues</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2020/10/07/MergeSort/" rel="bookmark">MergeSort</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2020/11/16/Programming Assignment Deques and Randomized Queues/" rel="bookmark">Programming Assignment:Deques and Randomized Queues</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2020/10/17/插入排序/" rel="bookmark">Insertion</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2021/04/26/The analysis of algorithms/" rel="bookmark">The analysis of algorithms</a></div>
    </li>
  </ul>


    <footer class="post-footer">
          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://www.linkedin.com/in/alen-zhang-5b82ba1a5/">
          <span class="icon">
            <i class="fab fa-linkedin"></i>
          </span>

          <span class="label">Linkedin</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://t.me/newsrecord">
          <span class="icon">
            <i class="fab fa-telegram"></i>
          </span>

          <span class="label">Telegram</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://github.com/AlenZhang-Dev">
          <span class="icon">
            <i class="fab fa-github"></i>
          </span>

          <span class="label">GitHub</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://www.instagram.com/alen_zhang_bubble/">
          <span class="icon">
            <i class="fab fa-instagram"></i>
          </span>

          <span class="label">Instagram</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://weibo.com/5982658581/profile?topnav=1&wvr=6">
          <span class="icon">
            <i class="fab fa-weibo"></i>
          </span>

          <span class="label">Weibo</span>
        </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Algorithms/" rel="tag"># Algorithms</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/04/19/Weekly-Report-3/" rel="prev" title="Weekly Report 3">
                  <i class="fa fa-chevron-left"></i> Weekly Report 3
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/03/14/Weekly-Report-2/" rel="next" title="Weekly Report 2">
                  Weekly Report 2 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-alien"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">AlenZhang</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Symbols count total">248k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">3:45</span>
  </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script>


  






  



    <div class="pjax">

  <script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'none'
      },
      options: {
        renderActions: {
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              const target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js';
    script.defer = true;
    document.head.appendChild(script);
  } else {
    MathJax.startup.document.state(0);
    MathJax.typesetClear();
    MathJax.texReset();
    MathJax.typeset();
  }
</script>



    </div>
</body>
</html>
