<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"superming.life","root":"/","images":"/images","scheme":"Mist","version":"8.2.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>
<meta property="og:type" content="website">
<meta property="og:title" content="AlenZhang&#39;s Blog">
<meta property="og:url" content="https://superming.life/page/3/index.html">
<meta property="og:site_name" content="AlenZhang&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="AlenZhang">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://superming.life/page/3/">


<script data-pjax class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>
<title>AlenZhang's Blog</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="AlenZhang's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">AlenZhang's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="AlenZhang"
      src="/images/ninja2.jpg">
  <p class="site-author-name" itemprop="name">AlenZhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">29</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="mailto:supermingzero@gmail.com" title="E-Mail → mailto:supermingzero@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/AlenZhang-Dev" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;AlenZhang-Dev" rel="noopener" target="_blank"><i class="github fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://superming.life/2020/04/20/MongoDB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ninja2.jpg">
      <meta itemprop="name" content="AlenZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AlenZhang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/20/MongoDB/" class="post-title-link" itemprop="url">MongoDB</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-04-20 00:17:58" itemprop="dateCreated datePublished" datetime="2020-04-20T00:17:58+08:00">2020-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
        </span>
    </span>

  
    <span id="/2020/04/20/MongoDB/" class="post-meta-item leancloud_visitors" data-flag-title="MongoDB" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>14k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>13 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="使用tar包进行安装"><a href="#使用tar包进行安装" class="headerlink" title="使用tar包进行安装"></a>使用tar包进行安装</h3><p>前提：</p>
<p>MongoDB4.2社区版支持macOS 10.12及后续版本。</p>
<p>下载tar包：<a target="_blank" rel="noopener" href="https://www.mongodb.com/download-center/community?tck=docs_server">地址</a></p>
<ol>
<li><p>OS选择macOSx64，包选择TGZ，点击下载。</p>
</li>
<li><p>把下载文件移至<code>/usr/local</code>下，进行解压缩。</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf mongodb-macos-x86_64-4.2.5.tgz</span><br><span class="line">sudo mv mongodb-osx-x86_64-4.2.5/ mongodb  //重命名</span><br></pre></td></tr></table></figure>
<ol>
<li>将bin目录下的文件放入<code>/usr/local/bin</code>下</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /usr/local/mongodb/bin/* /usr/local/bin/</span><br></pre></td></tr></table></figure>
<!-----more------->
<p>建立存放数据目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /usr/local/var/mongodb    //mongod进程写入数据文件</span><br><span class="line">sudo mkdir -p /usr/local/var/log/mongodb		//创建mongod进程产生的log文件</span><br></pre></td></tr></table></figure>
<p>注意：在macOS 10.15 Catalina后，Apple限制了MongDB存放数据的默认地址<code>/data/db</code>。所以我们必须使用不同的数据目录。比如<code>/usr/local/var/mongodb</code>。</p>
<p>设置文件的拥有者</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chown my_mongodb_user /usr/local/var/mongodb</span><br><span class="line">sudo chown my_mongodb_user /usr/local/var/log/mongodb</span><br></pre></td></tr></table></figure>
<p>运行</p>
<p>使用命令行开启mongod</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --dbpath /usr/local/var/mongodb --logpath /usr/local/var/log/mongodb/mongo.log --fork</span><br></pre></td></tr></table></figure>
<p>使用config文件开启</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --config /usr/local/etc/mongod.conf</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用tar包安装的mongod没有创建<code>mongod.conf</code>文件。</p>
</blockquote>
<p>查看是否开启</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep -v grep | grep mongod</span><br></pre></td></tr></table></figure>
<p>确认完毕在终端输入mongo即可开启mongoDB</p>
<h3 id="使用Brew安装"><a href="#使用Brew安装" class="headerlink" title="使用Brew安装"></a>使用Brew安装</h3><p>准备：</p>
<p>需要Xcode、Homebrew。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew tap mongodb/brew</span><br><span class="line">brew install mongodb-community@4.2</span><br></pre></td></tr></table></figure>
<p>使用brew安装，会自动创建如下文件及目录</p>
<blockquote>
<p>the configuration file(<code>/usr/local/etc/mongod.conf</code>)</p>
<p>the log directory path(<code>/usr/local/var/log/mongodb</code>)</p>
<p>the data directory path (<code>/usr/local/var/mongodb</code>)</p>
</blockquote>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>可以使用brew运行MongoDB作为macOS服务，或者手动将其作为后台程序运行。</p>
<ul>
<li>使用brew运行</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew services start mongodb-community@4.2   //开启Mongod进程</span><br><span class="line">brew services stop mongodb-community@4.2		//停止Mongod进程</span><br></pre></td></tr></table></figure>
<ul>
<li>作为后台程序手动开启</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --config /usr/local/etc/mongod.conf --fork</span><br></pre></td></tr></table></figure>
<p>以上都使用<code>usr/local/etc/mongod.conf</code>文件。</p>
<p>同样可以使用以下命令验证mongod是否运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep -v grep | grep mongod</span><br></pre></td></tr></table></figure>
<p>日志文件存放于：<code>/usr/local/var/log/mongodb/mongo.log</code></p>
<p>键入mongo即可使用mongoDB。</p>
<h2 id="MongoDB概述"><a href="#MongoDB概述" class="headerlink" title="MongoDB概述"></a>MongoDB概述</h2><p>MongoDB是一个面向文档的NoSQL数据库，由C++编写，使用类JSON的BSON格式进行数据编码和传输。具有高性能、高可用、可伸缩、易部署等特性，目前非常火爆。</p>
<h2 id="概念解析"><a href="#概念解析" class="headerlink" title="概念解析"></a>概念解析</h2><h3 id="文档数据库"><a href="#文档数据库" class="headerlink" title="文档数据库"></a>文档数据库</h3><p>记录在MongoDB中是一个文档，是一个由键值对组成的数据结构。</p>
<p><img src="/2020/04/20/MongoDB/exp.png" alt="exp"></p>
<p>优势：</p>
<blockquote>
<p>文档可以适应多种本地文件的数据类型</p>
<p>使用嵌入式的文档组织模式减少了表之间的连接需求</p>
<p>很好的动态伸缩性</p>
</blockquote>
<p>MongoDB单个实例可以容纳多个独立的数据库，每一个都有自己的集合和权限，不同数据库克放在不同文件内。</p>
<h3 id="集合-Collections"><a href="#集合-Collections" class="headerlink" title="集合(Collections)"></a>集合(Collections)</h3><p>集合是MongoDB的文档组(Collections)，类似RDBMS中的表格。集合存储于数据库中，没有固定的结构，可以在集合中插入不同格式的数据。如下为一个集合，其中包括多个文档(Documents)。</p>
<p><img src="/2020/04/20/MongoDB/colletions.png" alt="colletions"></p>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p><img src="/2020/04/20/MongoDB/data.png" alt="DataType"></p>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><h3 id="主从模式（Master-Slaver）"><a href="#主从模式（Master-Slaver）" class="headerlink" title="主从模式（Master-Slaver）"></a>主从模式（Master-Slaver）</h3><p><img src="/2020/04/20/MongoDB/Master.png" alt="Master"></p>
<p>由一个主节点和多个从节点组成。</p>
<p>主节点运行MongoDB实例，完成数据存储、查询和修改操作。</p>
<p>从节点不提供任何服务，但可通过设置是其具有查询服务，从而减轻主节点压力。</p>
<p>主节点出现故障，只能人工介入，指定新的主节点，从节点不会自动升级主节点，此时集群处于只读状态。</p>
<h3 id="副本集模式-Replication"><a href="#副本集模式-Replication" class="headerlink" title="副本集模式(Replication)"></a>副本集模式(Replication)</h3><p>官方参考：<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/replication/">Replication</a></p>
<p><img src="/2020/04/20/MongoDB/replication.png" alt="replication"></p>
<p>主节点负责数据写入和更新，负责指定其他节点为从节点，并设置从节点的可读性。</p>
<p>在主节点发生故障时，有额外仲裁节点会参与选举新节点作为主节点。</p>
<p>副本集模式可以解决主节点发生故障导致数据丢失或不可用问题，但遇到存储海量数据情况时，就束手无策了。</p>
<h3 id="分片模式（Sharding）"><a href="#分片模式（Sharding）" class="headerlink" title="分片模式（Sharding）"></a>分片模式（Sharding）</h3><p>官方参考: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/sharding/">Sharding</a></p>
<p><img src="/2020/04/20/MongoDB/sharding.png" alt="sharding"></p>
<p>分片服务器（Shard Server）：每个分片服务器都是一个mongod数据库实例，用于存储实际的数据块。<strong>整个数据库集合分成多个块存储在不同分片服务器中</strong>。</p>
<p>配置服务器（Config Server）：保存集合和分片的元数据。</p>
<p>路由服务器（Route Server）：在集群中作为路由使用，客户端由此介入。路由服务器本身不保存数据，启动时从配置服务器加载集群信息到缓存中，并将客户端的请求路由给每个分片服务器，将各个分片服务器的返回结果进行聚合并返回客户端。</p>
<h2 id="Shell操作"><a href="#Shell操作" class="headerlink" title="Shell操作"></a>Shell操作</h2><h3 id="一-创建库与集合操作"><a href="#一-创建库与集合操作" class="headerlink" title="一. 创建库与集合操作"></a>一. 创建库与集合操作</h3><ol>
<li>创建一个名为library的数据库</li>
</ol>
<p>创建数据库的语法为<code>use DATABASE_NAME</code></p>
<p><code>use library</code></p>
<ol>
<li>在library数据库中创建名为book的集合</li>
</ol>
<p>创建集合<code>db.createCollection(&quot;book&quot;)</code></p>
<ol>
<li>将集合book重命名为new_book</li>
</ol>
<p>修改集合的语法为<code>db.collection.renameCollection(target, dropTarget)</code>，其中dropTarget为可选参数，如果为true，则mongod会在先删除原有集合。</p>
<p><code>db.collection.renameCollection(&quot;new_book&quot;)</code></p>
<ol>
<li>查看集合new_book的信息</li>
</ol>
<p>查询数据的语法为<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.find/#db.collection.find"><code>db.collection.find(query, projection)</code></a>；query，document类型，使用查询操作符指定的查询条件；projection，document类型，使用投影操作副返回的键。</p>
<p><code>db.collection.find()</code></p>
<ol>
<li>删除集合new_books</li>
</ol>
<p>删除集合的语法为<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.drop/"><code>db.collection.drop()</code></a>，</p>
<p><code>db.new_book.drop()</code></p>
<p>6.删除数据库library</p>
<p>删除数据库语法为<code>db.dropDatabase(&lt;option&gt;)</code></p>
<p><code>db.dropDatabase()</code></p>
<h3 id="二：文档插入"><a href="#二：文档插入" class="headerlink" title="二：文档插入"></a>二：文档插入</h3><p>文档插入有三种方式，分别为<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.insert/"><code>db.collection.insert()</code></a>，<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.insertOne/"><code>db.collection.insertOne()</code></a>，[<code>db.collection.insertMany()</code>()]；</p>
<p>insert( )语法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> db.collection.insert(</span><br><span class="line">   &lt;document or array of documents&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     writeConcern: &lt;document&gt;,</span><br><span class="line">     ordered: &lt;boolean&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line"><span class="meta">#</span><span class="bash"> Example</span></span><br><span class="line">db.products.insert( &#123; item: &quot;card&quot;, qty: 15 &#125; )</span><br></pre></td></tr></table></figure>
<p>insertone( )语法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insertOne(</span><br><span class="line">   &lt;document&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">      writeConcern: &lt;document&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line"><span class="meta">#</span><span class="bash"> Examples:</span></span><br><span class="line">try &#123;</span><br><span class="line">   db.products.insertOne( &#123; item: &quot;card&quot;, qty: 15 &#125; );</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">   print (e);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>insertmany( )语法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insertMany(</span><br><span class="line">   [ &lt;document 1&gt; , &lt;document 2&gt;, ... ],</span><br><span class="line">   &#123;</span><br><span class="line">      writeConcern: &lt;document&gt;,</span><br><span class="line">      ordered: &lt;boolean&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line"><span class="meta">#</span><span class="bash"> Examples：</span></span><br><span class="line">try &#123;</span><br><span class="line">   db.products.insertMany( [</span><br><span class="line">      &#123; _id: 10, item: &quot;large box&quot;, qty: 20 &#125;,</span><br><span class="line">      &#123; _id: 11, item: &quot;small box&quot;, qty: 55 &#125;,</span><br><span class="line">      &#123; _id: 12, item: &quot;medium box&quot;, qty: 30 &#125;</span><br><span class="line">   ] );</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">   print (e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/04/20/MongoDB/insert.png" alt="insert"></p>
<p>在插入文档时注意<code>[ ]</code>的使用，例如：</p>
<ol>
<li>在school数据库中按下表创建表示班级grade_1_2的集合，并插入相应文档：</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th>name</th>
<th>sex</th>
<th>age</th>
<th>hobby</th>
<th>telephone</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>fixed</td>
<td>mobile</td>
</tr>
<tr>
<td>Tom</td>
<td>M</td>
<td>18</td>
<td>Football, skiing</td>
<td>84833380</td>
<td>13840957289</td>
</tr>
<tr>
<td>Lisi</td>
<td>M</td>
<td>18</td>
<td>Swimming</td>
<td></td>
<td>15543789567</td>
</tr>
<tr>
<td>Jack</td>
<td>M</td>
<td>20</td>
<td>Baseball</td>
<td>84833380</td>
<td>17656775563</td>
</tr>
<tr>
<td>Joan</td>
<td>F</td>
<td>22</td>
<td></td>
<td>84832281</td>
<td>13840957289</td>
</tr>
<tr>
<td>Marry</td>
<td>F</td>
<td>25</td>
<td>Table tennis</td>
<td></td>
<td>15543789567</td>
</tr>
</tbody>
</table>
</div>
<p>其中hobby部分设计多个项目，如果使用<code>&#123;name:&quot;Zhangsan&quot;,sex:&quot;M&quot;,age:20,hobby:&quot;Swimming&quot;,&quot;basketball&quot;,telephone:&#123;fixed:&quot;84833380&quot;,mobile:&quot;13840957289&quot;&#125;&#125;</code>，后期会导致查询方面的问题。</p>
<p>应该使用<code>[ ]</code>将其中的内容括起来:<code>&#123;name:&quot;Zhangsan&quot;,sex:&quot;M&quot;,age:20,hobby:[&quot;Swimming&quot;,&quot;basketball&quot;],telephone:&#123;fixed:&quot;84833380&quot;,mobile:&quot;13840957289&quot;&#125;&#125;</code></p>
<p>上述插入操作如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.insertMany([</span><br><span class="line">&#123;name:&quot;Tom&quot;,sex:&quot;M&quot;,age:18,hobby:[&quot;Football&quot;,&quot;Skiing&quot;],telephone:&#123;fixed:&quot;84833380&quot;,mobile:&quot;13840957289&quot;&#125;&#125;,</span><br><span class="line">&#123;name:&quot;Lisi&quot;,sex:&quot;M&quot;,age:18,hobby:&quot;Swimming&quot;,telephone:&#123;fixed:&quot;84833380&quot;,mobile:&quot;17656775563&quot;&#125;&#125;,</span><br><span class="line">&#123;name:&quot;Jack&quot;,sex:&quot;M&quot;,age:20,hobby:&quot;Swimming&quot;,telephone:&#123;fixed:&quot;84832281&quot;,mobile:&quot;13840957289&quot;&#125;&#125;,</span><br><span class="line">&#123;name:&quot;Joan&quot;,sex:&quot;F&quot;,age:22&#125;,</span><br><span class="line">&#123;name:&quot;Marry&quot;,sex:&quot;F&quot;,age:25,hobby:&quot;Table tennis&quot;,telephone:&#123;mobile:&quot;15543789567&quot;&#125;&#125;</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<h3 id="三：简单文档增查"><a href="#三：简单文档增查" class="headerlink" title="三：简单文档增查"></a>三：简单文档增查</h3><p>文档查询一般使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.find/"><code>db.collection.find(query, projection)</code></a></p>
<p>query：document类型，可选，使用查询操作运算符；</p>
<p>project：document类型，指定投影操作符返回字段，{ field1: <value>, field2: <value> … }，value为0不显示，1显示。</value></value></p>
<p>查询选择器参考：<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/query/#query-selectors">Query Selectors</a></p>
<p><strong>多条件查询</strong>：</p>
<p><img src="/2020/04/20/MongoDB/Multiple.png" alt="multiple"></p>
<p><strong>查询数组元素参考</strong>：</p>
<p><img src="/2020/04/20/MongoDB/arrary.png" alt="array"></p>
<p><strong>其中对查询数据进行重新整理的行为参考如下</strong>：</p>
<p><img src="/2020/04/20/MongoDB/cusorbehavior.png" alt="cusorbehavior"></p>
<p><strong>练习内容：</strong></p>
<ol>
<li>查看一年级二班grade_1_2中所有年龄大于 20 岁并且小于25 岁的学生</li>
</ol>
<p><code>db.grade_1_2.find(&#123;age:&#123;$gt:20,$lt:25&#125;&#125;)</code></p>
<ol>
<li>查看一年级二班grade_1_2中所有年龄大于 20 岁并且性别值为M的学生</li>
</ol>
<p><code>db.grade_1_2.find(&#123;age:&#123;$gt:20&#125;,&quot;sex&quot;:&quot;M&quot;&#125;)</code></p>
<ol>
<li>查看一年级二班grade_1_2中所有兴趣爱好为Football的学生</li>
</ol>
<p><code>db.grade_1_2.find(&#123;&quot;hobby&quot;:&quot;Football&quot;&#125;)</code></p>
<ol>
<li>查看一年级二班grade_1_2中所有兴趣爱好既包括Football又包括Skiing的学生</li>
</ol>
<p><code>db.grade_1_2.find(&#123;&quot;hobby&quot;:&#123;$all:[&quot;Football&quot;,&quot;Sking&quot;]&#125;&#125;)</code></p>
<ol>
<li>扩展：查看一年级二班grade_1_2中所有兴趣爱好既包括Football或Skiing的学生</li>
</ol>
<p><code>db.grade_1_2.find(&#123;&quot;hobby&quot;:&#123;$in:[&quot;Football&quot;,&quot;Sking&quot;]&#125;&#125;)</code></p>
<ol>
<li>查看一年级二班grade_1_2中所有兴趣爱好两个以上的学生</li>
</ol>
<p><code>db.grade_1_2.find(&#123;hobby:&#123;$size:2&#125;&#125;)</code></p>
<ol>
<li>查看一年级二班grade_1_2中所有兴趣爱好两个以上的学生的数量</li>
</ol>
<p><code>db.grade_1_2.find(&#123;hobby:&#123;$size:2&#125;&#125;).count()</code></p>
<ol>
<li><p>查看一年级二班grade_1_2的第二位学生</p>
</li>
<li><p>使用skip跳过第一个同学</p>
</li>
</ol>
<p><code>db.grade_1_2.find().limit(1).skip(1)</code></p>
<ol>
<li>查看一年级二班grade_1_2的学生，按年纪升序</li>
</ol>
<p><code>db.grade_1_2.find().sort(&#123;&quot;age&quot;: 1&#125;)</code> [ -1 为降序 ]</p>
<h3 id="四：数据删除相关"><a href="#四：数据删除相关" class="headerlink" title="四：数据删除相关"></a>四：数据删除相关</h3><p>数据删除主要使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.remove/"><code>db.collection.remove()</code></a>，语法如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.collection.remove(</span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     justOne: &lt;boolean&gt;,</span><br><span class="line">     writeConcern: &lt;document&gt;,</span><br><span class="line">     collation: &lt;document&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line"><span class="meta">#</span><span class="bash"> justone: 默认<span class="literal">false</span>，删除所有匹配条件的数据，若改为<span class="literal">true</span>，则仅删除第一条。</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>练习内容：</strong></p>
<ol>
<li>删除一年级二班grade_1_2所有 20 岁的学生</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.remove(&#123;age:20&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>删除一年级二班grade_1_2第一位18岁的学生</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.remove(&#123;&quot;age&quot;: 18&#125;, &#123;justOne: 1&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>删除一年级三班grade_1_3所有爱好football的学生</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.remove(&#123;&quot;hobby&quot;:&quot;football&quot;&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="五：更新文档"><a href="#五：更新文档" class="headerlink" title="五：更新文档"></a>五：更新文档</h3><p>对文章内容进行更新修改，一般使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.update/"><code>db.collection.update()</code></a></p>
<blockquote>
<p>Modifies an existing document or documents in a collection. The method can modify specific fields of an existing document or documents or replace an existing document entirely, depending on the <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.update/#update-parameter">update parameter</a>.</p>
</blockquote>
<p>语法如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.collection.update(</span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &lt;update&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     upsert: &lt;boolean&gt;,</span><br><span class="line">     multi: &lt;boolean&gt;,</span><br><span class="line">     writeConcern: &lt;document&gt;,</span><br><span class="line">     collation: &lt;document&gt;,</span><br><span class="line">     arrayFilters: [ &lt;filterdocument1&gt;, ... ],</span><br><span class="line">     hint:  &lt;document|string&gt;        // Available starting in MongoDB 4.2</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>Update的操作符：<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/#id1">Update Operators</a></p>
<p><strong>Fields</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/currentDate/#up._S_currentDate"><code>$currentDate</code></a></td>
<td style="text-align:left">Sets the value of a field to current date, either as a Date or a Timestamp.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/inc/#up._S_inc"><code>$inc</code></a></td>
<td style="text-align:left">Increments the value of the field by the specified amount.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/min/#up._S_min"><code>$min</code></a></td>
<td style="text-align:left">Only updates the field if the specified value is less than the existing field value.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/max/#up._S_max"><code>$max</code></a></td>
<td style="text-align:left">Only updates the field if the specified value is greater than the existing field value.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/mul/#up._S_mul"><code>$mul</code></a></td>
<td style="text-align:left">Multiplies the value of the field by the specified amount.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/rename/#up._S_rename"><code>$rename</code></a></td>
<td style="text-align:left">Renames a field.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/set/#up._S_set"><code>$set</code></a></td>
<td style="text-align:left">Sets the value of a field in a document.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/setOnInsert/#up._S_setOnInsert"><code>$setOnInsert</code></a></td>
<td style="text-align:left">Sets the value of a field if an update results in an insert of a document. Has no effect on update operations that modify existing documents.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/unset/#up._S_unset"><code>$unset</code></a></td>
<td style="text-align:left">Removes the specified field from a document.</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Array</strong></p>
<p>Operators</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/addToSet/#up._S_addToSet"><code>$addToSet</code></a></td>
<td style="text-align:left">Adds elements to an array only if they do not already exist in the set.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/pop/#up._S_pop"><code>$pop</code></a></td>
<td style="text-align:left">Removes the first or last item of an array.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/pull/#up._S_pull"><code>$pull</code></a></td>
<td style="text-align:left">Removes all array elements that match a specified query.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/push/#up._S_push"><code>$push</code></a></td>
<td style="text-align:left">Adds an item to an array.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/pullAll/#up._S_pullAll"><code>$pullAll</code></a></td>
<td style="text-align:left">Removes all matching values from an array.</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Modifiers</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/each/#up._S_each"><code>$each</code></a></td>
<td style="text-align:left">Modifies the <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/push/#up._S_push"><code>$push</code></a> and <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/addToSet/#up._S_addToSet"><code>$addToSet</code></a> operators to append multiple items for array updates.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/position/#up._S_position"><code>$position</code></a></td>
<td style="text-align:left">Modifies the <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/push/#up._S_push"><code>$push</code></a> operator to specify the position in the array to add elements.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/slice/#up._S_slice"><code>$slice</code></a></td>
<td style="text-align:left">Modifies the <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/push/#up._S_push"><code>$push</code></a> operator to limit the size of updated arrays.</td>
</tr>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/sort/#up._S_sort"><code>$sort</code></a></td>
<td style="text-align:left">Modifies the <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/push/#up._S_push"><code>$push</code></a> operator to reorder documents stored in an array.</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Bitwise</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/update/bit/#up._S_bit"><code>$bit</code></a></td>
<td style="text-align:left">Performs bitwise <code>AND</code>, <code>OR</code>, and <code>XOR</code> updates of integer values.</td>
</tr>
</tbody>
</table>
</div>
<p>以官方为例，创建Collections如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">db.books.remove(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">db.books.insertMany([</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;_id&quot; : 1,</span><br><span class="line">    &quot;item&quot; : &quot;TBD&quot;,</span><br><span class="line">    &quot;stock&quot; : 0,</span><br><span class="line">    &quot;info&quot; : &#123; &quot;publisher&quot; : &quot;1111&quot;, &quot;pages&quot; : 430 &#125;,</span><br><span class="line">    &quot;tags&quot; : [ &quot;technology&quot;, &quot;computer&quot; ],</span><br><span class="line">    &quot;ratings&quot; : [ &#123; &quot;by&quot; : &quot;ijk&quot;, &quot;rating&quot; : 4 &#125;, &#123; &quot;by&quot; : &quot;lmn&quot;, &quot;rating&quot; : 5 &#125; ],</span><br><span class="line">    &quot;reorder&quot; : false</span><br><span class="line">   &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">    &quot;_id&quot; : 2,</span><br><span class="line">    &quot;item&quot; : &quot;XYZ123&quot;,</span><br><span class="line">    &quot;stock&quot; : 15,</span><br><span class="line">    &quot;info&quot; : &#123; &quot;publisher&quot; : &quot;5555&quot;, &quot;pages&quot; : 150 &#125;,</span><br><span class="line">    &quot;tags&quot; : [ ],</span><br><span class="line">    &quot;ratings&quot; : [ &#123; &quot;by&quot; : &quot;xyz&quot;, &quot;rating&quot; : 5 &#125; ],</span><br><span class="line">    &quot;reorder&quot; : false</span><br><span class="line">   &#125;</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<p>inc 与 set 操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.books.update(</span><br><span class="line">   &#123; _id: 1 &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">     $inc: &#123; stock: 5 &#125;,   # stock增加5</span><br><span class="line">     $set: &#123;</span><br><span class="line">       item: &quot;ABC123&quot;,		# 修改item</span><br><span class="line">       &quot;info.publisher&quot;: &quot;2222&quot;,	# 修改info下的publisher</span><br><span class="line">       tags: [ &quot;software&quot; ],	# 修改tags</span><br><span class="line">       &quot;ratings.1&quot;: &#123; by: &quot;xyz&quot;, rating: 3 &#125;	# 修改rating的第一部分</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>push操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.books.update(</span><br><span class="line">   &#123; _id: 2 &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">     $push: &#123; ratings: &#123; &quot;by&quot; : &quot;jkl&quot;, &quot;rating&quot; : 2 &#125; &#125;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>unset操作，移除某filed操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.books.update(&#123;_id:2&#125;,&#123;$unset: &#123;tags:&quot;&quot;&#125;&#125;)</span><br><span class="line"><span class="meta">#</span><span class="bash">same as : db.books.update( &#123; _id: 1 &#125;, &#123; <span class="variable">$unset</span>: &#123; tags: 1 &#125; &#125; )</span></span><br></pre></td></tr></table></figure>
<p>与SQL语句类似，即：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE books</span><br><span class="line">DROP COLUMN tags</span><br></pre></td></tr></table></figure>
<p>文档覆盖操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.books.update(</span><br><span class="line">   &#123; _id: 2 &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">     item: &quot;XYZ123&quot;,</span><br><span class="line">     stock: 10,</span><br><span class="line">     info: &#123; publisher: &quot;2255&quot;, pages: 150 &#125;,</span><br><span class="line">     tags: [ &quot;baking&quot;, &quot;cooking&quot; ]</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><strong>练习内容：</strong></p>
<ol>
<li>修改一年级二班grade_1_2中名为Joan的学生，年龄为 22 岁，兴趣爱好为 dance和drawing</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.update(</span><br><span class="line">&#123;&quot;name&quot;:&quot;Joan&quot;&#125;,&#123;$set:&#123;age:22,&quot;hobby&quot;:[&quot;dancing&quot;,&quot;drawing&quot;]&#125;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol>
<li>追加一年级二班grade_1_2中，名为Joan的学生的兴趣爱好sing</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.update(</span><br><span class="line">&#123;“name”:Joan&#125;,&#123;$push:&#123;“hobby”:sing&#125;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol>
<li>追加一年级二班grade_1_2中，名为Joan的学生的兴趣爱好sing和basketball，要保证hobby数组不重复；</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.update(</span><br><span class="line">&#123;&quot;name&quot;:&quot;Joan&quot;&#125;,&#123;$addToSet:&#123;&quot;hobby&quot;:&#123;$each:[&quot;sing&quot;,&quot;basketball&quot;]&#125;&#125;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol>
<li>新学年，给一年级二班所有学生的年龄都增加一岁</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.update(</span><br><span class="line">&#123;&#125;,</span><br><span class="line">&#123;$inc:&#123;&quot;age&quot;:1&#125;&#125;,&#123;multi:true&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol>
<li>删除一年级二班grade_1_2中，名为Joan的学生的sex属性</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_2.update(</span><br><span class="line">&#123;&quot;name&quot;:&quot;Joan&quot;&#125;,</span><br><span class="line">&#123;$unset:&#123;&quot;sex&quot;:1&#125;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="六：文档聚合"><a href="#六：文档聚合" class="headerlink" title="六：文档聚合"></a>六：文档聚合</h3><p>文档聚合主要用于处理数据并返回计算结果，聚合操作将来自多个文档的值聚合在一起，按条件分组后，再进行一系列操作（求和、平均值、最大值、最小值）以返回单个结果。</p>
<p><strong>聚合管道</strong>是最常用的一种聚合方法，将前一条语句的结果作为第二条语句的输入。</p>
<p>MongoDB聚合管道由阶段组成，每个阶段在文档通过管道时转换文档。</p>
<p>使用<code>db.collection.aggregate(pipeline, options)</code></p>
<p>aggregate( )的阶段参考：<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/">db.collection,aggregate()Stages</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建聚合示例</span></span><br><span class="line">db.orders.insertMany([</span><br><span class="line">&#123; &quot;_id&quot;: 1, &quot;cust_id&quot;: &quot;abc1&quot;, &quot;ord_date&quot;: ISODate(&quot;2012-11-02T17:04:11.102Z&quot;), &quot;status&quot;: &quot;A&quot;, &quot;amount&quot;: 50 &#125;,</span><br><span class="line">&#123;&quot; _id&quot;: 2, &quot;cust_id&quot;: &quot;xyz1&quot;, &quot;ord_date&quot;: ISODate(&quot;2013-10-01T17:04:11.102Z&quot;), &quot;status&quot;: &quot;A&quot;, &quot;amount&quot;: 100 &#125;,</span><br><span class="line">&#123; &quot;_id&quot;: 3, &quot;cust_id&quot;: &quot;xyz1&quot;, &quot;ord_date&quot;: ISODate(&quot;2013-10-12T17:04:11.102Z&quot;), &quot;status&quot;: &quot;D&quot;, &quot;amount&quot;: 25 &#125;,</span><br><span class="line">&#123;&quot; _id&quot;: 4, &quot;cust_id&quot;: &quot;xyz1&quot;, &quot;ord_date&quot;: ISODate(&quot;2013-10-11T17:04:11.102Z&quot;), &quot;status&quot;: &quot;D&quot;, &quot;amount&quot;: 125 &#125;,</span><br><span class="line">&#123;&quot; _id&quot;: 5, &quot;cust_id&quot;: &quot;abc1&quot;, &quot;ord_date&quot;: ISODate(&quot;2013-11-12T17:04:11.102Z&quot;), &quot;status&quot;: &quot;A&quot;, &quot;amount&quot;: 25 &#125;</span><br><span class="line">])</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>分组计算总和：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.orders.aggregate([</span><br><span class="line">                     &#123; $match: &#123; status: &quot;A&quot; &#125; &#125;,</span><br><span class="line">                     &#123; $group: &#123; _id: &quot;$cust_id&quot;, total: &#123; $sum: &quot;$amount&quot; &#125; &#125; &#125;,</span><br><span class="line">                     &#123; $sort: &#123; total: -1 &#125; &#125;</span><br><span class="line">                   ])</span><br><span class="line"><span class="meta">#</span><span class="bash"> 统计所有状态为‘A’，按cust_id分组，计算总价</span></span><br></pre></td></tr></table></figure>
<p><strong>练习内容：</strong></p>
<ol>
<li>统计每名学生在考试中的总分</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_4.aggregate([</span><br><span class="line">&#123;$group:&#123;_id:&quot;$name&quot;,score:&#123;$sum:&#123;$sum:[&quot;$score.chinese&quot;,&quot;$score.math&quot;,&quot;$score.english&quot;]&#125;&#125;&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<ol>
<li>统计每名男生在考试中的总分及平均分</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_4.aggregate([</span><br><span class="line">&#123;$match:&#123;sex:&quot;M&quot;&#125;&#125;,</span><br><span class="line">&#123;$group:&#123;_id:&quot;$name&quot;,score:&#123;$sum:&#123;$sum:[&quot;$score.chinese&quot;,&quot;$score.math&quot;,&quot;$score.english&quot;]&#125;&#125;,</span><br><span class="line">avg:&#123;$avg:&#123;$avg:[&quot;$score.chinese&quot;,&quot;$score.math&quot;,&quot;$score.english&quot;]&#125;&#125;&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<ol>
<li>根据姓名分组，并统计人数</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_4.aggregate([</span><br><span class="line">&#123;$group:&#123;_id:&quot;$name&quot;,numbers:&#123;$sum:1&#125;&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<ol>
<li>根据姓名分组，并统计人数，过滤人数大于2的学生</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_4.aggregate([</span><br><span class="line">&#123;$group:&#123;_id:&quot;$name&quot;,numbers:&#123;$sum:1&#125;&#125;&#125;,</span><br><span class="line">&#123;$match:&#123;numbers:&#123;$gt:2&#125;&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<ol>
<li>统计每名男生在考试中的总分</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.grade_1_4.aggregate([</span><br><span class="line">&#123;$match:&#123;sex:&quot;M&quot;&#125;&#125;,</span><br><span class="line">&#123;$group:&#123;_id:&quot;$name&quot;,score:&#123;$sum:&#123;$sum:[&quot;$score.chinese&quot;,&quot;$score.math&quot;,&quot;$score.english&quot;]&#125;&#125;&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-os-x-tarball/#run-mongod-with-a-configuration-file">MongoDB官方安装教程</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://superming.life/2020/04/14/NoSQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ninja2.jpg">
      <meta itemprop="name" content="AlenZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AlenZhang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/14/NoSQL/" class="post-title-link" itemprop="url">NoSQL</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-04-14 00:17:58" itemprop="dateCreated datePublished" datetime="2020-04-14T00:17:58+08:00">2020-04-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
        </span>
    </span>

  
    <span id="/2020/04/14/NoSQL/" class="post-meta-item leancloud_visitors" data-flag-title="NoSQL" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>2.9k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>3 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>NoSQL( Not only SQL ) 是非关系型数据库的统称，其数据模型采用类似键/值、列族、文档等非关系模型。因为没有固定的表结构，故不存在连接操作，也无ACID约束。</p>
<p><strong>主要特点：</strong></p>
<p>可扩展性：传统的关系型数据库由于其设计约束，很难实现“横向扩展”，只能通过升级硬件来实现“纵向拓展”。而NoSQL数据库的设计初衷就是为了满足“横向扩展”，因此具有很好的水平扩展能力。</p>
<p>数据模型：关系模型是关系数据库的基石，以完备的关系代数理论为基础，保证了业务系统对数据一致性需求，但过多的束缚条件很难满足各新兴业务需求。而NoSQL摒弃各种束缚条件，采用新的模型，允许在一个数据元素中存储不同类型的数据。</p>
<p>云计算：云计算具有很好的水平扩展能力，根据资源使用情况进行自由伸缩，各种动态资源可以动态加入或退出。NoSQL凭良好的横向扩展能力，很好融入云计算环境中，构建基于NoSQL的云数据库服务。</p>
<!----- more ---->
<h3 id="为何兴起？"><a href="#为何兴起？" class="headerlink" title="为何兴起？"></a>为何兴起？</h3><p>随着Web2.0时代以及大数据时代的带来。关系数据库暴露出很多缺陷「在银行、电信等各类商业公司具有较好的需求」，为了满足新兴业务和市场需求，NoSQL应运而生。</p>
<p>关系数据库无法满足Web2.0的需求：无法满足海量数据的管理需求，无法满足数据高并发的需求，无法满足高可扩展性和高可用性需求。</p>
<p>Web2.0特性：通常不要求严格的数据库事务，不要求严格的读写实时性，不包含大量复杂的SQL查询。</p>
<h2 id="NOSQL-vs-RDBMS"><a href="#NOSQL-vs-RDBMS" class="headerlink" title="NOSQL vs RDBMS"></a>NOSQL vs RDBMS</h2><p><img src="/2020/04/14/NoSQL/nosqlvssql.png" alt="nosqlvssql"></p>
<p>以下为NoSQL与关系数据库(Relatioal DataBase Management System)之间的比较。</p>
<p><img src="/2020/04/14/NoSQL/compare1.png" alt="compare1"></p>
<p><img src="/2020/04/14/NoSQL/compare2.png" alt="compare1"></p>
<p><img src="/2020/04/14/NoSQL/compare3.png" alt="compare1"></p>
<p>由上图比较可见，<strong>关系数据库</strong>优势在于以完善的关系代数理论作为基础，具有严格的标准，支持ACID四性并且可以实现高效的查询，技术成熟且开发环境支持良好。劣势在于其可扩展性较差，无法较好支持海量的数据存储，数据模型过于死板，无法很好支持Web2.0应用。事务机制影响系统整体性能等。    <strong>NoSQL数据库</strong>的明显优势在于，可以支持超大规模的数据存储，灵活的数据模型，同时具备良好的横向扩展能力。其劣势在于：很难实现数据完整性，缺乏数学理论基础，复杂性查询性能不高，一般不能实现事务的强一致性，维护较为困难。很重要的一个局限在于NoSQL没有一个统一的查询语言，各自独立，这将拖慢NoSQL发展。</p>
<p>综上，两者各有所长，都具有各自的用户群体和市场，根据需求选择。</p>
<h2 id="NoSQL四大类型"><a href="#NoSQL四大类型" class="headerlink" title="NoSQL四大类型"></a>NoSQL四大类型</h2><p>NoSQL数据库数量众多，主要分为四大类型：<strong>键值数据库、列族数据库、文档数据库和图数据库</strong>。</p>
<p><img src="/2020/04/14/NoSQL/type.png" alt="compare1"></p>
<p><img src="/2020/04/14/NoSQL/NoSQLfamily.png" alt="NoSQLfamily"></p>
<h3 id="键值数据库"><a href="#键值数据库" class="headerlink" title="键值数据库"></a>键值数据库</h3><p>键值数据库（Key-Value Database）使用一个哈希表，表中有一个特定Key和一个指针指向特定的Value。Key可以定位Value，即检索具体的Value。<strong>适合大量写操作的情况</strong>。</p>
<p><img src="/2020/04/14/NoSQL/keyvalue.png" alt="compare1"></p>
<h3 id="列族数据库"><a href="#列族数据库" class="headerlink" title="列族数据库"></a>列族数据库</h3><p>一般采用列族数据模型，数据库由多个行构成，每个数据包括多个列族，不同的行可以有不同数量的列族，属于统一列族的数据会存放在一起。每行数据通过行键进行定位，与这个行键对应的是一个列族，从该角度看，列族数据库可被视为键值数据库。</p>
<p><img src="/2020/04/14/NoSQL/column.png" alt="compare1"></p>
<h3 id="文档数据库"><a href="#文档数据库" class="headerlink" title="文档数据库"></a>文档数据库</h3><p>文档是文档数据库最小单位。文档数据库通过键来进行定位一个文档，为键值数据库的衍生品，比键值数据库有更好的查询效率。一个文档可以包含非常复杂的数据结构，如嵌套对象，且不需要特定的数据模式。**文档数据库即可以根据键（Key）构建索引，也可以基于文档内容构建索引，后者为其与键值数据库的主要差别。</p>
<p><img src="/2020/04/14/NoSQL/doc.png" alt="compare1"></p>
<h3 id="图数据库"><a href="#图数据库" class="headerlink" title="图数据库"></a>图数据库</h3><p>图数据库以图论为基础，一个图表示一个对象集合，包括顶点以及连接顶点的边。可以高效地存储不同顶点之间的关系。图数据库专门用于处理具有高度相互关联关系的数据，可以高效处理实体之间的关系，适合社交网络、模式识别、依赖分析等问题。</p>
<p><img src="/2020/04/14/NoSQL/map.png" alt="compare1"></p>
<h2 id="NoSQL三大基石"><a href="#NoSQL三大基石" class="headerlink" title="NoSQL三大基石"></a>NoSQL三大基石</h2><p>NoSQL三大基石包括CAP、BASE和最终一致性。</p>
<h3 id="CAP"><a href="#CAP" class="headerlink" title="CAP"></a>CAP</h3><p><strong>C(Consistency)</strong>:一致性，是指任何一个读操作总是能够读到之前完成的写操作的结果，也就是在分布式环境中，多点的数据是一致的，即<strong>所有节点在同一时间具有相同的数据。</strong></p>
<p><strong>A(Availability)</strong>:可用性，是指快速获取数据，可以在确定的时间内返回操作结果，<strong>保证每个请求不管成功或者失败都有响应**</strong>。</p>
<p><strong>P(Tolerance of Network Partition)</strong>:分区容错性，是指当出现网络分区的情况时(即系统中的一部分节点无法和其他节点进行通信)，分离的系统也能够正常运行，即<strong>系统中任意信息的丢失或失败不会影响系统的继续运作。</strong></p>
<p>但是一个分布式系统不可能同时满足以上三个需求，最多只能满足其中的两个。</p>
<p><img src="/2020/04/14/NoSQL/cap.png" alt="cap"></p>
<h3 id="BASE"><a href="#BASE" class="headerlink" title="BASE"></a>BASE</h3><p>BASE: Basically Availble, Soft-state, Eventual consistency。</p>
<p>Basically Availble：基本可用。指允许一个分布式系统的一部分发生问题变得不可用时，其余部分仍可以正常使用，即允许分区失败的情形出现。</p>
<p>Soft-state:软状态。指的是状态有一段时间不同步，允许一定的滞后性。</p>
<p>Eventual Consistency：最终一致性。分为强一致性和弱一致性。区别在于高并发数据访问的情况下，后续操作能否<strong>及时</strong>获得最新数据。最终一致性是弱一致性的一种特例，允许后续的访问操作可以暂时读不到更新后的数据，但一段时间后，必须读到更新后的数据。</p>
<blockquote>
<p>最常见的实现最终一致性的系统是DNS(域名系统)。一个域名更 新操作根据配置的形式被分发出去，并结合有过期机制的缓存;最终所有的客户端可以看到最新的值。</p>
</blockquote>
<h3 id="Eventual-consistency"><a href="#Eventual-consistency" class="headerlink" title="Eventual consistency"></a>Eventual consistency</h3><p>最终一致性，需要从两个角度来考虑。<strong>从服务端看</strong>，一致性指更新如何复制分布到整个系统，以保证数据的最终一致。<strong>从客户端来看</strong>，一致性主要指高并发的数据访问操作下，后续操作能否获得最新数据。「关系数据库通常实现强一致性，即一个更新完成，后续访问可立即读取更新后的数据。」弱一致而言，则无法保证。</p>
<p><strong>最终一致性要求很低，只要经过一段时间后能够访问到更新数据即可。</strong></p>
<p>最终一致性根据更新数据后各进程访问到数据的时间和方式的不同， 又可以区分为:</p>
<blockquote>
<p>因果一致性：如果进程A通知进程B它已更新了一个数据项，那么进程B 的后续访问将获得A写入的最新值。而与进程A无因果关系的进程C的访问， 仍然遵守一般的最终一致性规则 。</p>
<p>“读己之所写”一致性：可以视为因果一致性的一个特例。当进程A自 己执行一个更新操作之后，它自己总是可以访问到更新过的值，绝不会看 到旧值 。</p>
<p>单调读一致性：如果进程已经看到过数据对象的某个值，那么任何后续 访问都不会返回在那个值之前的值。</p>
<p>会话一致性：它把访问存储系统的进程放到会话(session)的上下文中， 只要会话还存在，系统就保证“读己之所写”一致性。如果由于某些失败 情形令会话终止，就要建立新的会话，而且系统保证不会延续到新的会话 。</p>
<p>单调写一致性：系统保证来自同一个进程的写操作顺序执行。系统必须 保证这种程度的一致性，否则就非常难以编程了。</p>
</blockquote>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>简单介绍了NoSQL数据库相关知识以及与传统数据库的对比。但并非可以偏袒或夸大某方，两者各有所长，为了满足市场的差异化需求而存在。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://superming.life/2020/03/24/03-Hbase/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ninja2.jpg">
      <meta itemprop="name" content="AlenZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AlenZhang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/24/03-Hbase/" class="post-title-link" itemprop="url">HBase</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-03-24 18:17:58" itemprop="dateCreated datePublished" datetime="2020-03-24T18:17:58+08:00">2020-03-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
        </span>
    </span>

  
    <span id="/2020/03/24/03-Hbase/" class="post-meta-item leancloud_visitors" data-flag-title="HBase" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>6k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>5 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="HBase"><a href="#HBase" class="headerlink" title="HBase"></a>HBase</h1><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><blockquote>
<p>MacOS 10.15.3    /    Hadoop 3.2.1    /    Hbase  1.3.5</p>
</blockquote>
<p>使用shell命令安装Hbase</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install Hbase</span><br></pre></td></tr></table></figure>
<p>默认安装的hbase1.3.5，安装目录如下：<code>/usr/local/Cellar/hbase/1.3.5</code>。</p>
<p>配置：Hbase有两个运行模式，分别为单机模式和分布式模式。分布式又分为伪分布式和完全分布式，下面配置伪分布式模式。其余配置请参考<a target="_blank" rel="noopener" href="https://hbase.apache.org/book.html">HBase文档</a>。</p>
<p><code>在确保Hbase停止的情况下进行如下配置。</code></p>
<ul>
<li>修改hbase-env.sh</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HBASE_MANAGES_ZK=<span class="literal">true</span></span><br><span class="line"><span class="built_in">export</span> HBASE_HOME=/usr/<span class="built_in">local</span>/Cellar/hbase/1.3.5/libexec</span><br></pre></td></tr></table></figure>
<p>第一个配置使用Hbase自带的Zookeeper，而非单独加载外部的。</p>
<!--- more ----->
<ul>
<li>修改hbase-site.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:9000/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>修改<code>hbase.rootdir</code>地址可参见Hadoop配置文件<code>core-site.xml</code>下的<code>fs.default.name</code>值。</p>
<p>为了使用方便，我们可以在shell配置文件下使用以下命令。</p>
<p><code>export PATH=$PATH:/usr/local/Cellar/hbase/1.3.5/bin</code></p>
<p>运行Hbase：</p>
<p>类似HDFS，先运行hadoop伪分布，再运行Hbase。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start-dfs.sh</span><br><span class="line">start-hbase.sh</span><br></pre></td></tr></table></figure>
<p>使用<code>jps</code>查看<code>HMaster</code>、<code>HQuorumPeer</code>和HRegionServer进程是否运行。</p>
<p><img src="/2020/03/24/03-Hbase/flow.png" alt="flow" style="zoom:50%;"></p>
<h2 id="HBase-1"><a href="#HBase-1" class="headerlink" title="HBase"></a>HBase</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>HBase是一种构建在HDFS之上的分布式、面向列的存储系统，是一个高可靠、高性能、面向列、可伸缩的分布式数据库，用于存储非结构化和半结构化的松散数据，在需要实时读写、随机访问超大数据集时具有极大优势。</p>
<h3 id="生态关系"><a href="#生态关系" class="headerlink" title="生态关系"></a>生态关系</h3><p>HBase在Hadoop生态中与其他部分的关系。</p>
<blockquote>
<p>HBase利用Hadoop MapReduce来处理HBase中的海量数据，实现<strong>高性能计算</strong>。</p>
<p>Zookeeper作为协同服务，实现<strong>稳定服务和失败恢复</strong>。</p>
<p>使用HDFS作为高可靠底层数据存储，<strong>利用廉价集群提供海量数据存储能力</strong>。</p>
<p>Sqoop为HBase提供高效、<strong>便捷的RDBMS（Relational Database Management System）数据导入功能</strong>。</p>
<p>Pig和Hive为HBase提供<strong>高层语言支持</strong>。</p>
</blockquote>
<p><img src="/2020/03/24/03-Hbase/Hbase-relenvent.png" alt="Hbase-relenvent"></p>
<h3 id="为什么需要HBase"><a href="#为什么需要HBase" class="headerlink" title="为什么需要HBase"></a>为什么需要HBase</h3><p>Hadoop主要解决大规模数据的离线批量处理，无法满足大规模数据实时处理应用的需求。HDFS面向批量访问模式，而非随机访问模式    ——&gt; HBase支持数据的随机访问模式，提供在线实时数据分析处理。</p>
<p>传统的关系型数据库无法应对在数据规模剧增时导致的系统扩展性和性能问题    ——&gt;     Hbase支持分布式存储，易于横向拓展，性能高，且支持动态调整。</p>
<p>HBase与传统数据库之间优劣分析</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>对比</th>
<th>HBase</th>
<th>传统关系数据库</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据类型</td>
<td>把数据存储为未经解释的字符串，用户可以把不同格式的数据存入其中</td>
<td>关系模型具有丰富的数据类型和存储方式</td>
</tr>
<tr>
<td>数据操作</td>
<td>采用单表的主键查询，操作功能简单</td>
<td>操作丰富，表简通过主外键关联，操作较复杂</td>
</tr>
<tr>
<td>存储模式</td>
<td>列存储，不同列族文件分离存储，可以降低I/O开销，支持大量并发用户查询</td>
<td>基于行存储，被连续存在磁盘页中，需要顺序扫描每个元组，筛选出需要属性，会浪费磁盘空间和内存带宽</td>
</tr>
<tr>
<td>数据索引</td>
<td>只有行键作为索引</td>
<td>针对不同列构建复杂的索引，提高数据访问性能</td>
</tr>
<tr>
<td>数据维护</td>
<td>执行更新操作时，并不会删除数据旧的版本，而是生成新的版本</td>
<td>更新操作使用新的值去覆盖旧的值</td>
</tr>
<tr>
<td>可伸缩性</td>
<td>可以轻易通过在集群中增加或减少硬件数量实现伸缩</td>
<td>很难实现<strong>横向扩展</strong></td>
</tr>
</tbody>
</table>
</div>
<p>局限：Hbase不支持事务，无法实现跨行原子性。</p>
<h3 id="数据模型概述"><a href="#数据模型概述" class="headerlink" title="数据模型概述"></a>数据模型概述</h3><p>HBase是一个稀疏、多维度、排序的映射表，索引是行键、列族、列限定符和时间戳。每个值是未经解释的字符串，没有数据类型。<strong>每一行都有一个可排序的行键和任意多的列。</strong></p>
<p><strong>数据模型相关概念</strong></p>
<p><img src="/2020/03/24/03-Hbase/table.png" alt="table"></p>
<p>Hbase可以对允许保留的版本数量进行设置。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>概念</th>
</tr>
</thead>
<tbody>
<tr>
<td>表</td>
<td>采用表组织数据，表由行和列族组成，列族划分若干个列限定符</td>
</tr>
<tr>
<td>行</td>
<td>每个HBase由若干行组成，每个行由行键（row key）标示</td>
</tr>
<tr>
<td>列族</td>
<td>一个HBase表被分组为许多“列族”(Column Family)的集合，它是基本的访问控制单元</td>
</tr>
<tr>
<td>列限定符</td>
<td>列族里的数据通过列限定符定位</td>
</tr>
<tr>
<td>单元格</td>
<td>在HBase表中，通过行键、列族和列限定符确定一个“单元格”（cell），单元格中存书的数据没有数据类型，视为字节数据byte[]</td>
</tr>
<tr>
<td>时间戳</td>
<td>每个单元格都保存着同一份数据的多个版本，采用时间戳进行索引</td>
</tr>
<tr>
<td>稀疏表</td>
<td>很多单元没有值</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>HBase按单元格插数据，或按照单元格删除数据</p>
</blockquote>
<h2 id="HBase原理与系统架构"><a href="#HBase原理与系统架构" class="headerlink" title="HBase原理与系统架构"></a>HBase原理与系统架构</h2><h3 id="HBase各组件"><a href="#HBase各组件" class="headerlink" title="HBase各组件"></a>HBase各组件</h3><p><img src="/2020/03/24/03-Hbase/Hbasestructure.png" alt="Hbase structure"></p>
<p>HBase系统架构如上图，包含客户端、Zookeeper服务器、Master服务器、Region服务器。</p>
<p><strong>客户端</strong></p>
<p>包含HBase接口，在缓存中维护已经访问过的Region位置信息以加快后续数据访问。使用RPC机制与Master和Region服务器进行通信。<strong>对于管理类操作，客户端与Master进行RPC；对于数据读写，客户端与Region服务器进行RPC。</strong></p>
<p><strong>Zookeeper</strong></p>
<p>维护集群中机器的服务状态：每一个Region服务器都需要到Zookeeper中进行注册，<strong>Zookeeper实时监控每个Region服务器的状态并通知给Master</strong>，Master就可以通过Zookeeper感知到各个region服务器的工作状态。</p>
<p>选出“总管”：HBase可以启动多个Master，Zookeeper可以选出一个Master作为集群总管，并保证在任何时刻总有唯一一个Master在运行，避免Master<strong>单点失效</strong>。</p>
<p>保存了HBase：mata的位置。</p>
<p><strong>HMaster</strong></p>
<p>对用户表的增删改查操作</p>
<p>在Region分裂或合并后，负责重新调整Region的分布</p>
<p>Master会实时监测集群中的Region服务器，把特定的Region分配到可用Region服务器中，<strong>确保整个集群内部不同Region服务器之间负载均衡</strong></p>
<p>对故障失效的Region服务器上的Region进行迁移</p>
<blockquote>
<p>客户端一般访问HBase上的数据不需要Master参与，客户端可以通过访问Zookeeper获取ROOT表地址，并最终到达相应Region服务器。</p>
<p>对于未被分配的Region：Master给这个Region服务器发送一个请求，把该Region分配给它，Region服务器接受请求并加载数据后变提供服务。</p>
</blockquote>
<p><strong>HRegion服务器</strong><br>Region是HBase最核心的模块。负责维护分配给自己的Region丙响应读写请求。</p>
<p>HBase自身不具备<strong>数据复制和维护数据副本的功能</strong>，而HDFS可以为HBase提供支持。「也可以使用其他任何支持Hadoop接口文件系统作为底层存储）</p>
<p>管理一系列HRegion对象，每个HRegion对象对应table中的一个Region，Region中每个Store对应一个列族。</p>
<p>管理一个HLog对象，存储数据日志，当HRegion发生故障时，利用HLog进行故障恢复。</p>
<p>一台机器上只运行一个RegionServer。</p>
<h3 id="Region服务器工作原理"><a href="#Region服务器工作原理" class="headerlink" title="Region服务器工作原理"></a>Region服务器工作原理</h3><p><img src="/2020/03/24/03-Hbase/HBaseData.png" alt="HBase Data"></p>
<p>上图描述了Region服务器向HDFS文件系统读写数据的基本原理。</p>
<p>Region服务器内部管理了一系列Region对象和一个HLog文件，每个Region对象由多个Store组成，每个Store对应表中一个列族。同时每个Store包含一个MemStore和多个StoreFile。</p>
<blockquote>
<p>HLog：磁盘上的记录文件，记录所有更新操作。</p>
<p>MemStore时内存中的缓存，保存最近更新的数据。</p>
<p>StoreFile：磁盘中的文件，文件是B树结构，方便快速读取。</p>
<p>HFile：是StoreFile的底层实现方式，HFile数据快通常采用压缩方式存储，压缩之后大大减少网络I/O和磁盘I/O。</p>
</blockquote>
<p><strong>用户读写数据的过程</strong></p>
<p>用户读写数据时，会被翻配到对应的Region服务器去执行操作。用户数据首先写入<strong>MemStore</strong>与<strong>HLog</strong>中，当操作写入HLog后，commit( )调用将其返回客户端。</p>
<p>当用户读取数据时，Region服务器先访问<strong>MemStore</strong>缓存，如果数据不在缓存中，然后到<strong>StoreFile</strong>中读取。</p>
<p><strong>缓存的刷新</strong></p>
<p>MemStore缓存容量有限，系统周期性调用Region.flushcache( )把MemStore缓存里面的内容写到磁盘的StoreFile文件中，清空缓存，并在HLog文件中写入一个标记，表示缓存中内容已经被写入StoreFile文件中。每次缓存刷新操作都会在磁盘上生成新的StoreFile。</p>
<p><strong>StoreFile的合并</strong></p>
<p>每次MemStore缓存的刷新操作都会在磁盘上生成一个新的StoreFile，在用户访问Store中某个值时非常耗费时间，因此系统会调用Store.compact( )把多个StoreFile文件合并成一个大文件。次操作耗费资源，会在StoreFile文件数量到一个阈值时出发该操作。「阈值参数：hbase.hstore.compaction.min 默认3，hbase.hstore.compaction.max 默认10」</p>
<p><strong>StoreFile分割</strong></p>
<p>单个StoreFile大小超过阈值后「hbase.hregion.max.filesize」，触发Split操作，当前Region Split成两个Region。原Region下线，2个新生成的Region被HMaster分配到对应的HRegionServer上。</p>
<p>以下两张图解释的很详细</p>
<p><img src="/2020/03/24/03-Hbase/HRegion.png" alt="HRegion"></p>
<p><img src="/2020/03/24/03-Hbase/Store.png" alt="Store"></p>
<blockquote>
<p>注意：合并操作是由文件数量触发的，分裂操作由单个文件大小触发。</p>
</blockquote>
<h3 id="表和Region"><a href="#表和Region" class="headerlink" title="表和Region"></a>表和Region</h3><blockquote>
<p>Region服务器是HBase最核心的模块。</p>
</blockquote>
<p>开始只有一个Region， 后来不断分裂。</p>
<p>Region拆分操作非常快，拆分后Region读取的仍是原存储文件，直到“分裂”过程把存储文件异步写到独立的文件之后，才会读取新文件</p>
<p>需要根据行键的值对表中的行进行分区，每个行区间构成一个分区，称为“Region”</p>
<p>每个Region最佳大小取决于单台服务器的有效处理能力，建议1GB-2GB</p>
<p>同一Region不会被分拆到多个Region服务器，每个Region服务器存储10-1000个Region「每个Region服务器负责管理一个Region集合」</p>
<blockquote>
<p>每个Region都有一个RegionID来标识其唯一性，一个Region标识符“表名 + 开始主键 + RegionID”‘</p>
<p>元数据表(.META表)：这个映射表包含关于Region的元数据，为了加快访问速度，数据存放在Region位置</p>
<p>-ROOT-表：当HBase中Region非常庞大的时候，一个服务器保存不了.MATA.表的条目，就需要存储到不同服务器上，此时.MATA.分裂成多个Region，于是构建了一个新的映射表即：“-ROOT-表”</p>
</blockquote>
<p><img src="/2020/03/24/03-Hbase/HbaseLayer.png" alt="HbaseLayer"></p>
<h4 id="Region定位"><a href="#Region定位" class="headerlink" title="Region定位"></a>Region定位</h4><p>客户端查找zookeeper的meta-region-server节点查询HBase：meta表在哪台HRegionServer上</p>
<p>客户端连接含有HBase:meta表的HRegionServer该表存储了所有Region的行键范围信息,可以查询出需要存取的行键属于那个Region，以及这个Region属于那个HRegionServer</p>
<p>此后，客户端就可以直接连接拥有存取行键Region的HRegionServer，并对其操作</p>
<p>客户端吧meta信息缓存起来，下次进行相同操作就不用加载HBase:meta操作了</p>
<p><img src="/2020/03/24/03-Hbase/RegionLocation.png" alt="Region Location"></p>
<h3 id="HLog工作原理"><a href="#HLog工作原理" class="headerlink" title="HLog工作原理"></a>HLog工作原理</h3><p><strong>HLog实际是为了保证系统容错性而存在的。</strong></p>
<p>HLog文件格式：</p>
<p><img src="/2020/03/24/03-Hbase/HLog.png" alt="HLog"></p>
<blockquote>
<p>Key： HLogKey对象，记录了写入数据的归属信息，包括table、sequence number、timestamp等</p>
<p>Value：HBase的KeyValue对象，对应HFile中的KeyValue</p>
</blockquote>
<p>HBase为每个Region配置了一个HLog文件，是一种<strong>预写式日志(Write Ahead Log)</strong>，换句话说，用户更新数据必须首先写入日志才能写MemStore缓存，直到MemStore缓存内容对应内容被写入磁盘之后，该缓存内容才会被刷新写入磁盘。</p>
<p>Region服务器启动时检查HLog文件，发现更新，则先写入MemStore再刷写到StoreFile。</p>
<p>HLog定期回滚，删除被写入文件中的更新。</p>
<h4 id="数据恢复"><a href="#数据恢复" class="headerlink" title="数据恢复"></a>数据恢复</h4><ol>
<li><p>Zookeeper实时监测Region服务器状态，当某个Region服务器发生故障，Zookeeper通知Master。</p>
</li>
<li><p>Master处理故障Region服务器上遗留的HLog文件。根据每条日志记录所属的<strong>Region对象</strong>对HLog数据进行拆分，分别放到对应Region对象目录下，然后再将失效的Region重新分配到可用的Region服务器中,同时把该Region对象相关的HLog日志记录也发送给相应的Region服务器。</p>
</li>
<li>Region服务领取到分配给自己的Region对象以及相关的HLog日志后，把日志记录中的数据写入到MemStore缓存中，刷新到磁盘的StroeFile文件中，完成数据恢复。</li>
</ol>
<blockquote>
<p>需要强调的是：HBase中，每个Region服务器只需要维护一个HLog文件，所有<strong>Region对象</strong>共用一个HLog。多个Region对象的更新操作导致的日志修改，只需要对HLog进行文件追加即可。缺点在于，当一个Region服务器故障时，需要将HLog按照所属的Region对象进行拆分并分发。</p>
</blockquote>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>主要介绍HBase数据库相关内容。HBase数据库是BigTable的开源实现，和BigTable一样，支持大规模海量数据，分布式并发数据处理效率很高，易于扩展且支持动态伸缩。</p>
<p>HBase实际是一个稀疏、多维、持久化存储的映射表，采用行键、列键和时间戳进行索引，每个值都是未经解释的字符串。</p>
<p>HBase采用分区存储，一个大的表会被拆分为多个Region，这些Region会被分发到不同的服务器上实现分布式存储。</p>
<p>HBase的系统架构包括客户端、Zookeeper服务器、Master、Region服务器。客户端包含访问HBase的接口；Zookeeper服务器负责稳定、可靠的协同服务；Master主要负责表和Region的管理工作；Region服务器负责维护分配给自己的Region，并响应用户的读写请求。</p>
<p>对于HBase实现与编程受限于文章长度并未涉及。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://superming.life/2020/03/20/02-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FHDFS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ninja2.jpg">
      <meta itemprop="name" content="AlenZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AlenZhang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/20/02-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FHDFS/" class="post-title-link" itemprop="url">02-分布式文件系统HDFS</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-03-20 20:57:26" itemprop="dateCreated datePublished" datetime="2020-03-20T20:57:26+08:00">2020-03-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
        </span>
    </span>

  
    <span id="/2020/03/20/02-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FHDFS/" class="post-meta-item leancloud_visitors" data-flag-title="02-分布式文件系统HDFS" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>10k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>9 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="分布式文件系统HDFS"><a href="#分布式文件系统HDFS" class="headerlink" title="分布式文件系统HDFS"></a>分布式文件系统HDFS</h1><h2 id="1-HDFS概述："><a href="#1-HDFS概述：" class="headerlink" title="1. HDFS概述："></a>1. HDFS概述：</h2><p>HDFS（Hadoop Distributed File Syetem），Hadoop框架的核心组件之一。<strong>HDFS是为以流式数据访问模式存储超大文件而设计的文件系统。</strong>主要解决数据分布式存储问题。</p>
<p>HDFS是个高度容错性的系统，适合部署在廉价的机器上，能提供高吞吐量的数据访问，非常适合大规模数据集上的应用。</p>
<h3 id="1-1-设计目标"><a href="#1-1-设计目标" class="headerlink" title="1.1 设计目标"></a>1.1 设计目标</h3><p>设计目标即设计初衷，理解其为何诞生对我们掌握并使用它具有很大帮助。</p>
<p><strong>流式数据访问</strong>：“一次写入，多次读取”，HDFS建立在这个思想之上，简化了数据一致性问题。HDFS设计中考虑了数据批处理，而不是用户交互处理。HDFS为了达到高数据吞吐量从而牺牲了数据访问的延时。</p>
<p><strong>硬件故障</strong>：由于Hadoop适合部署在廉价硬件集群上，而非昂贵且高可靠的硬件上，不可避免会产生硬件错误，HDFS面对硬件故障时，其快速检错与自动恢复时是HDFS架构最核心的目标。</p>
<h3 id="1-2-HDFS设计优劣"><a href="#1-2-HDFS设计优劣" class="headerlink" title="1.2 HDFS设计优劣"></a>1.2 HDFS设计优劣</h3><p>优点：高容错性、适合大量数据批处理、模型简单、成本低…</p>
<p>缺点：流式数据读取拥有很高的数据吞吐率，但导致了很高的延时，不适合低延时数据访问；不适合大量小文件存储，过多小文件会严重影响系统性能；不支持多用户并发写入及修改文件。</p>
<!------more -------->
<h2 id="2-HDFS架构"><a href="#2-HDFS架构" class="headerlink" title="2. HDFS架构"></a>2. HDFS架构</h2><p><img src="/2020/03/20/02-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FHDFS/分布式文件系统HDFS.gif" alt="分布式文件系统HDFS"></p>
<h3 id="2-1-数据存储与组织"><a href="#2-1-数据存储与组织" class="headerlink" title="2.1 数据存储与组织"></a>2.1 数据存储与组织</h3><p>HDFS采用块作为存储单位，默认为128MB，是HDFS读写数据数据的最小单位。注意：<strong>HDFS中小于一个块大小的文件不会占据整个块的空间。</strong></p>
<p><strong>为什么分布式文件系统中采用抽象块来存储数据？</strong></p>
<ol>
<li>抽象的扩大了单个文件所能存储的最大值。假设要存储一个20G的文件，可以采用分布式文件系统存储在10个2G的磁盘上，而使用文件系统，即使你有10个2G的磁盘，你能存储的<strong>最大单个文件大小</strong>为2G。</li>
<li><p>简化存储子系统。存储子系统控制的是块，<strong>简化了存储管理</strong>。「可以很容易的计算出一个磁盘分为了多少块」，同时也消除了对元数据（MetaData）的顾虑，「块仅仅作为一部分存储数据，而文件的元数据，不需要与块一同存储，<u>其他系统就可以正交地管理元数据</u>」</p>
</li>
<li><p>应对损坏的块或机器的故障，每个块会在其他分散机器复制副本，<strong>提高容错性和实用性</strong>。块很适合做这样的复制操作。</p>
</li>
</ol>
<p><strong>为什么HDFS中一个块这么大？</strong></p>
<p>影响文件系统存储文件的事件有两个因素，一是寻址时间，二是数据传输时间。</p>
<p>寻址时间主要取决于数据块的数量，而数据块越大，相对而言寻址事件就越小。</p>
<p>数据传输时间取决于数据大小及磁盘读写速率。</p>
<p><strong>T(存储时间) = T(寻址时间)  + T(传输时间)</strong></p>
<p>如果数据传输时间远远大于数据的寻址时间，那么公式可以简化为<strong>T(存储时间) ≈ T(传输时间)</strong>，而HDFS要的就是这个效果。</p>
<h3 id="2-2-Namenode-和-Datanode"><a href="#2-2-Namenode-和-Datanode" class="headerlink" title="2.2 Namenode 和 Datanode"></a>2.2 Namenode 和 Datanode</h3><p><strong>Namenode</strong>管理文件系统的命名空间（namespace）以及客户端对文件的访问「比如打开、关闭、重命名等」。将信息通过fsimag（命名空间镜像）和edits（编辑日志）的形式永久保存在<strong>本地磁盘</strong>中，Namenode会记录每个文件的每个块所在的数据节点，但不会永久保存，因为信息会在系统启动时由数据节点重建。</p>
<blockquote>
<p>Namespace：支持传统层次型文件组织结构，用户可以创建、删除、移动文件等，但HDFS不支持用户磁盘配额和访问权限控制。</p>
<p>Fsimage文件：用于维护文件系统树以及文件树中所有的文 件和文件夹的元数据信息</p>
<p>Edits文件记录所有针对目录、文件的创建、删除、重命 名等的操作日志。</p>
</blockquote>
<p>Namenode工作机制：</p>
<p><img src="/2020/03/20/02-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FHDFS/Namenodeworkflow.png" alt="Namenodeworkflow"></p>
<p><strong>Datanode</strong>负责它所在的节点上的存储，处理客户端的读写请求，在Namenode的统一调度下进行数据块的创建和、删除和复制。</p>
<p>如果没有Namenode，那么文件系统将无法使用，因为我们无法知道如何通过数据节点上的块来重建文件，故Namenode是HDFS集群中的单点故障(Single point of failure)所在。对于名称节点的保护机制时非常重要的。Hadoop提供了两种方法。</p>
<ol>
<li><p>复制那些组成文件系统元数据持久状态的文件。Hadoop可以通过配置使Namenode在多个文件系统上写入其持久化状态。「一般在配置选择：在本地磁盘写入同时，写入一个远程NFS挂载」 <code>Network File System (NFS) is a distributed file system protocol that allows you to share remote directories over a network</code></p>
</li>
<li><p>运行Secondary Namenode，主要作用是为了防止Edits日志过大导致的问题，主要通过定期合并Edits和fsimage来减少Edits的数据大小。一般在其他单独的计算机上运行，因为需要占用大量CPU和内存。Secondary Namenode还可以作为Namenode 的冷备份，它会保存合并后的fsimage的副本，在名称节点失效后使用。但因为Secondary Namenode相较Namenode是滞后的，损失难以避免。</p>
<p>Secondarynode执行过程：</p>
</li>
</ol>
<p><img src="/2020/03/20/02-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FHDFS/SecondaryNodeworkflow.png" alt="SecondaryNode workflow"></p>
<h3 id="2-3-HDFS-高可用架构（-HDFS-High-Avaiability）"><a href="#2-3-HDFS-高可用架构（-HDFS-High-Avaiability）" class="headerlink" title="2.3 HDFS 高可用架构（ HDFS High Avaiability）"></a>2.3 HDFS 高可用架构（ HDFS High Avaiability）</h3><p><a target="_blank" rel="noopener" href="https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithQJM.html">HDFS High Availability Using the Quorum Journal Manager</a></p>
<p><a target="_blank" rel="noopener" href="https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithNFS.html">HDFS High Availability With NFS</a></p>
<p>[后续补充]</p>
<h3 id="2-4-HDFS-Federation"><a href="#2-4-HDFS-Federation" class="headerlink" title="2.4 HDFS Federation"></a>2.4 HDFS Federation</h3><p><a target="_blank" rel="noopener" href="https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/Federation.html">HDFS Federation</a></p>
<p>[后续补充]</p>
<h2 id="3-HDFS存储"><a href="#3-HDFS存储" class="headerlink" title="3. HDFS存储"></a>3. HDFS存储</h2><h3 id="3-1-数据冗余（Data-redundancy）存储"><a href="#3-1-数据冗余（Data-redundancy）存储" class="headerlink" title="3.1 数据冗余（Data redundancy）存储"></a>3.1 数据冗余（Data redundancy）存储</h3><p>为了保证系统的容错性和可用性，HDFS采用多副本方式对数据进行冗余存储，即一个数据块的内容会放到不同的数据节点上。</p>
<blockquote>
<p>当多个客户访问统一文件时，可以从不同副本中读取数据，加快了数据传输速度。</p>
<p>HDFS节点之间通过网络传输数据，多副本可以很<strong>容易判断数据是否出错。</strong></p>
<p>保证了数据的可靠，避免了单点故障。</p>
</blockquote>
<h3 id="3-2-数据存储策略"><a href="#3-2-数据存储策略" class="headerlink" title="3.2 数据存储策略"></a>3.2 数据存储策略</h3><blockquote>
<p>简单介绍一下HDFS数据读写的相关类。</p>
<p>FileSystem时一个通用文件系统的抽象基类，可被分布式文件系统继承。</p>
<p>DistributedFileSystem是FileSystem在HDFS文件系统中的实现，是Hadoop为FileSystem这个抽象类提供的具体实现之一。</p>
<p>FileSystem的open( )方法返回一个输入流FSDataInputStream对象，create（）方法返回一个输出流FSDataOutputStream对象。「即HDFS文件系统中的具体输入输出流」</p>
<p>Hadoop文件API的起点是FileSysem类，可以通过调用FileSystem.get(Configuration conf)来得到所需的FileSystem实例。</p>
<p>Configuration类的默认实例化方法是以HDFS系统的资源配置为基础。</p>
<p><img src="/2020/03/20/02-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FHDFS/HadoopFilesystem.png" alt="Hadoop Filesystem"></p>
</blockquote>
<h4 id="3-2-1-数据存放"><a href="#3-2-1-数据存放" class="headerlink" title="3.2.1 数据存放"></a>3.2.1 数据存放</h4><p>HDFS默认每个数据节点都是在不同的机架上，会带来一个问题：<strong>写入数据时不能充分利用同一机架内部机器之间的带宽</strong>。但更容易实现系统内部的负载均衡和错误处理。</p>
<p>HDFS默认冗余复制因子为3，每一个文件块被同时保存到三个地方，两个副本放在同一机架不同机器上，第三个副本放在不同机架的机器上面。可以保证机架发生异常时的数据恢复，也可以提高读写性能。</p>
<p><code>hdfs-site.xml</code>配置文件<code>dfs.replication</code>用于修改冗余复制因子</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/Cellar/hadoop/hdfs/tmp/dfs/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/Cellar/hadoop/hdfs/tmp/dfs/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-2-数据读取"><a href="#3-2-2-数据读取" class="headerlink" title="3.2.2 数据读取"></a>3.2.2 数据读取</h4><p>HDFS提供了一个API可以确定一个数据节点所属的机架ID，客户端也可以调用API获取自己所属的机架ID。</p>
<p>利用Java API读数据过程：</p>
<p><img src="/2020/03/20/02-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FHDFS/JavaApiRead.png" alt="Java Api Read"></p>
<h4 id="3-2-3-数据写入与复制"><a href="#3-2-3-数据写入与复制" class="headerlink" title="3.2.3 数据写入与复制"></a>3.2.3 数据写入与复制</h4><p>HDFS采用流水线复制的策略。</p>
<p>当客户端要向HDFS写入文件时，这个文件首先根据块大小划分成若干块并写入本地，每个块都向HDFS集群中的Namenode发起写请求，Namenode返回一个最佳数据节点返回客户端，客户端把数据写入第一个数据节点，同时把列表传给第一个数据节点，第一个数据节点将数据写入本地，同时向第二个数据节点发送数据和列表，以此类推。</p>
<p><img src="/2020/03/20/02-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FHDFS/HDFSDataWrite.png" alt="HDFS DataWriteIn"></p>
<p>使用Java API写数据：</p>
<p><img src="/2020/03/20/02-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FHDFS/JavaApiWrite.png" alt="Java Api Write"></p>
<h3 id="3-3-数据错误与恢复"><a href="#3-3-数据错误与恢复" class="headerlink" title="3.3 数据错误与恢复"></a>3.3 数据错误与恢复</h3><h4 id="3-3-1-Namenode出错"><a href="#3-3-1-Namenode出错" class="headerlink" title="3.3.1 Namenode出错"></a>3.3.1 Namenode出错</h4><p>Namenode保存了所有元数据信息，若文件损坏，整个系统宕机。HDFS的两种补救措施在2.2.2 Namenode 和 Datanode 中已提到。</p>
<h4 id="3-3-2-Datanode出错"><a href="#3-3-2-Datanode出错" class="headerlink" title="3.3.2 Datanode出错"></a>3.3.2 Datanode出错</h4><p>每个Datanode会定期向Namenode发送“心跳”，向Namenode报告“我还活着”。一旦Namenode没有接收到定期的心跳信息，默认该Datanode宕机，不会对其进行任何读写等操作。同时Namenode会定期检查Datanode数据块副本数量，若小于冗余因子，则启动数据的冗余复制。</p>
<h4 id="3-3-3-数据错误"><a href="#3-3-3-数据错误" class="headerlink" title="3.3.3 数据错误"></a>3.3.3 数据错误</h4><p>数据错误主要集中在网络传输和磁盘错误。客户端采用md5和sha1对数据块进行校验，确保读取到正确的数据。</p>
<blockquote>
<p>文件被创建时，客户端会对每一个文件进行信息摘录，把信息写入同一个路径的隐藏文件中。当客户端读取文件时，先读取该信息文件，利用信息文件对每个信息读取的数据块进行校验，校验出错，客户端请求到另一个数据节点读取文件块，并向Namenode报告错误。</p>
</blockquote>
<h2 id="4-HDFS-实践"><a href="#4-HDFS-实践" class="headerlink" title="4. HDFS 实践"></a>4. HDFS 实践</h2><p>HDFS交互的方式有很多种，但相对而言使用命令行是最简单的，如果在一台机器上运行HDFS，需要将Hadoop配置为为分布模式。</p>
<p>在使用HDFS的过程中，注意集群的<code>/</code>目录与<code>.</code>目录的区别。</p>
<h4 id="4-1-Shell-命令"><a href="#4-1-Shell-命令" class="headerlink" title="4.1 Shell 命令"></a>4.1 Shell 命令</h4><p>HDFS Shell具体使用命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Usage: hadoop fs [generic options]</span><br><span class="line">  [-appendToFile &lt;localsrc&gt; ... &lt;dst&gt;]</span><br><span class="line">  [-cat [-ignoreCrc] &lt;src&gt; ...]</span><br><span class="line">  [-checksum &lt;src&gt; ...]</span><br><span class="line">  [-chgrp [-R] GROUP PATH...]</span><br><span class="line">  [-chmod [-R] &lt;MODE[,MODE]... | OCTALMODE&gt; PATH...]</span><br><span class="line">  [-chown [-R] [OWNER][:[GROUP]] PATH...]</span><br><span class="line">  [-copyFromLocal [-f] [-p] [-l] [-d] [-t &lt;thread count&gt;] &lt;localsrc&gt; ... &lt;dst&gt;]</span><br><span class="line">  [-copyToLocal [-f] [-p] [-ignoreCrc] [-crc] &lt;src&gt; ... &lt;localdst&gt;]</span><br><span class="line">  [-count [-q] [-h] [-v] [-t [&lt;storage type&gt;]] [-u] [-x] [-e] &lt;path&gt; ...]</span><br><span class="line">  [-cp [-f] [-p | -p[topax]] [-d] &lt;src&gt; ... &lt;dst&gt;]</span><br><span class="line">  [-createSnapshot &lt;snapshotDir&gt; [&lt;snapshotName&gt;]]</span><br><span class="line">  [-deleteSnapshot &lt;snapshotDir&gt; &lt;snapshotName&gt;]</span><br><span class="line">  [-df [-h] [&lt;path&gt; ...]]</span><br><span class="line">  [-du [-s] [-h] [-v] [-x] &lt;path&gt; ...]</span><br><span class="line">  [-expunge [-immediate]]</span><br><span class="line">  [-find &lt;path&gt; ... &lt;expression&gt; ...]</span><br><span class="line">  [-get [-f] [-p] [-ignoreCrc] [-crc] &lt;src&gt; ... &lt;localdst&gt;]</span><br><span class="line">  [-getfacl [-R] &lt;path&gt;]</span><br><span class="line">  [-getfattr [-R] &#123;-n name | -d&#125; [-e en] &lt;path&gt;]</span><br><span class="line">  [-getmerge [-nl] [-skip-empty-file] &lt;src&gt; &lt;localdst&gt;]</span><br><span class="line">  [-head &lt;file&gt;]</span><br><span class="line">  [-help [cmd ...]]</span><br><span class="line">  [-ls [-C] [-d] [-h] [-q] [-R] [-t] [-S] [-r] [-u] [-e] [&lt;path&gt; ...]]</span><br><span class="line">  [-mkdir [-p] &lt;path&gt; ...]</span><br><span class="line">  [-moveFromLocal &lt;localsrc&gt; ... &lt;dst&gt;]</span><br><span class="line">  [-moveToLocal &lt;src&gt; &lt;localdst&gt;]</span><br><span class="line">  [-mv &lt;src&gt; ... &lt;dst&gt;]</span><br><span class="line">  [-put [-f] [-p] [-l] [-d] &lt;localsrc&gt; ... &lt;dst&gt;]</span><br><span class="line">  [-renameSnapshot &lt;snapshotDir&gt; &lt;oldName&gt; &lt;newName&gt;]</span><br><span class="line">  [-rm [-f] [-r|-R] [-skipTrash] [-safely] &lt;src&gt; ...]</span><br><span class="line">  [-rmdir [--ignore-fail-on-non-empty] &lt;dir&gt; ...]</span><br><span class="line">  [-setfacl [-R] [&#123;-b|-k&#125; &#123;-m|-x &lt;acl_spec&gt;&#125; &lt;path&gt;]|[--set &lt;acl_spec&gt; &lt;path&gt;]]</span><br><span class="line">  [-setfattr &#123;-n name [-v value] | -x name&#125; &lt;path&gt;]</span><br><span class="line">  [-setrep [-R] [-w] &lt;rep&gt; &lt;path&gt; ...]</span><br><span class="line">  [-stat [format] &lt;path&gt; ...]</span><br><span class="line">  [-tail [-f] [-s &lt;sleep interval&gt;] &lt;file&gt;]</span><br><span class="line">  [-test -[defswrz] &lt;path&gt;]</span><br><span class="line">  [-text [-ignoreCrc] &lt;src&gt; ...]</span><br><span class="line">  [-touch [-a] [-m] [-t TIMESTAMP ] [-c] &lt;path&gt; ...]</span><br><span class="line">  [-touchz &lt;path&gt; ...]</span><br><span class="line">  [-truncate [-w] &lt;length&gt; &lt;path&gt; ...]</span><br><span class="line">  [-usage [cmd ...]]</span><br></pre></td></tr></table></figure>
<p>多数操作与Linux类似，不做赘述。具体实践可参考下面文章：<a target="_blank" rel="noopener" href="https://juejin.im/entry/58a57f12128fe1006cafc8d9">HDFS实践</a>  [注：该文章有几个错误]</p>
<p>需要注意几点：</p>
<ol>
<li><p>HDFS主张“一次写入，多次读取”，一般来说，写入的内容最好不要后期修改内容，要不删除，要不重新上传。极端情况下可以使用<code>appendToFile</code>这一命令对文件进行追加，但一般建议先把文件下到本地再进行追加操作。</p>
</li>
<li><p>熟悉Shell命令的朋友在命令比价复杂情况下可以使用Shell的条件判断等语句来执行。</p>
</li>
</ol>
<h4 id="4-2-如何在Mac使用Eclipse进行HDFS编写："><a href="#4-2-如何在Mac使用Eclipse进行HDFS编写：" class="headerlink" title="4.2 如何在Mac使用Eclipse进行HDFS编写："></a>4.2 如何在Mac使用Eclipse进行HDFS编写：</h4><p>参考这边文章吧，这边懒得写了。<a target="_blank" rel="noopener" href="https://blog.csdn.net/G290095142/article/details/78231337">Mac Eclipse HDFS配置</a></p>
<p>以下步骤为Hadoop单机伪分布环境下Eclipse HDFS 配置。</p>
<h5 id="4-2-1-下载Hadoop-Eclipse插件"><a href="#4-2-1-下载Hadoop-Eclipse插件" class="headerlink" title="4.2.1 下载Hadoop Eclipse插件"></a>4.2.1 下载Hadoop Eclipse插件</h5><p><a target="_blank" rel="noopener" href="https://people.apache.org/~srimanth/hadoop-eclipse/">官网地址</a>，需要Eclipse版本3.6以上。</p>
<p>将插件放到Eclipse Plugins下，然后重启Eclipse，在Preferences下按如下配置，Hadoop安装目录根据自己情况配置。</p>
<p><img src="/2020/03/20/02-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FHDFS/HDFSEclipseConfig1.png" alt="HDFS Eclipse Config1"></p>
<h5 id="4-2-2-创建Hadoop-HDFS程序"><a href="#4-2-2-创建Hadoop-HDFS程序" class="headerlink" title="4.2.2 创建Hadoop HDFS程序"></a>4.2.2 创建Hadoop HDFS程序</h5><p>New一个Map/Reduce Project</p>
<p><img src="/2020/03/20/02-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FHDFS/Eclipse.png" alt="Eclipse"></p>
<p>项目创建完毕后，重点是配置Hadoop Location。</p>
<p>在<code>Windows -&gt; show view -&gt; Other -&gt; MapReduce Location</code>下配置：</p>
<p>其中</p>
<p><strong>Map/Reduce Master</strong>下：</p>
<p>Host：就是jobtracker 所在的集群机器，这里写localhost</p>
<p>Port：就是jobtracker 的port，这里写的是9001</p>
<p><strong>这两个参数就是mapred-site.xml里面mapred.job.tracker里面的ip和port</strong> </p>
<p><strong>DFS Master </strong>下：</p>
<p>Host：就是namenode所在的集群机器，这里写localhost</p>
<p>Port：就是namenode的port，这里写9000</p>
<p><strong>这两个参数就是core-site.xml里面fs.default.name里面的ip和port</strong>，根据自己情况修改。</p>
<p><img src="/2020/03/20/02-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FHDFS/Config.png" alt="Config"></p>
<p>修改完成，就可以去搞了，项目运行时选择<code>Run On Hadoop</code>运行即可。</p>
<p>举个例子吧：</p>
<p>编程实现一个类“MyFSDataInputStream”，该类继承“org.apache.hadoop.fs.FSDataInputStream”，要求如下：实现按行读取HDFS中指定文件的方法“readLine()”，如果读到文件末尾，则返回空，否则返回文件一行的文本。</p>
<p>准备：</p>
<p>使用JavaApi在superming目录下写入test文件，文件内容为“Hello World”，代码截图如下：</p>
<p><img src="/2020/03/20/02-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FHDFS/FileWrite.png" alt="FileWrite"></p>
<p>在Hadoop下运行代码将文件写入。</p>
<p>执行：</p>
<p>使用JavaApi读取刚创建的test文件，代码截图如下：</p>
<p><img src="/2020/03/20/02-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FHDFS/MyFDSDATAInputStream.png" alt="MyFDSDATAInputStream"></p>
<p>在Hadoop下执行如下：</p>
<p><img src="/2020/03/20/02-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FHDFS/Result.png" alt="Result"></p>
<p>显示HDFS中指定文件的读写权限、大小、创建时间、路径等</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.apache.hadoop.examples;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 显示HDFS中指定文件的读写权限，大小，创建时间，路径等信息 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">fileList</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">list</span><span class="params">(Configuration conf, String remoteFilePath)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(FileSystem fs = FileSystem.get(conf))&#123;</span><br><span class="line">      Path remotePath = <span class="keyword">new</span> Path(remoteFilePath);</span><br><span class="line">      FileStatus[] fileStatus = fs.listStatus(remotePath);</span><br><span class="line">      <span class="keyword">for</span>(FileStatus s : fileStatus) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Path: &quot;</span> + s.getPath().toString());</span><br><span class="line">        System.out.println(<span class="string">&quot;Access: &quot;</span> + s.getPermission().toString());</span><br><span class="line">        System.out.println(<span class="string">&quot;Size: &quot;</span> + s.getLen());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">long</span> timeStamp = s.getModificationTime();</span><br><span class="line">        SimpleDateFormat format = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        String date = format.format(timeStamp);</span><br><span class="line">        System.out.println(<span class="string">&quot;时间：&quot;</span> + date);</span><br><span class="line">        fs.close();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">    conf.set(<span class="string">&quot;fs.default&quot;</span>, <span class="string">&quot;hdfs://localhost:8888&quot;</span>);</span><br><span class="line">    conf.set(<span class="string">&quot;fs.hdfs.impl&quot;</span>,<span class="string">&quot;org.apache.hadoop.hdfs.DistributedFileSystem&quot;</span>);</span><br><span class="line">    String remoteFilePath = <span class="string">&quot;/user/superming/hello.txt&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;File Information:&quot;</span> + remoteFilePath);</span><br><span class="line">      fileList.list(conf, remoteFilePath);</span><br><span class="line">      System.out.println(<span class="string">&quot;\n Read Done&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>判断本地路径是否已存在，如果存在则自动更名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.apache.hadoop.examples;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">copyToLocal</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">copytolocal</span><span class="params">(Configuration conf, String remoteFilePath, String localFilePath)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">    <span class="comment">//FileSystem fs = FileSystem.get(conf);</span></span><br><span class="line">    Path remotePath = <span class="keyword">new</span> Path(remoteFilePath);</span><br><span class="line">    File f = <span class="keyword">new</span> File(localFilePath);</span><br><span class="line">    <span class="comment">//若文件存在，则自动重命名</span></span><br><span class="line">    <span class="keyword">try</span>(FileSystem fs = FileSystem.get(conf))&#123;</span><br><span class="line">    <span class="keyword">if</span>(f.exists()) &#123;</span><br><span class="line">      System.out.println(localFilePath + <span class="string">&quot;已存在&quot;</span>);</span><br><span class="line">      Integer i = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">        f = <span class="keyword">new</span> File(localFilePath + <span class="string">&quot;-&quot;</span> + i.toString());</span><br><span class="line">        <span class="comment">//解决更改后依旧存在的问题</span></span><br><span class="line">        <span class="keyword">if</span>(!f.exists()) &#123;</span><br><span class="line">          localFilePath = localFilePath + <span class="string">&quot;-&quot;</span> + i.toString();</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(<span class="string">&quot;文件修改为：&quot;</span> + localFilePath);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//下载文件</span></span><br><span class="line">    Path localPath = <span class="keyword">new</span> Path(localFilePath);</span><br><span class="line">    fs.copyToLocalFile(remotePath, localPath);</span><br><span class="line">    fs.close();</span><br><span class="line">    &#125;<span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">    conf.set(<span class="string">&quot;fs.default&quot;</span>, <span class="string">&quot;hdfs://localhost:8888&quot;</span>);</span><br><span class="line">  </span><br><span class="line">    String localFilePath = <span class="string">&quot;/usr/local/Cellar/hadoop/hello&quot;</span>;</span><br><span class="line">    String remoteFilePath = <span class="string">&quot;/user/superming/hello&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      copyToLocal.copytolocal(conf, remoteFilePath, localFilePath);</span><br><span class="line">      System.out.println(<span class="string">&quot;Download Complete !&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://hadoop.apache.org/docs/r1.0.4/cn/hdfs_design.html">Hadoop分布式文件系统：架构和设计</a> </p>
<p><a target="_blank" rel="noopener" href="https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/FileSystemShell.html">HDFS command 官方文档</a></p>
<p><a target="_blank" rel="noopener" href="http://hadoop.apache.org/docs/stable/api/">Hadoop Api</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://superming.life/2020/03/18/Java-Web-HttpServletRequest%E5%AF%B9%E8%B1%A1%E5%92%8CHttpServeltRespnse%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ninja2.jpg">
      <meta itemprop="name" content="AlenZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AlenZhang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/18/Java-Web-HttpServletRequest%E5%AF%B9%E8%B1%A1%E5%92%8CHttpServeltRespnse%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">Java Web: HttpServletRequest对象和HttpServeltRespnse对象详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-03-18 00:17:58" itemprop="dateCreated datePublished" datetime="2020-03-18T00:17:58+08:00">2020-03-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
        </span>
    </span>

  
    <span id="/2020/03/18/Java-Web-HttpServletRequest%E5%AF%B9%E8%B1%A1%E5%92%8CHttpServeltRespnse%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3/" class="post-meta-item leancloud_visitors" data-flag-title="Java Web: HttpServletRequest对象和HttpServeltRespnse对象详解" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>16k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>15 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="HttpServletRequest对象和HttpServeltResponse对象详解"><a href="#HttpServletRequest对象和HttpServeltResponse对象详解" class="headerlink" title="HttpServletRequest对象和HttpServeltResponse对象详解"></a>HttpServletRequest对象和HttpServeltResponse对象详解</h1><h2 id="1-HttpServletRequest简介"><a href="#1-HttpServletRequest简介" class="headerlink" title="1. HttpServletRequest简介"></a>1. HttpServletRequest简介</h2><p>HttpServletRequest代表客户端请求，顾名思义，客户端通过HTTP协议访问服务器时，HTTP相关信息都封装在这个对象中，开发者可以通过这个对象的方法获取客户端请求的所有信息。</p>
<h2 id="2-Request对象常用方法"><a href="#2-Request对象常用方法" class="headerlink" title="2. Request对象常用方法"></a>2. Request对象常用方法</h2><h3 id="2-1-获取请求行信息「客户机信息」"><a href="#2-1-获取请求行信息「客户机信息」" class="headerlink" title="2.1 获取请求行信息「客户机信息」"></a>2.1 获取请求行信息「客户机信息」</h3><div class="table-container">
<table>
<thead>
<tr>
<th>方法名</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>getMethod</td>
<td>获得请求方式</td>
</tr>
<tr>
<td>getRequestURL</td>
<td>获得客户端发出请求时完整URL</td>
</tr>
<tr>
<td>getRequestURI</td>
<td>获得请求行中资源名部分</td>
</tr>
<tr>
<td>getServletPath</td>
<td>获得Servlet路径</td>
</tr>
<tr>
<td>getProtocol</td>
<td>获得协议和版本</td>
</tr>
<tr>
<td>getQueryString</td>
<td>获得返回行中的参数部分</td>
</tr>
<tr>
<td>getLocalAddr</td>
<td>获得Web服务器的IP地址</td>
</tr>
<tr>
<td>getLocalName</td>
<td>获得Web服务器来的主机名</td>
</tr>
</tbody>
</table>
</div>
<!---- more ----->
<h3 id="2-2-获取请求头信息"><a href="#2-2-获取请求头信息" class="headerlink" title="2.2 获取请求头信息"></a>2.2 获取请求头信息</h3><div class="table-container">
<table>
<thead>
<tr>
<th>方法名</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>getHeader</td>
<td>以字符串形式返回指定请求头的值</td>
</tr>
<tr>
<td>getHeaderNames</td>
<td>返回请求包含所有的请求头名称的枚举</td>
</tr>
</tbody>
</table>
</div>
<p>代码实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class request</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/request&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">request</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">       </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> HttpServlet#HttpServlet()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">    <span class="comment">//请求行、请求头内容获取</span></span><br><span class="line">    response.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">       PrintWriter out = response.getWriter();</span><br><span class="line">       String title = <span class="string">&quot;Servlet Example: Showing Request Headers&quot;</span>;</span><br><span class="line">       out.println(</span><br><span class="line">            <span class="string">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;&quot;</span> + title + <span class="string">&quot;&lt;/title&gt;&lt;/head&gt;&lt;body&gt;\n&quot;</span>     </span><br><span class="line">         + <span class="string">&quot;&lt;h1&gt;&quot;</span> + title+ <span class="string">&quot;&lt;/h1&gt;\n&quot;</span></span><br><span class="line">         + <span class="string">&quot;&lt;h2&gt;Request Method: &quot;</span>+request.getMethod()+<span class="string">&quot;&lt;/h2&gt;&quot;</span></span><br><span class="line">         + <span class="string">&quot;&lt;h2&gt;Request URL: &quot;</span>+request.getRequestURL()+<span class="string">&quot;&lt;/h2&gt;&quot;</span></span><br><span class="line">         + <span class="string">&quot;&lt;h2&gt;Request URI: &quot;</span>+request.getRequestURI()+<span class="string">&quot;&lt;/h2&gt;&quot;</span></span><br><span class="line">         + <span class="string">&quot;&lt;h2&gt;ServletPath: &quot;</span>+request.getServletPath()+<span class="string">&quot;&lt;/h2&gt;&quot;</span></span><br><span class="line">         + <span class="string">&quot;&lt;h2&gt;Request Protocol: &quot;</span>+request.getProtocol()+<span class="string">&quot;&lt;/h2&gt;&quot;</span></span><br><span class="line">         + <span class="string">&quot;&lt;h2&gt;Request String: &quot;</span>+request.getQueryString()+<span class="string">&quot;&lt;/h2&gt;&quot;</span></span><br><span class="line">         + <span class="string">&quot;&lt;h2&gt;Web Server IP Address: &quot;</span>+request.getLocalAddr()+<span class="string">&quot;&lt;/h2&gt;&quot;</span></span><br><span class="line">         + <span class="string">&quot;&lt;h2&gt;WebServerLocalName: &quot;</span>+request.getLocalName()+<span class="string">&quot;&lt;/h2&gt;&quot;</span></span><br><span class="line">         + <span class="string">&quot;&lt;table border=\&quot;1\&quot;&gt;\n&quot;</span></span><br><span class="line">         + <span class="string">&quot;&lt;tr&gt;&lt;th&gt;Header Name&lt;/th&gt;&lt;th&gt;Header Value&lt;/th&gt;&lt;/tr&gt;&quot;</span>);</span><br><span class="line">       Enumeration headerNames = request.getHeaderNames();</span><br><span class="line">       <span class="keyword">while</span> (headerNames.hasMoreElements()) &#123;</span><br><span class="line">           String headerName = (String) headerNames.nextElement();</span><br><span class="line">           out.println(<span class="string">&quot;&lt;tr&gt;&lt;td&gt;&quot;</span> + headerName + <span class="string">&quot;&lt;/td&gt;&quot;</span> </span><br><span class="line">             +<span class="string">&quot;&lt;td&gt;&quot;</span>+request.getHeader(headerName)+<span class="string">&quot;&lt;/td&gt;&lt;/tr&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        out.println(<span class="string">&quot;&lt;/table&gt;\n&lt;/body&gt;&lt;/html&gt;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">    doGet(request, response);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<p><img src="/2020/03/18/Java-Web-HttpServletRequest%E5%AF%B9%E8%B1%A1%E5%92%8CHttpServeltRespnse%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3/RequestHeader.png" alt="RequestHeader"></p>
<h3 id="2-3-获取请求体"><a href="#2-3-获取请求体" class="headerlink" title="2.3 获取请求体"></a>2.3 获取请求体</h3><h3 id="2-3-1-表单获取"><a href="#2-3-1-表单获取" class="headerlink" title="2.3.1 表单获取"></a>2.3.1 表单获取</h3><div class="table-container">
<table>
<thead>
<tr>
<th>方法名</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>String getParameter(name)</td>
<td>根据表单中的属性名，获取value的值</td>
</tr>
<tr>
<td>String[]　getParameterValues（String name）</td>
<td>为复选框提供的方法</td>
</tr>
<tr>
<td>getParameterNames</td>
<td>获取表单提交的所有name方法</td>
</tr>
<tr>
<td>Map<String , string[]>　getParameterMap()</String></td>
<td>得到表单提交的所有值的方法</td>
</tr>
<tr>
<td>getInputStream</td>
<td>以字节流的方式得到所有表单数据</td>
</tr>
</tbody>
</table>
</div>
<h4 id="2-3-1-1-使用getParameter和getParameterValues获取表单数据"><a href="#2-3-1-1-使用getParameter和getParameterValues获取表单数据" class="headerlink" title="2.3.1.1 使用getParameter和getParameterValues获取表单数据"></a>2.3.1.1 使用getParameter和getParameterValues获取表单数据</h4><p>代码举例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">//创建表单文件，提交到requset</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;request&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">        UserName：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;userName&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        PassWord：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pwd&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        Gender：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;男&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span>/&gt;</span>男  </span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;女&quot;</span>/&gt;</span>女  <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        Hobby：</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;篮球&quot;</span>/&gt;</span>篮球</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;唱歌&quot;</span>/&gt;</span>唱歌</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;编码&quot;</span>/&gt;</span>编码</span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        City：</span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;city&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;NewYork&quot;</span>&gt;</span>NewYork<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;ShangHai&quot;</span>&gt;</span>ShangHai<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Sydney&quot;</span>&gt;</span>Sydney<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        Others:</span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span> = <span class="string">&quot;notes&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">&quot;hidden&quot;</span> <span class="attr">name</span> = <span class="string">&quot;hidden&quot;</span> <span class="attr">value</span> = <span class="string">&quot;hiddenvalue&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;submit&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//request.java</span></span><br><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class request</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/request&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">request</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">       </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> HttpServlet#HttpServlet()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">    	 	String userName = request.getParameter(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">          String pwd = request.getParameter(<span class="string">&quot;pwd&quot;</span>);</span><br><span class="line">          String sex = request.getParameter(<span class="string">&quot;sex&quot;</span>);</span><br><span class="line">          String[] hobbys = request.getParameterValues(<span class="string">&quot;hobby&quot;</span>);</span><br><span class="line">          String city = request.getParameter(<span class="string">&quot;city&quot;</span>);</span><br><span class="line">          String others = request.getParameter(<span class="string">&quot;notes&quot;</span>);</span><br><span class="line">          String hidden = request.getParameter(<span class="string">&quot;hidden&quot;</span>);</span><br><span class="line">          </span><br><span class="line">          userName = <span class="keyword">new</span> String(userName.getBytes(<span class="string">&quot;iso-8859-1&quot;</span>),<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">          System.out.println(userName);</span><br><span class="line">          System.out.println(pwd);</span><br><span class="line">          System.out.println(sex);</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; hobbys!=<span class="keyword">null</span> &amp;&amp; i &lt; hobbys.length; i++) &#123;</span><br><span class="line">              System.out.print(hobbys[i]+<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          System.out.println();</span><br><span class="line">          System.out.println(city);</span><br><span class="line">          System.out.println(others);</span><br><span class="line">          System.out.println(hidden);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">    doGet(request, response);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行结果如下：</p>
<p><img src="/2020/03/18/Java-Web-HttpServletRequest%E5%AF%B9%E8%B1%A1%E5%92%8CHttpServeltRespnse%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3/RequestBody.png" alt="RequestBody"></p>
<p><img src="/2020/03/18/Java-Web-HttpServletRequest%E5%AF%B9%E8%B1%A1%E5%92%8CHttpServeltRespnse%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3/RequestBody1.png" alt="RequestBody1"></p>
<h4 id="2-3-1-2-使用getParameterNames-和-getParameterValues（String-name）获取"><a href="#2-3-1-2-使用getParameterNames-和-getParameterValues（String-name）获取" class="headerlink" title="2.3.1.2 使用getParameterNames()和 getParameterValues（String name）获取"></a>2.3.1.2 使用getParameterNames()和 getParameterValues（String name）获取</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Enumeration names = request.getParameterNames();</span><br><span class="line">        <span class="keyword">while</span>(names.hasMoreElements())&#123;</span><br><span class="line">            String name = (String) names.nextElement();<span class="comment">//得到每一个name名</span></span><br><span class="line">            String[] values = request.getParameterValues(name);<span class="comment">//根据name名，得到value值</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;values!=<span class="keyword">null</span> &amp;&amp; i &lt; values.length; i++) &#123;</span><br><span class="line">                System.out.println(name+<span class="string">&quot;\t&quot;</span>+values[i]);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-1-3-使用getParameterMap获取提交的所有值-需要导入对应包"><a href="#2-3-1-3-使用getParameterMap获取提交的所有值-需要导入对应包" class="headerlink" title="2.3.1.3 使用getParameterMap获取提交的所有值,需要导入对应包"></a>2.3.1.3 使用getParameterMap获取提交的所有值,需要导入对应包</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, String[]&gt; paramMap = request.getParameterMap();</span><br><span class="line">       <span class="keyword">for</span>(Map.Entry&lt;String, String[]&gt; entry :paramMap.entrySet())&#123;</span><br><span class="line">           String paramName = entry.getKey();</span><br><span class="line">           String paramValue = <span class="string">&quot;&quot;</span>;</span><br><span class="line">           String[] paramValueArr = entry.getValue();</span><br><span class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; paramValueArr!=<span class="keyword">null</span> &amp;&amp; i &lt; paramValueArr.length; i++) &#123;</span><br><span class="line">               <span class="keyword">if</span> (i == paramValueArr.length-<span class="number">1</span>) &#123;</span><br><span class="line">                   paramValue+=paramValueArr[i];</span><br><span class="line">               &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                   paramValue+=paramValueArr[i]+<span class="string">&quot;,&quot;</span>;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           System.out.println(MessageFormat.format(<span class="string">&quot;&#123;0&#125;=&#123;1&#125;&quot;</span>, paramName,paramValue));</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>执行如下：</p>
<p><img src="/2020/03/18/Java-Web-HttpServletRequest%E5%AF%B9%E8%B1%A1%E5%92%8CHttpServeltRespnse%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3/RequestMap1.png" alt="RequestMap1"></p>
<p><img src="/2020/03/18/Java-Web-HttpServletRequest%E5%AF%B9%E8%B1%A1%E5%92%8CHttpServeltRespnse%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3/RequestMap.png" alt="RequestMap"></p>
<h3 id="2-3-2-Request对象进行请求转发"><a href="#2-3-2-Request对象进行请求转发" class="headerlink" title="2.3.2 Request对象进行请求转发"></a>2.3.2 Request对象进行请求转发</h3><p>主要使用以下方法</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>方法</th>
<th>zuoyng</th>
</tr>
</thead>
<tbody>
<tr>
<td>void setAttribute(String name, Object value);</td>
<td>将数据作为request对象的一个属性存放到request对象中</td>
</tr>
<tr>
<td>Object getAttribute(String name);</td>
<td>获取属性</td>
</tr>
<tr>
<td>Void removeAttribute(String name);</td>
<td>移除request对象的name属性</td>
</tr>
<tr>
<td>getAttributeNames</td>
<td>获取request对象所有的属性名，例如：Enumeration<String> attrNames = request.getAttributeNames();</String></td>
</tr>
</tbody>
</table>
</div>
<p>代码实例，将<code>dispatcher.java</code>请求转发到<code>anotherServelt.java</code>上：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dispatcher.java</span></span><br><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class dispatcher</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/dispatcher&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">dispatcher</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">       </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> HttpServlet#HttpServlet()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">dispatcher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">    <span class="comment">//response.getWriter().append(&quot;Served at: &quot;).append(request.getContextPath());</span></span><br><span class="line">    request.setAttribute(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;It&#x27;s an RequestDispatcher example&quot;</span>);<span class="comment">//设置参数</span></span><br><span class="line">    request.getRequestDispatcher(<span class="string">&quot;anotherServlet&quot;</span>).forward(request,response);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">    doGet(request, response);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class anotherServelt</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/anotherServelt&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">anotherServelt</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">       </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> HttpServlet#HttpServlet()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">anotherServelt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">    <span class="comment">//response.getWriter().append(&quot;Served at: &quot;).append(request.getContextPath());</span></span><br><span class="line">    <span class="comment">//String param = (String)request.getAttribute(&quot;param&quot;);//getAttribute返回object类型，需要强制转换</span></span><br><span class="line">    String param = (String)request.getAttribute(<span class="string">&quot;param&quot;</span>);</span><br><span class="line">    PrintWriter out = response.getWriter();</span><br><span class="line">    out.print(<span class="string">&quot;&lt;h1&gt;&quot;</span>+param+<span class="string">&quot;&lt;/h1&gt;&quot;</span>);</span><br><span class="line">    System.out.print(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    System.out.print(param);</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">    doGet(request, response);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="/2020/03/18/Java-Web-HttpServletRequest%E5%AF%B9%E8%B1%A1%E5%92%8CHttpServeltRespnse%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3/Dispatcher.png" alt="Dispatcher"></p>
<p>总结：<strong>请求转发并不改变浏览器的URL，服务器处理转发资源，屏蔽了浏览器，request对象的值不改变，可继续从中获取数据。同时请求转发局限于某一个Web项目下，不可跳转至其他项目。</strong></p>
<h2 id="3-HttpServletResponse简介"><a href="#3-HttpServletResponse简介" class="headerlink" title="3. HttpServletResponse简介"></a>3. HttpServletResponse简介</h2><p>Web服务器收到客户端HTTP请求，对每一次请求创建一个请求对象request和响应对象response对象。我们需要像容器输出数据，使用response对象即可。</p>
<p>HttpServletResponse对象代表服务器的响应。这个对象中封装了向客户端发送数据、发送响应头，发送响应状态码的方法。</p>
<p><img src="/2020/03/18/Java-Web-HttpServletRequest%E5%AF%B9%E8%B1%A1%E5%92%8CHttpServeltRespnse%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3/Response.png" alt="Response"></p>
<p>其中getOutputStream和getWriter方法分别用于得到输出二进制数据、输出文本数据的ServletOuputStream、Printwriter对象。这两个方法互相排斥，调用了其中的任何一个方法后，就不能再调用另一方法。 会抛异常。</p>
<p>Servlet程序向ServletOutputStream或PrintWriter对象中写入的数据将被Servlet引擎从response里面获取，Servlet引擎将这些数据当作响应消息的正文，然后再与响应状态行和各响应头组合后输出到客户端。</p>
<p>Serlvet的service方法结束后，Servlet引擎将检查getWriter或getOutputStream方法返回的输出流对象是否已经调用过close方法，如果没有，Servlet引擎将调用close方法关闭该输出流对象。</p>
<h3 id="3-1-响应行"><a href="#3-1-响应行" class="headerlink" title="3.1 响应行"></a>3.1 响应行</h3><div class="table-container">
<table>
<thead>
<tr>
<th>常见的响应状态码</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>200 OK</td>
<td>一切正常，对GET和POST请求的应答文档跟在后面</td>
</tr>
<tr>
<td>3XX</td>
<td>用于已经移动的文件并且充被包含在定位头信息中指定新的地址消息</td>
</tr>
<tr>
<td>302 Found</td>
<td>类似于301，但新的URL应该被视为临时性的替代，而不是永久性的。</td>
</tr>
<tr>
<td>4XX  用于指出客户端的错误</td>
<td>404 Not Found 无法找到指定位置的资源</td>
</tr>
<tr>
<td>5XX  用于支持服务器错误</td>
<td>500 Internal Server Error  服务器遇到了意料不到的情况，不能完成客户的请求</td>
</tr>
</tbody>
</table>
</div>
<p>可以使用<code>setStatus(int sc)</code>来设置响应状态码</p>
<h3 id="3-2-响应头"><a href="#3-2-响应头" class="headerlink" title="3.2 响应头"></a>3.2 响应头</h3><p>常见响应头：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Accept-Charset:告知客户可以接收的字符集</span><br><span class="line">    Accept-Encoding:所有响应的字符编码集</span><br><span class="line">    Content-Type:响应体的MIME类型</span><br><span class="line">    Content-Language:响应体的语言类型</span><br><span class="line">    Content-Length:响应体的长度和字节数</span><br><span class="line">    Expires：通知客户端过期时间，防止客户浏览器使用本地缓存副本</span><br><span class="line">    Cookie：包含保存到客户端的Cookie集</span><br><span class="line">    Redirect：提供指定重定向，可以不向浏览器输出响应内容，而是直接重新请求到另一个URL地址，实现重定向响应，即是一种自动定向。</span><br></pre></td></tr></table></figure>
<p>可以使用<code>setHeader(String name, String value)</code>设置响应头信息</p>
<p>举例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>); <span class="comment">//告诉客户端使用什么编码</span></span><br><span class="line"></span><br><span class="line">response.setStatus(<span class="number">302</span>);<span class="comment">//设置状态码为302，代表重定向</span></span><br><span class="line">response.setHeader(<span class="string">&quot;location&quot;</span>, <span class="string">&quot;http://www.baidu.com&quot;</span>);<span class="comment">//设置location为baidu,实现重定向</span></span><br><span class="line"></span><br><span class="line">response.setHeader(<span class="string">&quot;refresh&quot;</span>,<span class="string">&quot;2&quot;</span>);<span class="comment">//定时刷新页面</span></span><br></pre></td></tr></table></figure>
<h3 id="3-3-响应正文方法"><a href="#3-3-响应正文方法" class="headerlink" title="3.3 响应正文方法"></a>3.3 响应正文方法</h3><div class="table-container">
<table>
<thead>
<tr>
<th>方法</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>getWrite</td>
<td>字符输出流</td>
</tr>
<tr>
<td>getOutputStream</td>
<td>字符输出流</td>
</tr>
<tr>
<td>setCharacterEncoding(String charset)</td>
<td>告诉服务器使用什么编码</td>
</tr>
<tr>
<td>setContentType(String type)</td>
<td>设置服务器编码</td>
</tr>
</tbody>
</table>
</div>
<h3 id="3-4-重定向"><a href="#3-4-重定向" class="headerlink" title="3.4 重定向"></a>3.4 重定向</h3><p>什么是重定向：<strong>一个web资源收到客户端请求后，通知客户端去访问另外一个web资源，这称之为请求重定向。</strong></p>
<p>应用场景：用户登陆成功，从注册页面跳转到某个页面。</p>
<p>实现方式：response.sendRedirect(String location)，调用response对象的sendRedirect方法实现请求重定向<br>sendRedirect内部的实现原理：使用response设置302状态码和设置location响应头实现重定向</p>
<p>举例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">      response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">      response.sendRedirect(<span class="string">&quot;http://www.baidu.com&quot;</span>);<span class="comment">//重定向到baidu</span></span><br><span class="line">  		<span class="comment">//sendRedirect（&quot;http://www.baidu.com&quot;）等同于以下两行代码</span></span><br><span class="line">  		<span class="comment">//response.setStatus(302);</span></span><br><span class="line">      <span class="comment">//response.setHeader(&quot;location&quot;, &quot;http://baidu.com&quot;);</span></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总结：</p>
<p>重定向由response发起，是服务器告诉浏览器要跳转的页面，所以URL地址会变，即浏览器重新发起一个请求到另一页面，request是重新发起的请求，而请求转发是服务器内部完成的请求，是不一样的。</p>
<p>对于重定向的跳转路径，有两种方法：</p>
<p><code>response.sendRedirect(&quot;/test01/MyServlet01&quot;);</code>：此处使用/作为开始，说明是从web的根开始，可以定位到根下面的任何资源。</p>
<p><code>response.sendRedirect(&quot;MyServlet01&quot;);</code>：这种写法是从当前web项目的根开始，即使用相对路径表示，能够访问到当前web项目下的任何资源。</p>
<h4 id="3-5-如何使用重定向传参"><a href="#3-5-如何使用重定向传参" class="headerlink" title="3.5 如何使用重定向传参"></a>3.5 如何使用重定向传参</h4><p>重定向发起的是二次请求，浏览器中请求的新页面无法获取服务器中原来页面参数，那么参数该如何获取呢？</p>
<p>解决：使用URL后的？传参，并使用getParameter取得参数。</p>
<p>举例：使用重定向传参数，模拟用户登陆页面。</p>
<p>说明：login.html为登陆的页面，表单提交后发送至loginServlet.java，在loginServlet.java中处理得到结果，将结果发送至resultServlet.java，并在页面中输出。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">//login.html</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;loginServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 0px;margin-bottom: 0px;margin-top: 0px&quot;</span>&gt;</span>用户登录<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Username：<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">required</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Password：<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">required</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">              	<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// loginServlet.java中的doGet方法，其余不变</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">    <span class="comment">//获取表单参数</span></span><br><span class="line">    String user = request.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    String pw = request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    String result = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//登陆验证</span></span><br><span class="line">    <span class="keyword">if</span>(user.equals(<span class="string">&quot;hello&quot;</span>)&amp;&amp;pw.equals(<span class="string">&quot;123&quot;</span>))</span><br><span class="line">      result = <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">      result = <span class="string">&quot;fail&quot;</span>;</span><br><span class="line">    <span class="comment">//使用请求转发，通过设置参数进行获取</span></span><br><span class="line">    <span class="comment">//request.setAttribute(&quot;user&quot;, user);</span></span><br><span class="line">    <span class="comment">//request.setAttribute(&quot;result&quot;, result);</span></span><br><span class="line">    <span class="comment">//请求转发，跳回视图层</span></span><br><span class="line">    <span class="comment">//RequestDispatcher rd  = request.getRequestDispatcher(&quot;ResultServlet&quot;);</span></span><br><span class="line">    <span class="comment">//rd.forward(request, response);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//使用重定向，则需要通过？传参</span></span><br><span class="line">    response.sendRedirect(<span class="string">&quot;ResultServlet?user=&quot;</span>+user+<span class="string">&quot;&amp;result=&quot;</span>+result);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resultServlet中的doGet方法，其余不变</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">    <span class="comment">//请求转发使用getAttribute获取。</span></span><br><span class="line">    <span class="comment">//String user = (String)request.getAttribute(&quot;user&quot;);</span></span><br><span class="line">    <span class="comment">//String result =(String)request.getAttribute(&quot;result&quot;);</span></span><br><span class="line">    <span class="comment">//重定向参数获取，使用getParameter获取</span></span><br><span class="line">    String user = (String)request.getParameter(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    String result =(String)request.getParameter(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    PrintWriter out = response.getWriter();</span><br><span class="line">    out.print(<span class="string">&quot;Welcome,&quot;</span>+user+<span class="string">&quot;,your status is:&quot;</span>+result);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/03/18/Java-Web-HttpServletRequest%E5%AF%B9%E8%B1%A1%E5%92%8CHttpServeltRespnse%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3/redirect.png" alt="redirect"></p>
<p><img src="/2020/03/18/Java-Web-HttpServletRequest%E5%AF%B9%E8%B1%A1%E5%92%8CHttpServeltRespnse%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3/redirect1.png" alt="redirect1"></p>
<blockquote>
<p>以上登陆提供了请求转发和重定向两种方式，便于进一步体现两者区别。　　　</p>
</blockquote>
<h2 id="乱码问题解决"><a href="#乱码问题解决" class="headerlink" title="乱码问题解决"></a>乱码问题解决</h2><blockquote>
<p>待补充…</p>
</blockquote>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javaee/6/api/javax/servlet/http/HttpServletRequest.html">Oracle HttpServletRequest官方文档</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletResponse.html">Oracle HttpServletResponse官方文档</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xdp-gacl/p/3798347.html">孤傲苍狼博客园对Java Web的总结</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhangyinhua/p/7629221.html#_label0">LanceToBigData</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://superming.life/2020/02/25/01-Hadoop-Configuration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ninja2.jpg">
      <meta itemprop="name" content="AlenZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AlenZhang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/25/01-Hadoop-Configuration/" class="post-title-link" itemprop="url">01-Hadoop Configuration</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-02-25 23:31:35" itemprop="dateCreated datePublished" datetime="2020-02-25T23:31:35+08:00">2020-02-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
        </span>
    </span>

  
    <span id="/2020/02/25/01-Hadoop-Configuration/" class="post-meta-item leancloud_visitors" data-flag-title="01-Hadoop Configuration" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>8.1k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>7 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Hadoop-配置【一】：macOS-10-15-3-Hadoop-3-2-1"><a href="#Hadoop-配置【一】：macOS-10-15-3-Hadoop-3-2-1" class="headerlink" title="Hadoop 配置【一】：macOS 10.15.3 + Hadoop 3.2.1"></a>Hadoop 配置【一】：macOS 10.15.3 + Hadoop 3.2.1</h1><h2 id="云计算平台"><a href="#云计算平台" class="headerlink" title="云计算平台"></a>云计算平台</h2><p>服务层次：基础设施即服务（IaaS）/ 平台即服务（PaaS）/ 软件即服务（SaaS）</p>
<h2 id="资料选择"><a href="#资料选择" class="headerlink" title="资料选择"></a>资料选择</h2><p><a target="_blank" rel="noopener" href="http://dblab.xmu.edu.cn/post/5663/">《大数据技术原理与应用》</a>：作为入门教材使用</p>
<p><a target="_blank" rel="noopener" href="https://dblab.xmu.edu.cn/post/bigdatapractice/">《大数据基础编程、实验和案例教程》</a>：配套实验指导书</p>
<p><a target="_blank" rel="noopener" href="https://book.douban.com/subject/10464777/">《Hadoop》</a>:作为深入研究的书籍</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>大数据计算的几种模式</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">大数据计算模式</th>
<th style="text-align:left">解决问题</th>
<th style="text-align:left">代表产品</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">批处理计算</td>
<td style="text-align:left">大规模数据的<strong>批</strong>处理</td>
<td style="text-align:left">MapReduce、Spark等</td>
</tr>
<tr>
<td style="text-align:left">流计算</td>
<td style="text-align:left">针对流数据的<strong>实时</strong>计算</td>
<td style="text-align:left">Storm、S4、Flume、Streams等</td>
</tr>
<tr>
<td style="text-align:left">图计算</td>
<td style="text-align:left">针对大规模<strong>图结构</strong>数据的处理</td>
<td style="text-align:left">Pregel、GraphX、Giraph、PowerGraph等</td>
</tr>
<tr>
<td style="text-align:left">查询分析计算</td>
<td style="text-align:left">大规模数据的<strong>存储管理和查询</strong></td>
<td style="text-align:left">Dremel、Hive、Cassandra等</td>
</tr>
</tbody>
</table>
</div>
<p>扩展：大数据与云计算、物联网的关系</p>
<p>云计算概述：</p>
<blockquote>
<p>解决两个核心问题：</p>
<p>解决海量数据的<strong>分布式存储和分布式处理问题</strong> / 虚拟化和多租户</p>
<p>三个核心缩写：</p>
<p>SaaS： Software as a Service    「从集中的系统部署软件，使之在一台本地计算机上运行的一个模型，SaaS允许出租一个应用程序」</p>
<p>PaaS：Platform as a Service    「类似IaaS，包括操作系统和围绕特定应用必须的服务」</p>
<p>IaaS：Infrastructure as a Service    「将基础设施（计算资源和存储）作为服务出租」</p>
</blockquote>
<p>物联网：</p>
<blockquote>
<p>感知层    -&gt; 网络层    -&gt;    处理层    -&gt;    应用层</p>
</blockquote>
<p>云计算为大数据提供技术基础、大数据为云计算提供用武之地。</p>
<p>物联网是大数据重要来源，大数据为物联网数据分析提供支撑。</p>
<p>云计算为互联网提供海量数据存储能力，物联网为云计算技术提供广阔的应用空间。</p>
<!------more -------->
<h2 id="处理架构Hadoop-需拓展"><a href="#处理架构Hadoop-需拓展" class="headerlink" title="处理架构Hadoop[需拓展]"></a>处理架构Hadoop[需拓展]</h2><p><img src="/2020/02/25/01-Hadoop-Configuration/p1.jpg" alt="p1"></p>
<p>开源的分布式计算平台，极大的降低了用户的复杂性。可以使用多种语言在Hadoop上运行。</p>
<p>两大核心：HDFS + MapReduce，<strong>这两个核心解决了分布式的存储和分布式处理问题两大核心问题。</strong></p>
<p>特点：高可靠性，高效性「分布式并行处理」，高可扩展性，成本低「可用低端机」。</p>
<p><strong>Hadoop版本区分</strong>：Hadoop1.x / Hadoop 2.x  / Hadoop 3.x</p>
<p>1.0 版本 MapReduce框架的功能过于复杂，效率低下。</p>
<p>2.0 版本 将MapReduce下的资源调度提取出来，新建一个<strong>YARN框架</strong>进行资源调度。HDFS也发生变化，对可扩展性进行改进。</p>
<blockquote>
<p>Hadoop衍生版本：<strong>Cloudera</strong>、MapR、Hortonwork、星环</p>
</blockquote>
<p><strong>Hadoop项目结构</strong>「需深入」</p>
<p>Spark基于内存计算，MapReduce基于内存，Spark性能高。Hive，Hadoop上的数据仓库。Pig进行轻量级的数据处理「可以嵌套Sql，基于Haaoop的大规模数据分析平台」，Oozie工作流管理，ZooKeeper，提供分布式协调一致性服务，Hbase非关系型的数据库。Flume进行数据收集，Sqoop进行数据导入导出「关系数据库的数据导出的Hadoop中」，Ambari，快速部署工具，支持Apache Hadoop集群的供应。</p>
<p><strong>Hadoop部署与使用</strong></p>
<p>HDFS：NameNode[名称节点] + DataNode[数据节点] 一起构成分布式文件节点系统。NameNode很多数据都保存在内存中。</p>
<p>MapReduce：JobTracker[作业管家，进行协调] + TaskTracker[部署在不同机器中，负责跟踪和执行分配给自己的作业]</p>
<p>一个MapReduce做作业时由一个总管家JobTracker来协调很多个位于不同机器上的若干个TaskTracker完成一个大的作业。</p>
<p>冷备份，SecondaryNameNode：NameNode故障后需要恢复过程顶上去。</p>
<hr>
<h1 id="MacOS-Hadoop-配置及入坑指南"><a href="#MacOS-Hadoop-配置及入坑指南" class="headerlink" title="MacOS Hadoop 配置及入坑指南"></a>MacOS Hadoop 配置及入坑指南</h1><blockquote>
<p>学习大数据的记录文章，有很多不足或错误尽请谅解或与我联系。</p>
<p><a href="supermingzero@gmail.com">邮箱</a>                          <a target="_blank" rel="noopener" href="https://t.me/SuperMing">Telegram</a></p>
<p>系统版本：macOS Catalina 10.15.3</p>
<p>Hadoop 版本：3.2.1</p>
</blockquote>
<p>学习分布式计算( Distributed Computing )，Hadoop 是一个很好的开始。</p>
<p>Hadoop是一个开源的分布式计算平台，由于良好的开发环境极大的降低了用户的使用复杂性。基于Java开发，具有很好的扩展性，可以使用多种语言运行。</p>
<p>Hadoop的框架最核心的设计就是：HDFS和MapReduce。HDFS为海量的数据提供了存储，则MapReduce为海量的数据提供了计算.</p>
<p>由于Mac OS本身基于类Unix系统开发，Hadoop平台亦可以在Mac OS上使用。相关配置可能有所不同。</p>
<h2 id="WHY"><a href="#WHY" class="headerlink" title="WHY"></a>WHY</h2><p>mac作为我平时开发的主力机，当然希望各种开发环境都能在一台机子上完成，Hadoop也不例外。Apache Hadoop 3.2.1于2019年9月22日释出，mac系统可参考和借鉴的文章不是很多，所以希望在macOS下完美的配置Hadoop，并解决相关问题。「Not Yet」。</p>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><ul>
<li>Java 8 [ 注意是Java 8 ]</li>
<li><a target="_blank" rel="noopener" href="https://brew.sh/">Homebrew</a> [Mac OS的包管理系统]</li>
<li>ssh</li>
<li>Hadoop</li>
</ul>
<h3 id="安装Homebrew"><a href="#安装Homebrew" class="headerlink" title="安装Homebrew"></a>安装Homebrew</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Homebrew安装的软件都集中在/usr/local/Cellar中</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看brew的帮助</span></span><br><span class="line">brew -help</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装软件</span></span><br><span class="line">brew install hadoop</span><br><span class="line"><span class="meta">#</span><span class="bash"> 卸载软件</span></span><br><span class="line">brew uninstall hadoop</span><br><span class="line"><span class="meta">#</span><span class="bash"> 搜索软件</span></span><br><span class="line">brew search hadoop</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看已经安装的软件</span></span><br><span class="line">brew list</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更新软件</span></span><br><span class="line">brew update</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更新某具体软件</span></span><br><span class="line">brew upgrade hadoop</span><br></pre></td></tr></table></figure>
<h3 id="安装Java8"><a href="#安装Java8" class="headerlink" title="安装Java8"></a>安装Java8</h3><p>对于Java版本使用问题，参见<a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/HADOOP/Hadoop+Java+Versions">官网</a>。</p>
<p><img src="/2020/02/25/01-Hadoop-Configuration/p2.png" alt="p1"></p>
<p>检查自己的Java 版本<code>Java -version</code></p>
<p><img src="/2020/02/25/01-Hadoop-Configuration/p3.png" alt="p1"></p>
<p>如果不是Java8，参考常规下载包安装或命令安装「若原本有更高级或别的java版本在进行其余开发，不用卸载修改路径即可，请自寻Google」</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew cask install java8</span><br></pre></td></tr></table></figure>
<h3 id="配置ssh-key"><a href="#配置ssh-key" class="headerlink" title="配置ssh key"></a>配置ssh key</h3><p>使用下面命令查看ssh是否可用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh localhost</span><br></pre></td></tr></table></figure>
<p>若显示</p>
<p><code>ssh：connect to host localhost port 22: COnnection refused</code></p>
<p>使用下面命令，授权SSH登陆。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ssh-keygen -t rsa -P <span class="string">&#x27;&#x27;</span> -f ~/.ssh/id_rsa</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> chmod 0600 ~/.ssh/authorized_keys</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/02/25/01-Hadoop-Configuration/p5.png" alt="p1"></p>
<p>然后在系统System Preferences -&gt; Sharing下的Remote Login中国中选择All users允许接入。</p>
<p><img src="/2020/02/25/01-Hadoop-Configuration/p4.png" alt="p1"></p>
<p>再次执行<code>ssh localhost</code>看是否成功。若依旧失败请Google解决。</p>
<h3 id="安装Hadoop"><a href="#安装Hadoop" class="headerlink" title="安装Hadoop"></a>安装Hadoop</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Brew install hadoop</span><br></pre></td></tr></table></figure>
<p>Brew会安装最新的稳定版本，截止2020年2月23日，版本为<code>hadoop-3.2.1</code> </p>
<p><img src="/2020/02/25/01-Hadoop-Configuration/p12.png" alt="p1"></p>
<p>Mac下的安装目录：<code>/usr/local/Cellar/hadoop</code></p>
<blockquote>
<p>In normal circumstances, brew would have automatically created a symlink from <code>/usr/local/opt/hadoop</code> to <code>/usr/local/Celler/hadoop/</code></p>
</blockquote>
<h2 id="相关配置参考："><a href="#相关配置参考：" class="headerlink" title="相关配置参考："></a>相关配置参考：</h2><blockquote>
<p>Hadoop 三种运行模式</p>
<ul>
<li>Standalone Operation  </li>
</ul>
<p>单机配置，非分布式模式。设置单节点的时候，Hadoop默认运行在<strong>非分布式的单机配置</strong>下，方便进行调试。也就是说安装完成后无需进行配置即可运行。</p>
<ul>
<li>Pseudo-Distributed Operation</li>
</ul>
<p>Hadoop可以在单节点上以伪分布的方式运行，Hadoop进程以分离的Java进行来运行，，即下面的配置。节点即作为NameNode也作为DataNode，同时提取的是HDFS中的文件。</p>
<ul>
<li>Fully-Distributed Operation </li>
</ul>
<p>分布式模式。需要多台分布式设备，在此不做展开。</p>
</blockquote>
<p>macOS下Hadoop配置文件目录为：/usr/local/Cellar/hadoop/3.2.1/libexec/etc/hadoop/ 下，进入该目录对以下文件修改</p>
<blockquote>
<p><strong>core-site.xml</strong>  「MapReduce job」</p>
<p><strong>hdfs-site.xml</strong> 「MapReduce job」</p>
<p><strong>mapred-site.xml</strong> 「YARN」</p>
<p><strong>hadoop-env.sh</strong> 「Total」</p>
</blockquote>
<p>Hadoop运行由配置文件决定，也就是从伪分步模式切换回非分布式模式都需要对配置文件进行调整。</p>
<p>在官方文档下，伪分布模式只需要配置<code>fs.defaultFS</code>与<code>dfs.replication</code>就可。但我们需要配置<code>hadoop.tmp.dir、dfs.namenode.name.dir、dfs.datenode.data.dir</code>指定使用的目录，默认目录重启时会被清理，所以需要进行配置。</p>
<h3 id="hadoop-env-sh"><a href="#hadoop-env-sh" class="headerlink" title="hadoop-env.sh"></a>hadoop-env.sh</h3><p>在此文件对hadoop进行配置。使用命令找到mac下的Java_Home路径<code>/usr/libexec/java_home -V</code></p>
<p>在<code>/usr/local/Cellar/hadoop/3.2.1/libexec/etc/hadoop/hadoop-env.sh</code>下寻找export JAVA_HOME，修改配置如下：</p>
<p>!<img src="/2020/02/25/01-Hadoop-Configuration/p6.png" alt="p1"></p>
<h3 id="core-site-xml"><a href="#core-site-xml" class="headerlink" title="core-site.xml"></a>core-site.xml</h3><p>在core-site.xml下配置HDFS 地址和端口号，写入下面配置「注意所有端口号不要与你正在使用的<strong>端口号</strong>冲突，冲突请更换空闲端口」</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Put site-specific property overrides in this file. --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/Cellar/hadoop/hdfs/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>A base for other temporary directories<span class="tag">&lt;/<span class="name">description</span>&gt;</span>             </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.default.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>hadoop.tmp.dir</code> : 用于存放本地Hadoop临时文件，比如datanode、namenode、hdfs等，记得给相应权限</li>
<li><code>fs.defaultFS</code> : is the new name for the previously-deprecated key <code>fs.default.name</code>.</li>
</ul>
<h3 id="hdfs-site-xml"><a href="#hdfs-site-xml" class="headerlink" title="hdfs-site.xml"></a>hdfs-site.xml</h3><p>在目录 <code>/usr/local/Cellar/hadoop/3.2.1/libexec/etc/hadoop/hdfs-site.xml</code> 下配置以下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  	 <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   	 <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">   	 <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/Cellar/hadoop/hdfs/tmp/dfs/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/Cellar/hadoop/hdfs/tmp/dfs/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>为什么是1？因为在单机环境下，不论是分布式还是伪分布，都只有一个数据点（Datanode）。</p>
<h3 id="mapred-site-xml"><a href="#mapred-site-xml" class="headerlink" title="mapred-site.xml"></a>mapred-site.xml</h3><p>此节点为运行YARN配置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapred.job.tracker<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>localhost:8021<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="初始化HDFS"><a href="#初始化HDFS" class="headerlink" title="初始化HDFS"></a>初始化HDFS</h2><p>下面命令初始化分布式文件，收到”successfully formatted”即配置ok。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/opt/hadoop</span><br><span class="line">hdfs namenode -format</span><br></pre></td></tr></table></figure>
<p><img src="/2020/02/25/01-Hadoop-Configuration/p7.png" alt="p1"></p>
<h3 id="启动命令介绍"><a href="#启动命令介绍" class="headerlink" title="启动命令介绍"></a>启动命令介绍</h3><p>进入以下目录<code>/usr/local/opt/hadoop/sbin</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./start-dfs.sh # 开启HDFS服务命令</span><br><span class="line">./stop-dfs.sh  # 停止HDFS服务命令</span><br><span class="line">./start-all.sh # 开启所有命令</span><br><span class="line">./stop-all.sh # 停止所有命令</span><br></pre></td></tr></table></figure>
<p>开启完毕后使用<code>jps</code>命令查看服务状态</p>
<p><img src="/2020/02/25/01-Hadoop-Configuration/p8.png" alt="p1"></p>
<p>按照上述配置，且没有更换端口，通过下面网址接入Hadoop的网页</p>
<p><strong>Resource Manager： <a target="_blank" rel="noopener" href="http://localhost:9780">http://localhost:9780</a></strong></p>
<blockquote>
<p><strong>2.x版本默认为<a target="_blank" rel="noopener" href="http://localhost:50070">http://localhost:50070</a></strong></p>
</blockquote>
<p>NameNode Info：</p>
<p><img src="/2020/02/25/01-Hadoop-Configuration/p9.png" alt="p1"></p>
<p><strong>JobTracker：<a target="_blank" rel="noopener" href="http://localhost:8088/">http://localhost:8088/</a></strong></p>
<p>MapReduce Info：</p>
<p><img src="/2020/02/25/01-Hadoop-Configuration/p10.png" alt="p1"></p>
<p><strong>Node Specific Info: <a target="_blank" rel="noopener" href="http://localhost:8042/">http://localhost:8042/</a></strong></p>
<p><img src="/2020/02/25/01-Hadoop-Configuration/p11.png" alt="p1"></p>
<h2 id="Shell-配置（optional）"><a href="#Shell-配置（optional）" class="headerlink" title="Shell 配置（optional）"></a>Shell 配置（optional）</h2><p>相较于每次都进入目录<code>/usr/local/Cellar/hadoop/3.2.1/sbin</code>，在shell中配置全局<code>PATH</code>会方面很多，这样我们就可以在shell或terminal任意地方使用hadoop相关命令。</p>
<p>不同的shell配置目录不同，<code>`/etc/profile</code>, <code>~/.bashrc</code>, <code>~/.bash_profile</code>, <code>~/.profile</code>, <code>~/.zshrc</code>… `</p>
<p>我使用zsh，所以打开<code>~/.zshrc</code>下添加</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/Cellar/hadoop/3.2.1/sbin </span><br><span class="line"><span class="built_in">alias</span> gohadoop=<span class="string">&quot;cd /usr/local/Cellar/hadoop&quot;</span> <span class="comment">#方便进入hadoop目录</span></span><br></pre></td></tr></table></figure>
<p>保存退出</p>
<p>使用命令<code>source ~/.zshrc</code>使zsh配置生效</p>
<p>这样在<code>/usr/local/Cellar/hadoop/3.2.1/sbin</code>目录下的文件可以不再进入该目录直接执行即可。</p>
<p>Hadoop默认配置使用本地框架进行开发调试，如果要在本机上使用YARN，如果shell配置后，可直接使用<code>start-yarn.sh</code>。</p>
<h2 id="Troble-shooting"><a href="#Troble-shooting" class="headerlink" title="Troble shooting"></a>Troble shooting</h2><p>碰到问题最好先检查日志来找原因。</p>
<ol>
<li>开启所有服务后，发现有些服务没有开启</li>
</ol>
<p><img src="/2020/02/25/01-Hadoop-Configuration/p15.png" alt="p1"></p>
<p>Answer：未能开启其余模块，主要是Java版本不兼容，我使用的是Java11进行安装，出现如上错误，下载Java 8 后问题Fix。</p>
<ol>
<li>进行单机伪分布测试时，出现如下问题「unFixed」不影响正常使用</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span><br></pre></td></tr></table></figure>
<ol>
<li>Hadoop启动错误是出现“ssh: Could not resolve hostname xxx” 「参考」</li>
</ol>
<p>通过设置Hadoop的环境变量解决。</p>
<h2 id="Hadoop伪分布式运行MapReduce实例"><a href="#Hadoop伪分布式运行MapReduce实例" class="headerlink" title="Hadoop伪分布式运行MapReduce实例"></a>Hadoop伪分布式运行MapReduce实例</h2><blockquote>
<p>此处参考的也是官方文档的例子，但有很多地方会与之有冲突。</p>
</blockquote>
<p>单机模式中读取的是本地的数据，而伪分布则读取的是HDFS模式。</p>
<p>Shell命令的四种方式</p>
<blockquote>
<p>./bin/hadoop dfs  #只适合HDFS文件系统<br>hadoop fs  #适用不同的文件系统<br>hadoop dfs #只适合HDFS文件系统<br>hdfs dfs #只适合HDFS文件系统</p>
</blockquote>
<ol>
<li>需要使用HDFS，则需要创建用户目录。mac默认为你原本用户的名字，可以直接用也可以创建用户。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/hdfs dfs -mkdir -p /user/hadoop  #创建hadoop用户</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Report：我在mac的hadoop目录下运行以上命令没有任何反应，查看用户也不存在。</p>
</blockquote>
<ol>
<li>在分布式文件中创建input文件，然后将文/usr/local/Cellar/hadoop/3.2.1/libexec/etc/hadoop/下的文件复制到分布式文件系统下的input文件中。</li>
</ol>
<p>因为我使用的是此电脑的用户即superming，且已有相应用户目录/user/superming，因此在命令中可以使用相对路径如input，绝对路径为/user/superming/input,我在hadoop/3.2.1目录下执行的以下操作。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./bin/hdfs dfs -mkdir input</span><br><span class="line">./bin/hdfs dfs -put .libxexc/etc/hadoop/*.xml input</span><br></pre></td></tr></table></figure>
<p>复制完成后通过下面命令查看文件列表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/hdfs dfs -ls input</span><br></pre></td></tr></table></figure>
<p>接下来运行MapReduce作业。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/hadoop jar ./libexec/share/hadoop/mapreduce/hadoop-mapreduce-examples-*.jar grep input output &#x27;dfs[a-z.]+&#x27;</span><br></pre></td></tr></table></figure>
<p>运行结果截图如下：</p>
<p><img src="/2020/02/25/01-Hadoop-Configuration/p13.png" alt="p1"></p>
<p>查看命令运行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/hdfs dfs -cat output/*</span><br></pre></td></tr></table></figure>
<p><img src="/2020/02/25/01-Hadoop-Configuration/p14.png" alt="p1"></p>
<p>或把文件存入本地再查看</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm -r ./output    # 先删除本地的 output 文件夹（如果存在）</span><br><span class="line">./bin/hdfs dfs -get output ./output     # 将 HDFS 上的 output 文件夹拷贝到本机</span><br><span class="line">cat ./output/*</span><br></pre></td></tr></table></figure>
<p>提示：Hadoop运行文件时，输出的目录Hadoop会给你创建，否则会导致冲突。若原本存在或要重新执行以上测试，先删除目标文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/hdfs dfs -rm -r output 「output指代目标文件」</span><br></pre></td></tr></table></figure>
<p>【<strong>参考</strong>】：鉴于此在每次开发中，可以在程序中添加如下代码，能在每次运行时自动删除输出目录。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">Job job = <span class="keyword">new</span> Job(conf);</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* 删除输出目录 */</span></span><br><span class="line">Path outputPath = <span class="keyword">new</span> Path(args[<span class="number">1</span>]);</span><br><span class="line">outputPath.getFileSystem(conf).delete(outputPath, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>
<p>关闭Hadoop执行</p>
<h2 id><a href="#" class="headerlink" title></a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./sbin/stop-dfs.sh  # 停止HDFS服务命令</span><br><span class="line">./sbin/stop-all.sh  # 停止所有hadoop服务</span><br></pre></td></tr></table></figure></h2><p><strong>目录整理：</strong></p>
<p>环境配置目录：<code>/usr/local/Cellar/hadoop/3.2.1/libexec/etc/hadoop/capacity-scheduler.xml</code></p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="http://dblab.xmu.edu.cn/blog/2441-2/#more-2441">林子雨老师的Hadoop3.1.3 安装教程</a></p>
<p><a target="_blank" rel="noopener" href="https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/SingleCluster.html#Required_Software">Hadoop: Setting up a Single Node Cluster.</a></p>
<p>[Complete Guide to Install and Configure Apache Hadoop 3 on MacOS](</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://superming.life/2020/01/21/Hexo-%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ninja2.jpg">
      <meta itemprop="name" content="AlenZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AlenZhang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/21/Hexo-%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">Hexo 个人博客高级配置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-01-21 22:12:37" itemprop="dateCreated datePublished" datetime="2020-01-21T22:12:37+08:00">2020-01-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
        </span>
    </span>

  
    <span id="/2020/01/21/Hexo-%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/" class="post-meta-item leancloud_visitors" data-flag-title="Hexo 个人博客高级配置" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>4.1k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>4 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本文简单介绍我搭建博客时考虑到或直接用上的几个集成功能。</p>
<h2 id="访问统计"><a href="#访问统计" class="headerlink" title="访问统计"></a>访问统计</h2><h3 id="站点访问量统计"><a href="#站点访问量统计" class="headerlink" title="站点访问量统计"></a>站点访问量统计</h3><p>访问统计功能由<a target="_blank" rel="noopener" href="http://ibruce.info/2015/04/04/busuanzi/">不蒜子</a>提供，详细使用参见其个人网站。</p>
<ul>
<li><p>效果如下：【前者为uv算法显示，后者为pv算法显示】</p>
<p><img src="/2020/01/21/Hexo-%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/busuanzi.png" alt="valine"></p>
</li>
</ul>
<p>我所使用的Next主题已经集成此功能，只需添加脚本和开启功能即可。</p>
<p>访问主题下的footer.swig文件添加代码，<code>path:themes/next/layout/_partials/footer.swig</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> </span></span><br><span class="line"><span class="tag"><span class="attr">async</span> </span></span><br><span class="line"><span class="tag"><span class="attr">src</span>=<span class="string">&quot;//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> </span></span><br><span class="line"><span class="tag"><span class="attr">async</span> </span></span><br><span class="line"><span class="tag"><span class="attr">src</span>=<span class="string">&quot;//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<!---- more ----->
<p>然后打开<strong>主题</strong>配置文件，搜索找到busuanzi对应配置页面进行如下配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Show PV/UV of the website/page with busuanzi.</span></span><br><span class="line"><span class="comment"># Get more information on http://ibruce.info/2015/04/04/busuanzi/</span></span><br><span class="line"><span class="attr">busuanzi_count:</span></span><br><span class="line">  <span class="comment"># count values only if the other configs are false</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># custom uv span for the whole site</span></span><br><span class="line">  <span class="attr">site_uv:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">site_uv_header:</span> <span class="string">&lt;i</span> <span class="string">class=&quot;fa</span> <span class="string">fa-user&quot;&gt;&lt;/i&gt;</span></span><br><span class="line">  <span class="attr">site_uv_footer:</span></span><br><span class="line">  <span class="comment"># custom pv span for the whole site</span></span><br><span class="line">  <span class="attr">site_pv:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">site_pv_header:</span> <span class="string">&lt;i</span> <span class="string">class=&quot;fa</span> <span class="string">fa-eye&quot;&gt;&lt;/i&gt;</span></span><br><span class="line">  <span class="attr">site_pv_footer:</span></span><br><span class="line">  <span class="comment"># custom pv span for one page only</span></span><br><span class="line">  <span class="attr">page_pv:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">page_pv_header:</span> <span class="string">&lt;i</span> <span class="string">class=&quot;fa</span> <span class="string">fa-file-o&quot;&gt;&lt;/i&gt;</span></span><br><span class="line">  <span class="attr">page_pv_footer:</span></span><br></pre></td></tr></table></figure>
<p>插件提供了两种不同的算法：</p>
<p>算法a：pv的方式，单个用户连续点击n篇文章，记录n次访问量；配置<code>site_pv:ture</code>开启。</p>
<p>算法b：uv的方式，单个用户连续点击n篇文章，只记录1次访客数；配置<code>site_uv:ture</code>开启。</p>
<p>不蒜子还提供了单页面点击量的统计，配置<code>page_pv:ture</code>开启。</p>
<h3 id="文章访问量统计"><a href="#文章访问量统计" class="headerlink" title="文章访问量统计"></a>文章访问量统计</h3><p>文章统计基于LeanCloud所提供的后端数据支持。</p>
<ul>
<li>效果如下：</li>
</ul>
<p><img src="/2020/01/21/Hexo-%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/count.png" alt="valine"></p>
<p>需要在LeanCloud上注册一个账号并且创建一个应用，需要进行实名认证，创建一个Counter的Class，开放所有的权限。</p>
<p><img src="/2020/01/21/Hexo-%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/leancloud.png" alt="valine"></p>
<p>然后找到控制台中的设置，然后点击应用Keys，App ID 和 App Key 填入到主题配置文件中。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Valine.</span></span><br><span class="line"><span class="comment"># You can get your appid and appkey from https://leancloud.cn</span></span><br><span class="line"><span class="comment"># more info please open https://valine.js.org</span></span><br><span class="line"><span class="attr">valine:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">appid:</span> <span class="string">//</span> <span class="string">your</span> <span class="string">appid</span></span><br><span class="line">  <span class="attr">appkey:</span> <span class="string">//</span> <span class="string">your</span> <span class="string">appkey</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="literal">false</span> <span class="comment"># mail notifier , https://github.com/xCss/Valine/wiki</span></span><br><span class="line">  <span class="attr">verify:</span> <span class="literal">false</span> <span class="comment"># Verification code</span></span><br><span class="line">  <span class="attr">placeholder:</span> <span class="string">Just</span> <span class="string">go</span> <span class="string">go</span> <span class="comment"># comment box placeholder</span></span><br><span class="line">  <span class="attr">avatar:</span> <span class="string">mm</span> <span class="comment"># gravatar style</span></span><br><span class="line">  <span class="attr">guest_info:</span> <span class="string">nick,mail,link</span> <span class="comment"># custom comment header</span></span><br><span class="line">  <span class="attr">pageSize:</span> <span class="number">10</span> <span class="comment"># pagination size</span></span><br></pre></td></tr></table></figure>
<p>设置完毕后，在安全中心内配置网站的域名，以保护数据安全。</p>
<p>不蒜子能够在页面内提供文章的阅读统计次数，而不能在主页显示，所以我选择了使用LeanCloud进行站点统计。</p>
<h2 id="添加豆瓣插件"><a href="#添加豆瓣插件" class="headerlink" title="添加豆瓣插件"></a>添加豆瓣插件</h2><p>使用相关插件爬取你的豆瓣数据，生成单独页面进行显示。<a target="_blank" rel="noopener" href="https://github.com/mythsman/hexo-douban">插件参考</a></p>
<ul>
<li>效果如下：</li>
</ul>
<p><img src="/2020/01/21/Hexo-%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/douban.png" alt="valine"></p>
<p>进入根目录执行下面命令安装</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-douban --save</span><br></pre></td></tr></table></figure>
<p>将以下内容写入到站点的配置文件_config.yml中，如果不想显示某些页面，注释掉即可。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">douban:</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">mythsman</span></span><br><span class="line">  <span class="attr">builtin:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">book:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">&#x27;This is my book title&#x27;</span></span><br><span class="line">    <span class="attr">quote:</span> <span class="string">&#x27;This is my book quote&#x27;</span></span><br><span class="line">  <span class="attr">movie:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">&#x27;This is my movie title&#x27;</span></span><br><span class="line">    <span class="attr">quote:</span> <span class="string">&#x27;This is my movie quote&#x27;</span></span><br><span class="line">  <span class="attr">game:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">&#x27;This is my game title&#x27;</span></span><br><span class="line">    <span class="attr">quote:</span> <span class="string">&#x27;This is my game quote&#x27;</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="number">10000</span> </span><br></pre></td></tr></table></figure>
<ul>
<li><strong>user</strong>: 你的豆瓣ID.打开豆瓣，登入账户，然后在右上角点击 “个人主页” ，这时候地址栏的URL大概是这样：”<a target="_blank" rel="noopener" href="https://www.douban.com/people/xxxxxx/">https://www.douban.com/people/xxxxxx/</a>“ ，其中的”xxxxxx”就是你的个人ID了。</li>
<li><strong>builtin</strong>: 是否将生成页面的功能嵌入<code>hexo s</code>和<code>hexo g</code>中，默认是<code>false</code>,另一可选项为<code>true</code></li>
<li><strong>title</strong>: 该页面的标题.</li>
<li><strong>quote</strong>: 写在页面开头的一段话,支持html语法.</li>
<li><strong>timeout</strong>: 爬取数据的超时时间，默认是 10000ms ,如果在使用时发现报了超时的错(ETIMEOUT)可以把这个数据设置的大一点。</li>
</ul>
<p>配置完毕后进入<strong>主题</strong>对菜单进行配置：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">Home:</span> <span class="string">/</span></span><br><span class="line">  <span class="attr">Archives:</span> <span class="string">/archives</span></span><br><span class="line">  <span class="attr">Books:</span> <span class="string">/books</span>     <span class="comment">#This is your books page</span></span><br><span class="line">  <span class="attr">Movies:</span> <span class="string">/movies</span>   <span class="comment">#This is your movies page</span></span><br><span class="line">  <span class="attr">Games:</span> <span class="string">/games</span>   <span class="comment">#This is your games page</span></span><br></pre></td></tr></table></figure>
<p>然后在根目录下执行下列命令生成所有的页面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo douban </span><br></pre></td></tr></table></figure>
<p>生成指定页面需要添加Options参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ hexo douban -h</span><br><span class="line">Usage: hexo douban</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">Generate pages from douban</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -b, --books   Generate douban books only</span><br><span class="line">  -g, --games   Generate douban games only</span><br><span class="line">  -m, --movies  Generate douban movies only</span><br></pre></td></tr></table></figure>
<p>即<code>hexo douban -b</code>仅生成书本页面，其余同理。</p>
<p><strong>Warning：</strong></p>
<p>一般大家都喜欢使简化命令用<code>hexo g</code>和<code>hexo d</code>来进行部署，但安装此插件后与简化命令冲突，不能使用<code>hexo d</code>了，coz<code>hexo douban</code>和<code>hexo deploy</code>前缀都为<code>hexo d</code>。</p>
<h2 id="文章评论功能"><a href="#文章评论功能" class="headerlink" title="文章评论功能"></a>文章评论功能</h2><p>Next主题支持很多主流的评论系统。</p>
<p><a target="_blank" rel="noopener" href="https://disqus.com/">Disqus</a>：超喜欢的欧美风，主流社交媒体登陆。</p>
<p><a target="_blank" rel="noopener" href="https://www.hypercomments.com/">Hypercomments</a>:简洁且风格非常漂亮，支持图片视频，收费，国外开发者。</p>
<p><a target="_blank" rel="noopener" href="https://valine.js.org/">Valine</a>：国内开发者，简洁，符合我的审美，支持Markdown和匿名评论。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/imsun/gitment">Gitment</a>：使用github账号登陆，支持Markdown语法，风格类github Issue。</p>
<p><a target="_blank" rel="noopener" href="https://changyan.kuaizhan.com/">畅言</a>：国内开发者，没仔细研究。</p>
<p>面对这么选择，简单比较后，我选择了Valine作为我的blog评论插件，首先考虑到国内的上网环境，排除了Disqus和Hypercomments，其次考虑到免费和方便，同时照顾到简洁，Gitment评论登陆这个跳转我认为很影响体验，所以还是选择了Valine，免费、简洁、轻量化，支持一波。</p>
<ul>
<li>效果如下：</li>
</ul>
<p><img src="/2020/01/21/Hexo-%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/valine.png" alt="valine"></p>
<p>直接打开<strong>主题配置</strong>，找到Valine组件，因为Valine基于Leancloud所提供的后段服务，需要配置LeanCloud的App ID和App Key。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Valine.</span></span><br><span class="line"><span class="comment"># You can get your appid and appkey from https://leancloud.cn</span></span><br><span class="line"><span class="comment"># more info please open https://valine.js.org</span></span><br><span class="line"><span class="attr">valine:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">appid:</span> <span class="string">***&lt;app_id***</span></span><br><span class="line">  <span class="attr">appkey:</span> <span class="string">***&lt;app_key&gt;***</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="literal">false</span> <span class="comment"># mail notifier , https://github.com/xCss/Valine/wiki</span></span><br><span class="line">  <span class="attr">verify:</span> <span class="literal">false</span> <span class="comment"># Verification code</span></span><br><span class="line">  <span class="attr">placeholder:</span> <span class="string">Just</span> <span class="string">go</span> <span class="string">go</span> <span class="comment"># comment box placeholder</span></span><br><span class="line">  <span class="attr">avatar:</span> <span class="string">mm</span> <span class="comment"># gravatar style</span></span><br><span class="line">  <span class="attr">guest_info:</span> <span class="string">nick,mail,link</span> <span class="comment"># custom comment header</span></span><br><span class="line">  <span class="attr">pageSize:</span> <span class="number">10</span> <span class="comment"># pagination size</span></span><br></pre></td></tr></table></figure>
<p>配置完毕后，在Leancloud设置界面的安全中心添加你的域名。刷新一下即可看见评论框了。</p>
<p>关于Valine在Next的集成，不同版本的配置文件不同，我也是查看了bluelzy的<a target="_blank" rel="noopener" href="https://bluelzy.com/articles/use_valine_for_your_blog.html">这篇文章</a>才解决我的问题。</p>
<p>我的问题：主题配置中为<code>app_id</code>和<code>app_key</code>，而Valine需要的字段名为<code>appid</code>和<code>appkey</code>，去掉中间的<code>_</code>配置成功。</p>
<p>最后有一个Valine相关拓展的教程详见：<a target="_blank" rel="noopener" href="http://www.zhaojun.im/hexo-valine-admin/">Valine 扩展之邮件通知</a></p>
<hr>
<p>以上为我的Blog所用的几个插件，也了解了一些别的插件，比如参考链接，投票等，感觉没有很大必要，目前只集成了这几个，后续若有新发现，会继续更新～谢谢。</p>
<h2 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://io-oi.me/tech/hexo-next-optimization/">打造个性超赞博客 Hexo + Next + Github Pages 的超深度优化</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://yearito.cn/posts/hexo-advanced-settings.html">Hexo 搭建个人博客系列：进阶设置篇</a></p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://superming.life/2020/01/15/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8C%97-Hexo-Next-GitHub-Pages/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ninja2.jpg">
      <meta itemprop="name" content="AlenZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AlenZhang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/15/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8C%97-Hexo-Next-GitHub-Pages/" class="post-title-link" itemprop="url">博客搭建指北 Hexo+Next+GitHub Pages</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-01-15 13:13:56" itemprop="dateCreated datePublished" datetime="2020-01-15T13:13:56+08:00">2020-01-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
        </span>
    </span>

  
    <span id="/2020/01/15/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8C%97-Hexo-Next-GitHub-Pages/" class="post-meta-item leancloud_visitors" data-flag-title="博客搭建指北 Hexo+Next+GitHub Pages" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>10 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>鉴于国内各平台现状，它们张口闭口信息共享，言论自由；努力建墙造岛的也是它们，我看到了一座座的数据孤岛，且没有一点好转的迹象…</p>
<p>还是决定搭建个人博客。记录下一点一滴，觉得对自己、对他人乃至对社会有一点点帮助的文字。</p>
<p>作为渺小到不能在渺小的个体，随时可能堙灭，悄无声息。而字节一直流淌在互联网之中，只要能够被检索到，一直都会存在。</p>
</blockquote>
<p>提到搭建网页，很多朋友都会想要数据库、服务器，还要域名balabala…听着就很麻烦…</p>
<p>好在大家都在为如何快速搭建博客这一目标努力着，出现了有很多流行的框架，有快速简洁的Hexo、兼容性更强的JekyII，传说最好的博客平台FarBox，简单易用的Hugo…这些框架大大简化了你发布一篇文章的步骤，你负责写文章，框架负责页面的生成。</p>
<p>而关于服务器，良心的GitHub为你解决了这个问题，Github Pages为每个账户提供一个 {username}.github.io 的仓库，同时为其分配一个二级域名，又支持自定义域名，服务器的问题解决了。接下来就正式开始吧。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/01/15/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8C%97-Hexo-Next-GitHub-Pages/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://superming.life/2019/12/27/WhyHumanRunTheWorld/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ninja2.jpg">
      <meta itemprop="name" content="AlenZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AlenZhang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/27/WhyHumanRunTheWorld/" class="post-title-link" itemprop="url">WhyHumanRunTheWorld</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-12-27 18:15:19" itemprop="dateCreated datePublished" datetime="2019-12-27T18:15:19+08:00">2019-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Books/" itemprop="url" rel="index"><span itemprop="name">Books</span></a>
        </span>
    </span>

  
    <span id="/2019/12/27/WhyHumanRunTheWorld/" class="post-meta-item leancloud_visitors" data-flag-title="WhyHumanRunTheWorld" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>4.2k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>4 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>尤瓦尔赫拉利写了三本简史系列，《人类简史》、《未来简史》以及《今日简史》，分别于14年、17年和18年。成书时间越来越短，不可避免质量也打了很多的折扣、很多观点也是旧瓶新酒。总结下来，《人类简史》终究还是三本中最值得的一本。</p>
<p>并不像《时简》那样，各种干货填充。仅仅作为普普通通的大众科普读物，更多起到的是抛砖引玉的作用。作者也表明自己写书的目标学者是对世界充满好奇的青年，而非专业人士。所以会有很多人说这本书结论的支撑论点很薄弱。的确如此，我认为这本书最大的价值在于作者用宏观视角去审视人类历史，结合心理学、历史学、社会学、基因学、哲学……用庞大的知识体系探讨人类从诞生至今，对自然、对人类本身、对人类未来的影响。作者把自己思考后得出的一些结论进行简单的论证分享给读者，多数知识点仅仅点到为止，不刻意论证，有意留白给读者探索的空间，比如在讲到文化宗教相关问题时，作者的相关论述极大的勾起了我的兴趣，在书海中找到了亨廷顿的《文明的冲突》，深入了解相关问题的论述。这些小细节正是这本书的价值所在。<strong>它给你提供一个看世界的角度，剩下的，交给你的好奇心去完成。</strong>不多bb，谈书中我挺喜欢的三个观点探讨一下。「智人想象的能力，为什么会产生人权，幸福是什么」</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/12/27/WhyHumanRunTheWorld/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-alien"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">AlenZhang</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Symbols count total">200k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">3:02</span>
  </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script>


  






  


<script data-pjax>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      const visitors = document.querySelector('.leancloud_visitors');
      const url = decodeURI(visitors.id);
      const title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            const counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      const visitors = document.querySelectorAll('.leancloud_visitors');
      const entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            const target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    const { app_id, app_key, server_url } = {"enable":true,"app_id":"qwoVwWOTHdN9LlXpTz7BojRm-gzGzoHsz","app_key":"GvmFzmeE5nuRcXTSQNH3icVD","server_url":null,"security":true};
    function fetchData(api_server) {
      const Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    const api_server = app_id.slice(-9) === '-MdYXbMMI' ? `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com` : server_url;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>

    <div class="pjax">

  <script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'none'
      },
      options: {
        renderActions: {
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              const target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js';
    script.defer = true;
    document.head.appendChild(script);
  } else {
    MathJax.startup.document.state(0);
    MathJax.typesetClear();
    MathJax.texReset();
    MathJax.typeset();
  }
</script>



    </div>
</body>
</html>
